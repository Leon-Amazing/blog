import{r as k,o as b,c as m,a as s,b as e,F as d,d as p,e as n}from"./app.d02e32d4.js";import{_ as g}from"./plugin-vue_export-helper.21dcd24c.js";var v="/blog/webgl/1.png",o="/blog/webgl/2.png",f="/blog/webgl/3.png",y="/blog/webgl/4.png",x="/blog/webgl/5.png",h="/blog/webgl/6.png",w="/blog/webgl/7.png",_="/blog/webgl/8.png",j="/blog/webgl/9.png",q="/blog/webgl/10.png",P="/blog/webgl/11.png",S="/blog/webgl/12.png",M="/blog/webgl/13.png",E="/blog/webgl/14.png",A="/blog/webgl/15.png",T="/blog/webgl/16.png",R="/blog/webgl/17.png",B="/blog/webgl/18.png",z="/blog/webgl/19.png",F="/blog/webgl/20.png",O="/blog/webgl/21.png",I="/blog/webgl/22.png",C="/blog/webgl/23.png",L="/blog/webgl/24.png",U="/blog/webgl/25.png",V="/blog/webgl/26.png",D="/blog/webgl/27.png",W="/blog/webgl/28.png",N="/blog/webgl/29.png",c="/blog/webgl/30.png",Y="/blog/webgl/31.png",X="/blog/webgl/32.png",H="/blog/webgl/33.gif",G="/blog/webgl/34.png",Z="/blog/webgl/35.png",Q="/blog/webgl/36.png",K="/blog/webgl/37.png",J="/blog/webgl/38.png",$="/blog/webgl/39.png",nn="/blog/webgl/40.png",sn="/blog/webgl/41.png",an="/blog/webgl/42.png",pn="/blog/webgl/43.png",tn="/blog/webgl/44.png",en="/blog/webgl/45.png",on="/blog/webgl/46.png",cn="/blog/webgl/47.png",ln="/blog/webgl/48.png",un="/blog/webgl/50.gif",rn="/blog/webgl/50.jpg",kn="/blog/webgl/51.jpg",bn="/blog/webgl/52.jpg",mn="/blog/webgl/53.png",dn="/blog/webgl/54.png",gn="/blog/webgl/55.png",vn="/blog/webgl/56.png",fn="/blog/webgl/57.png",l="/blog/webgl/58.png",yn="/blog/webgl/59.png",xn="/blog/webgl/60.png",hn="/blog/webgl/61.png",wn="/blog/webgl/62.png",_n="/blog/webgl/63.png",jn="/blog/webgl/64.png",u="/blog/webgl/65.png",r="/blog/webgl/66.png",qn="/blog/webgl/67.png",Pn="/blog/webgl/68.png",Sn="/blog/webgl/69.png",i="/blog/webgl/70.png",Mn="/blog/webgl/71.png",En="/blog/webgl/72.png",a="/blog/webgl/73.png",An="/blog/webgl/74.png",Tn="/blog/webgl/75.png",Rn="/blog/webgl/76.png",Bn="/blog/webgl/77.png",zn="/blog/webgl/78.png",Fn="/blog/webgl/79.png";const On={},In=p('<h1 id="webgl" tabindex="-1"><a class="header-anchor" href="#webgl" aria-hidden="true">#</a> WebGL</h1><h2 id="\u4E00\u3001webgl-\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001webgl-\u4ECB\u7ECD" aria-hidden="true">#</a> \u4E00\u3001WebGL-\u4ECB\u7ECD</h2><blockquote><p>WebGL\uFF08\u5168\u5199 Web Graphics Library\uFF09\u662F\u4E00\u79CD 3D \u7ED8\u56FE\u534F\u8BAE\uFF0C\u8FD9\u79CD\u7ED8\u56FE\u6280\u672F\u6807\u51C6\u5141\u8BB8\u628A JavaScript \u548C OpenGL ES 2.0 \u7ED3\u5408\u5728\u4E00\u8D77\uFF0C\u901A\u8FC7\u589E\u52A0 OpenGL ES 2.0 \u7684\u4E00\u4E2A JavaScript \u7ED1\u5B9A\uFF0CWebGL \u53EF\u4EE5\u4E3A HTML5 Canvas \u63D0\u4F9B\u786C\u4EF6 3D \u52A0\u901F\u6E32\u67D3\uFF0C\u8FD9\u6837 Web \u5F00\u53D1\u4EBA\u5458\u5C31\u53EF\u4EE5\u501F\u52A9\u7CFB\u7EDF\u663E\u5361\u6765\u5728\u6D4F\u89C8\u5668\u91CC\u66F4\u6D41\u7545\u5730\u5C55\u793A 3D \u573A\u666F\u548C\u6A21\u578B\u4E86\uFF0C\u8FD8\u80FD\u521B\u5EFA\u590D\u6742\u7684\u5BFC\u822A\u548C\u6570\u636E\u89C6\u89C9\u5316\u3002\u663E\u7136\uFF0CWebGL \u6280\u672F\u6807\u51C6\u514D\u53BB\u4E86\u5F00\u53D1\u7F51\u9875\u4E13\u7528\u6E32\u67D3\u63D2\u4EF6\u7684\u9EBB\u70E6\uFF0C\u53EF\u88AB\u7528\u4E8E\u521B\u5EFA\u5177\u6709\u590D\u6742 3D \u7ED3\u6784\u7684\u7F51\u7AD9\u9875\u9762\uFF0C\u751A\u81F3\u53EF\u4EE5\u7528\u6765\u8BBE\u8BA1 3D \u7F51\u9875\u6E38\u620F\u7B49\u7B49</p></blockquote><p><img src="'+v+`" alt=""></p><h2 id="\u4E8C\u3001webgl-\u57FA\u7840\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001webgl-\u57FA\u7840\u77E5\u8BC6" aria-hidden="true">#</a> \u4E8C\u3001webgl \u57FA\u7840\u77E5\u8BC6</h2><h3 id="_1-\u5237\u5E95\u8272" tabindex="-1"><a class="header-anchor" href="#_1-\u5237\u5E95\u8272" aria-hidden="true">#</a> 1.\u5237\u5E95\u8272</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5728js\u4E2D\u83B7\u53D6canvas\u753B\u5E03</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token comment">// \u4F7F\u7528canvas \u83B7\u53D6webgl \u7ED8\u56FE\u4E0A\u4E0B\u6587</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u6307\u5B9A\u5C06\u8981\u7528\u6765\u6E05\u7A7A\u7ED8\u56FE\u533A\u7684\u989C\u8272 rgba</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u5237\u5E95\u8272</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>\u6CE8\uFF1AclearColor(r,g,b,a) \u4E2D\u7684\u53C2\u6570\u662F\u7EA2\u3001\u7EFF\u3001\u84DD\u3001\u900F\u660E\u5EA6\uFF0C\u5176\u5B9A\u4E49\u57DF\u662F[0,1]</strong></p><h3 id="_2-webgl-\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_2-webgl-\u5750\u6807\u7CFB" aria-hidden="true">#</a> 2.webgl \u5750\u6807\u7CFB</h3><blockquote><p>canvas 2d \u753B\u5E03\u7684\u5750\u6807\u7CFB<br> canvas 2d \u5750\u6807\u7CFB\u7684\u539F\u70B9\u5728\u5DE6\u4E0A\u89D2<br> canvas 2d \u5750\u6807\u7CFB\u7684 y \u8F74\u65B9\u5411\u662F\u671D\u4E0B\u7684<br> canvas 2d \u5750\u6807\u7CFB\u7684\u5750\u6807\u57FA\u5E95\u6709\u4E24\u4E2A\u5206\u91CF\uFF0C\u5206\u522B\u662F\u4E00\u4E2A\u50CF\u7D20\u7684\u5BBD\u548C\u4E00\u4E2A\u50CF\u7D20\u7684\u9AD8\uFF0C\u5373 1 \u4E2A\u5355\u4F4D\u7684\u5BBD\u4FBF\u662F 1 \u4E2A\u50CF\u7D20\u7684\u5BBD\uFF0C1 \u4E2A\u5355\u4F4D\u7684\u9AD8\u4FBF\u662F\u4E00\u4E2A\u50CF\u7D20\u7684\u9AD8</p></blockquote><p><img src="`+o+'" alt=""></p><blockquote><p>webgl \u7684\u5750\u6807\u7CFB<br> webgl \u5750\u6807\u7CFB\u7684\u5750\u6807\u539F\u70B9\u5728\u753B\u5E03\u4E2D\u5FC3<br> webgl \u5750\u6807\u7CFB\u7684 y \u8F74\u65B9\u5411\u662F\u671D\u4E0A\u7684<br> webgl \u5750\u6807\u57FA\u5E95\u4E2D\u7684\u4E24\u4E2A\u5206\u91CF\u5206\u522B\u662F\u534A\u4E2A canvas \u7684\u5BBD\u548C canvas \u7684\u9AD8\uFF0C\u5373 1 \u4E2A\u5355\u4F4D\u7684\u5BBD\u4FBF\u662F\u534A\u4E2A\u4E2A canvas \u7684\u5BBD\uFF0C1 \u4E2A\u5355\u4F4D\u7684\u9AD8\u4FBF\u662F\u534A\u4E2A canvas \u7684\u9AD8</p></blockquote><p><img src="'+f+`" alt=""></p><h3 id="_3-webgl-\u753B\u4E00\u4E2A\u70B9" tabindex="-1"><a class="header-anchor" href="#_3-webgl-\u753B\u4E00\u4E2A\u70B9" aria-hidden="true">#</a> 3.webgl \u753B\u4E00\u4E2A\u70B9</h3><h4 id="_1-\u7ED8\u56FE\u7684\u57FA\u672C\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_1-\u7ED8\u56FE\u7684\u57FA\u672C\u6B65\u9AA4" aria-hidden="true">#</a> 1) \u7ED8\u56FE\u7684\u57FA\u672C\u6B65\u9AA4</h4><ol><li><p>\u627E\u4E00\u5F20\u753B\u5E03</p></li><li><p>\u627E\u4E00\u652F\u753B\u7B14</p></li><li><p>\u5F00\u59CB\u753B\u753B</p></li></ol><p><strong>canvas 2d \u7684\u7ED8\u56FE\u903B\u8F91\u5C31\u662F\u5982\u6B64</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//canvas\u753B\u5E03</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u4E8C\u7EF4\u753B\u7B14</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u8BBE\u7F6E\u753B\u7B14\u7684\u989C\u8272</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//\u7528\u753B\u7B14\u753B\u4E00\u4E2A\u77E9\u5F62</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-canvas-2d-\u548C-webgl-\u7ED8\u56FE\u7684\u5DEE\u5F02" tabindex="-1"><a class="header-anchor" href="#_2-canvas-2d-\u548C-webgl-\u7ED8\u56FE\u7684\u5DEE\u5F02" aria-hidden="true">#</a> 2) canvas 2d \u548C webgl \u7ED8\u56FE\u7684\u5DEE\u5F02</h4><blockquote><p>\u6D4F\u89C8\u5668\u6709\u4E09\u5927\u7EBF\u7A0B\uFF1A js \u5F15\u64CE\u7EBF\u7A0B\u3001GUI \u6E32\u67D3\u7EBF\u7A0B\u3001\u6D4F\u89C8\u5668\u4E8B\u4EF6\u89E6\u53D1\u7EBF\u7A0B<br> GUI \u6E32\u67D3\u7EBF\u7A0B\u5C31\u662F\u7528\u4E8E\u6E32\u56FE\uFF0C\uFF0C\u5728\u8FD9\u4E2A\u6E32\u67D3\u7EBF\u7A0B\u91CC\uFF0C\u6709\u8D1F\u8D23\u4E0D\u540C\u6E32\u67D3\u5DE5\u4F5C\u7684\u5DE5\u4EBA\u3002\u6BD4\u5982\u6709\u8D1F\u8D23\u6E32\u67D3 HTML+css \u7684\u5DE5\u4EBA\uFF0C\u6709\u8D1F\u8D23\u6E32\u67D3\u4E8C\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA\uFF0C\u6709\u8D1F\u8D23\u6E32\u67D3\u4E09\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA<br> \u6E32\u67D3\u4E8C\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA\u8BF4\u7684\u662F js \u8BED\u8A00<br> \u6E32\u67D3\u4E09\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA\u8BF4\u7684\u662F GLSL ES \u8BED\u8A00<br> GLSL ES &lt;=&gt; \u7A0B\u5E8F\u5BF9\u8C61 &lt;=&gt; js</p></blockquote><h4 id="_3-webgl-\u7684\u7ED8\u56FE\u601D\u8DEF\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_3-webgl-\u7684\u7ED8\u56FE\u601D\u8DEF\u6B65\u9AA4" aria-hidden="true">#</a> 3) webgl \u7684\u7ED8\u56FE\u601D\u8DEF\u6B65\u9AA4</h4><ol><li>\u627E\u4E00\u53F0\u7535\u8111 - \u6D4F\u89C8\u5668\u91CC\u5185\u7F6E\u7684 webgl \u6E32\u67D3\u5F15\u64CE\uFF0C\u8D1F\u8D23\u6E32\u67D3 webgl \u56FE\u5F62\uFF0C\u53EA\u8BA4 GLSL ES \u8BED\u8A00</li><li>\u627E\u4E00\u5757\u624B\u7ED8\u677F - \u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u627F\u8F7D GLSL ES \u8BED\u8A00\uFF0C\u7FFB\u8BD1 GLSL ES \u8BED\u8A00\u548C js \u8BED\u8A00\uFF0C\u4F7F\u4E24\u8005\u53EF\u4EE5\u76F8\u4E92\u901A\u4FE1</li><li>\u627E\u4E00\u652F\u89E6\u63A7\u7B14 - \u901A\u8FC7 canvas \u83B7\u53D6\u7684 webgl \u7C7B\u578B\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u5411\u624B\u7ED8\u677F\u4F20\u9012\u7ED8\u56FE\u547D\u4EE4\uFF0C\u5E76\u63A5\u6536\u624B\u7ED8\u677F\u7684\u72B6\u6001\u4FE1\u606F</li><li>\u5F00\u59CB\u753B\u753B - \u901A\u8FC7 webgl \u7C7B\u578B\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u7528 js \u753B\u753B</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u70B9\u4F4D</span>
    gl_Position<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C3A\u5BF8</span>
    gl_PointSize<span class="token operator">=</span><span class="token number">50.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7247\u5143\u7684\u989C\u8272</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// canvas \u753B\u5E03</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token comment">//\u529F\u80FD\uFF1A\u89E3\u6790\u7740\u8272\u5668\u6587\u672C\uFF0C\u6574\u5408\u5230\u7A0B\u5E8F\u5BF9\u8C61\u91CC\uFF0C\u5173\u8054webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u5B9E\u73B0\u4E24\u79CD\u8BED\u8A00\u7684\u76F8\u4E92\u901A\u4FE1</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">initShaders</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u521B\u5EFA\u7A0B\u5E8F\u5BF9\u8C61</span>
    <span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5EFA\u7ACB\u7740\u8272\u5BF9\u8C61</span>
    <span class="token keyword">const</span> vertexShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fragmentShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u628A\u9876\u70B9\u7740\u8272\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u628A\u7247\u5143\u7740\u8272\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8FDE\u63A5webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\u548C\u7A0B\u5E8F\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u542F\u52A8\u7A0B\u5E8F\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u7A0B\u5E8F\u5BF9\u8C61\u6302\u5230\u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A</span>
    gl<span class="token punctuation">.</span>program <span class="token operator">=</span> program<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u6839\u636E\u7740\u8272\u7C7B\u578B\uFF0C\u5EFA\u7ACB\u7740\u8272\u5668\u5BF9\u8C61</span>
    <span class="token keyword">const</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u7740\u8272\u5668\u6E90\u6587\u4EF6\u4F20\u5165\u7740\u8272\u5668\u5BF9\u8C61\u4E2D</span>
    gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u7F16\u8BD1\u7740\u8272\u5668\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8FD4\u56DE\u7740\u8272\u5668\u5BF9\u8C61</span>
    <span class="token keyword">return</span> shader<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h4 id="_4-webgl-\u7740\u8272\u5668" tabindex="-1"><a class="header-anchor" href="#_4-webgl-\u7740\u8272\u5668" aria-hidden="true">#</a> 4) webgl \u7740\u8272\u5668</h4><p>webgl \u7ED8\u56FE\u9700\u8981\u4E24\u79CD\u7740\u8272\u5668\uFF1A</p><ul><li>\u9876\u70B9\u7740\u8272\u5668\uFF08Vertex shader\uFF09\uFF1A\u63CF\u8FF0\u9876\u70B9\u7684\u7279\u5F81\uFF0C\u5982\u4F4D\u7F6E\u3001\u989C\u8272\u7B49</li><li>\u7247\u5143\u7740\u8272\u5668\uFF08Fragment shader\uFF09\uFF1A\u8FDB\u884C\u9010\u7247\u5143\u5904\u7406\uFF0C\u5982\u5149\u7167 <blockquote><p>\u4E24\u70B9\u51B3\u5B9A\u4E00\u6761\u76F4\u7EBF\uFF0C\u9876\u70B9\u7740\u8272\u5668\u91CC\u7684\u9876\u70B9\u5C31\u662F\u51B3\u5B9A\u8FD9\u4E00\u6761\u76F4\u7EBF\u7684\u4E24\u4E2A\u70B9\uFF0C\u7247\u5143\u7740\u8272\u5668\u91CC\u7684\u7247\u5143\u5C31\u662F\u628A\u76F4\u7EBF\u753B\u5230\u753B\u5E03\u4E0A\u540E\uFF0C\u8FD9\u4E24\u4E2A\u70B9\u4E4B\u95F4\u6784\u6210\u76F4\u7EBF\u7684\u6BCF\u4E2A\u50CF\u7D20</p></blockquote></li></ul><h2 id="\u4E09\u3001js-\u4E0E\u7740\u8272\u5668\u95F4\u7684\u6570\u636E\u4F20\u8F93" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001js-\u4E0E\u7740\u8272\u5668\u95F4\u7684\u6570\u636E\u4F20\u8F93" aria-hidden="true">#</a> \u4E09\u3001js \u4E0E\u7740\u8272\u5668\u95F4\u7684\u6570\u636E\u4F20\u8F93</h2><h3 id="_1-js-\u63A7\u5236\u9876\u70B9\u4F4D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_1-js-\u63A7\u5236\u9876\u70B9\u4F4D\u7F6E" aria-hidden="true">#</a> 1. js \u63A7\u5236\u9876\u70B9\u4F4D\u7F6E</h3><blockquote><p>attribute \u53D8\u91CF\u662F\u53EA\u6709\u9876\u70B9\u7740\u8272\u5668\u624D\u80FD\u4F7F\u7528\u5B83\u7684<br> js \u53EF\u4EE5\u901A\u8FC7 attribute \u53D8\u91CF\u5411\u9876\u70B9\u7740\u8272\u5668\u4F20\u9012\u4E0E\u9876\u70B9\u76F8\u5173\u7684\u6570\u636E</p></blockquote><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">50.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u7247\u5143\u7684\u989C\u8272</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
   * \u83B7\u53D6attribute \u53D8\u91CF
   * gl.getAttribLocation() \u662F\u83B7\u53D6\u7740\u8272\u5668\u4E2Dattribute \u53D8\u91CF\u7684\u65B9\u6CD5
   * gl.program \u662F\u521D\u59CB\u5316\u7740\u8272\u5668\u65F6\uFF0C\u5728\u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A\u6302\u8F7D\u7684\u7A0B\u5E8F\u5BF9\u8C61
   * &#39;a_Position&#39; \u662F\u7740\u8272\u5668\u66B4\u9732\u51FA\u7684\u53D8\u91CF\u540D
   */</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// gl.vertexAttrib2f(a_Position, 0.5, 0.5);</span>
  <span class="token comment">// gl.vertexAttrib1f(a_Position, 0.1);</span>

  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="_2-\u9F20\u6807\u63A7\u5236\u70B9\u4F4D" tabindex="-1"><a class="header-anchor" href="#_2-\u9F20\u6807\u63A7\u5236\u70B9\u4F4D" aria-hidden="true">#</a> 2. \u9F20\u6807\u63A7\u5236\u70B9\u4F4D</h3><ol><li>canvas \u5750\u6807\u7CFB\u8F6C webgl \u5750\u6807\u7CFB</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">//\u89E3\u51B3\u5750\u6807\u539F\u70B9\u4F4D\u7F6E\u7684\u5DEE\u5F02</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// \u89E3\u51B3y \u65B9\u5411\u7684\u5DEE\u5F02</span>
  <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
  <span class="token comment">//\u89E3\u51B3\u5750\u6807\u57FA\u5E95\u7684\u5DEE\u5F02</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="2"><li>\u4FEE\u6539 attribute \u53D8\u91CF <ol><li>\u83B7\u53D6 attribute \u53D8\u91CF</li><li>\u5728\u83B7\u53D6\u9F20\u6807\u5728 webgl \u753B\u5E03\u4E2D\u7684\u4F4D\u7F6E\u7684\u65F6\u5019\uFF0C\u4FEE\u6539 attribute \u53D8\u91CF</li><li>\u6E05\u7406\u753B\u5E03</li><li>\u7ED8\u56FE</li></ol></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>webgl \u7684\u540C\u6B65\u7ED8\u56FE\u539F\u7406 <blockquote><p>gl.drawArrays(gl.POINTS, 0, 1) \u65B9\u6CD5\u548C canvas 2d \u91CC\u7684 ctx.draw() \u65B9\u6CD5\u662F\u4E0D\u4E00\u6837\u7684\uFF0Cctx.draw() \u771F\u7684\u50CF\u753B\u753B\u4E00\u6837\uFF0C\u4E00\u5C42\u4E00\u5C42\u7684\u8986\u76D6\u56FE\u50CF<br> gl.drawArrays() \u65B9\u6CD5\u53EA\u4F1A\u540C\u6B65\u7ED8\u56FE\uFF0C\u8D70\u5B8C\u4E86 js \u4E3B\u7EBF\u7A0B\u540E\uFF0C\u518D\u6B21\u7ED8\u56FE\u65F6\uFF0C\u5C31\u4F1A\u4ECE\u5934\u518D\u6765\u3002\u4E5F\u5C31\u8BF4\uFF0C\u5F02\u6B65\u6267\u884C\u7684 drawArrays() \u65B9\u6CD5\u4F1A\u628A\u753B\u5E03\u4E0A\u7684\u56FE\u50CF\u90FD\u5237\u6389\uFF1A<br> \u539F\u7406 =&gt; webgl \u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u662F\u5148\u5728\u989C\u8272\u7F13\u51B2\u533A\u4E2D\u753B\u51FA\u6765\uFF0C\u989C\u8272\u7F13\u51B2\u533A\u4E2D\u5B58\u50A8\u7684\u56FE\u50CF\uFF0C\u53EA\u5728\u5F53\u524D\u7EBF\u7A0B\u6709\u6548\u3002\u6BD4\u5982\u6211\u4EEC\u5148\u5728 js \u4E3B\u7EBF\u7A0B\u4E2D\u7ED8\u56FE\uFF0C\u4E3B\u7EBF\u7A0B\u7ED3\u675F\u540E\uFF0C\u4F1A\u518D\u53BB\u6267\u884C\u4FE1\u606F\u961F\u5217\u91CC\u7684\u5F02\u6B65\u7EBF\u7A0B\u3002\u5728\u6267\u884C\u5F02\u6B65\u7EBF\u7A0B\u65F6\uFF0C\u989C\u8272\u7F13\u51B2\u533A\u5C31\u4F1A\u88AB webgl \u7CFB\u7EDF\u91CD\u7F6E</p></blockquote></li></ol><p><strong>\u9F20\u6807\u7ED8\u5236\u591A\u4E2A\u70B9</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> g_points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

  g_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  g_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3-js-\u63A7\u5236\u9876\u70B9\u5C3A\u5BF8" tabindex="-1"><a class="header-anchor" href="#_3-js-\u63A7\u5236\u9876\u70B9\u5C3A\u5BF8" aria-hidden="true">#</a> 3. js \u63A7\u5236\u9876\u70B9\u5C3A\u5BF8</h3><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute float a_PointSize<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span>a_PointSize<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p><strong>\u9F20\u6807\u968F\u673A\u6539\u53D8\u9876\u70B9\u5927\u5C0F</strong></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute float a_PointSize<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span>a_PointSize<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u9876\u70B9</span>
  <span class="token keyword">const</span> a_points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//\u89E3\u51B3\u5750\u6807\u539F\u70B9\u4F4D\u7F6E\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u89E3\u51B3y \u65B9\u5411\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
    <span class="token comment">//\u89E3\u51B3\u5750\u6807\u57FA\u5E95\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> size <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
    a_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h3 id="_4-js-\u63A7\u5236\u9876\u70B9\u7684\u989C\u8272" tabindex="-1"><a class="header-anchor" href="#_4-js-\u63A7\u5236\u9876\u70B9\u7684\u989C\u8272" aria-hidden="true">#</a> 4. js \u63A7\u5236\u9876\u70B9\u7684\u989C\u8272</h3><p><strong>\u9650\u5B9A\u989C\u8272\u53D8\u91CF\u7684\u9650\u5B9A\u7B26\u53EB uniform</strong></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">50.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_FragColor<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>u_FragColor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u83B7\u53D6uniform \u53D8\u91CF</span>
  <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u4FEE\u6539uniform \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p><strong>\u9F20\u6807\u968F\u673A\u6539\u53D8\u9876\u70B9\u989C\u8272</strong></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute float a_PointSize<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span>a_PointSize<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_FragColor<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>u_FragColor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u83B7\u53D6attribute \u548C uniform \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> a_points <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">r</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//\u89E3\u51B3\u5750\u6807\u539F\u70B9\u4F4D\u7F6E\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u89E3\u51B3y \u65B9\u5411\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
    <span class="token comment">//\u89E3\u51B3\u5750\u6807\u57FA\u5E95\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> size <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">r</span><span class="token operator">:</span> n<span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> n<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    a_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// gl.uniform4f(u_FragColor, r, g, b, a);</span>
      <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Float32Array \u662F\u4E00\u79CD32 \u4F4D\u7684\u6D6E\u70B9\u578B\u6570\u7EC4\uFF0C\u5B83\u5728\u6D4F\u89C8\u5668\u4E2D\u7684\u8FD0\u884C\u6548\u7387\u8981\u6BD4\u666E\u901A\u7684Array \u9AD8\u5F88\u591A</span>
      gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><h2 id="\u56DB\u3001\u7ED8\u5236\u56FE\u5F62" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001\u7ED8\u5236\u56FE\u5F62" aria-hidden="true">#</a> \u56DB\u3001\u7ED8\u5236\u56FE\u5F62</h2><p><strong>\u4E09\u89D2\u5F62\u662F\u4E00\u4E2A\u6700\u7B80\u5355\u3001\u6700\u7A33\u5B9A\u7684\u9762\uFF0Cwebgl \u4E2D\u7684\u4E09\u7EF4\u6A21\u578B\u90FD\u662F\u7531\u4E09\u89D2\u9762\u7EC4\u6210\u7684</strong></p><h3 id="_1-webgl-\u7684\u7ED8\u56FE\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1-webgl-\u7684\u7ED8\u56FE\u65B9\u5F0F" aria-hidden="true">#</a> 1.webgl \u7684\u7ED8\u56FE\u65B9\u5F0F</h3><ul><li><p>\u7ED8\u5236\u591A\u70B9<br><img src="`+y+'" alt=""></p></li><li><p>\u5982\u679C\u662F\u7EBF\uFF0C\u5C31\u8FDE\u70B9\u6210\u7EBF<br><img src="'+x+'" alt=""></p></li><li><p>\u5982\u679C\u662F\u9762\uFF0C\u90A3\u5C31\u5728\u56FE\u5F62\u5185\u90E8\uFF0C\u9010\u7247\u5143\u586B\u8272<br><img src="'+h+`" alt=""></p></li></ul><h3 id="_2-\u7ED8\u5236\u591A\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-\u7ED8\u5236\u591A\u70B9" aria-hidden="true">#</a> 2. \u7ED8\u5236\u591A\u70B9</h3><blockquote><p>\u5728 js \u4E2D\u5EFA\u7ACB\u9876\u70B9\u6570\u636E\uFF0C\u7740\u8272\u5668\u80AF\u5B9A\u662F\u62FF\u4E0D\u5230\u7684\uFF0C\u8FD9\u662F\u8BED\u8A00\u4E0D\u901A\u5BFC\u81F4\u7684\uFF0C\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0Cwebgl \u7CFB\u7EDF\u5C31\u5EFA\u7ACB\u4E86\u4E00\u4E2A\u80FD\u7FFB\u8BD1\u53CC\u65B9\u8BED\u8A00\u7684\u7F13\u51B2\u533A<br> js \u53EF\u4EE5\u7528\u7279\u5B9A\u7684\u65B9\u6CD5\u628A\u6570\u636E\u5B58\u5728\u8FD9\u4E2A\u7F13\u51B2\u533A\u4E2D\uFF0C\u7740\u8272\u5668\u53EF\u4EE5\u4ECE\u7F13\u51B2\u533A\u4E2D\u62FF\u5230\u76F8\u5E94\u7684\u6570\u636E</p></blockquote><ol><li>\u5EFA\u7ACB\u9876\u70B9\u6570\u636E\uFF0C\u4E24\u4E2A\u6D6E\u70B9\u6570\u6784\u6210\u4E00\u4E2A\u9876\u70B9\uFF0C\u5206\u522B\u4EE3\u8868 x\u3001y \u503C</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">//x    y</span>
  <span class="token number">0.0</span><span class="token punctuation">,</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token comment">//\u9876\u70B9</span>
  <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token comment">//\u9876\u70B9</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token comment">//\u9876\u70B9</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u8FD9\u4E9B\u9876\u70B9\u6570\u636E\u662F\u5B58\u50A8\u5728js \u7F13\u5B58\u91CC\u7684\uFF0C\u7740\u8272\u5668\u62FF\u4E0D\u5230\uFF0C\u6240\u4EE5\u9700\u8981\u5EFA\u7ACB\u4E00\u4E2A\u7740\u8272\u5668\u548Cjs \u90FD\u80FD\u8FDB\u5165\u7684\u516C\u5171\u533A</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u7F13\u51B2\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u4E0A\u9762\u7684\u8FD9\u4E2A\u7F13\u51B2\u533A\u662F\u72EC\u7ACB\u5B58\u5728\u7684\uFF0C\u5B83\u53EA\u662F\u4E00\u4E2A\u7A7A\u7740\u7684\u4ED3\u5E93\uFF0C\u548C\u8C01\u90FD\u6CA1\u6709\u5173\u7CFB\u3002\u63A5\u4E0B\u5C31\u8BA9\u5176\u548C\u7740\u8272\u5668\u5EFA\u7ACB\u8FDE\u63A5</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// gl.bindBuffer(target,buffer)   \u7ED1\u5B9A\u7F13\u51B2\u533A</span>
<span class="token comment">// - target  \u8981\u628A\u7F13\u51B2\u533A\u653E\u5728webgl \u7CFB\u7EDF\u4E2D\u7684\u4EC0\u4E48\u4F4D\u7F6E</span>
<span class="token comment">// - buffer \u7F13\u51B2\u533A</span>

<span class="token comment">// \u7740\u8272\u5668\u5BF9\u8C61\u5728\u6267\u884CinitShaders() \u521D\u59CB\u5316\u65B9\u6CD5\u7684\u65F6\u5019\uFF0C\u5DF2\u7ECF\u88AB\u5199\u5165webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61gl \u4E2D\u4E86\u3002</span>
<span class="token comment">// \u5F53\u7F13\u51B2\u533A\u548C\u7740\u8272\u5668\u5EFA\u7ACB\u4E86\u7ED1\u5B9A\u5173\u7CFB\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u5F80\u8FD9\u5757\u7A7A\u95F4\u5199\u5165\u6570\u636E\u4E86</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>\u5F80\u7F13\u51B2\u533A\u5BF9\u8C61\u4E2D\u5199\u5165\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// bufferData(target, data, usage) \u5C06\u6570\u636E\u5199\u5165\u7F13\u51B2\u533A</span>
<span class="token comment">// - target \u8981\u628A\u7F13\u51B2\u533A\u653E\u5728webgl \u7CFB\u7EDF\u4E2D\u7684\u4EC0\u4E48\u4F4D\u7F6E</span>
<span class="token comment">// - data  \u6570\u636E</span>
<span class="token comment">// - usage \u5411\u7F13\u51B2\u533A\u5199\u5165\u6570\u636E\u7684\u65B9\u5F0F\uFF0C\u54B1\u4EEC\u5728\u8FD9\u91CC\u5148\u77E5\u9053 gl.STATIC_DRAW \u65B9\u5F0F\u5373\u53EF\uFF0C</span>
<span class="token comment">//\u5B83\u662F\u5411\u7F13\u51B2\u533A\u4E2D\u4E00\u6B21\u6027\u5199\u5165\u6570\u636E\uFF0C\u7740\u8272\u5668\u4F1A\u7ED8\u5236\u591A\u6B21\u3002</span>

<span class="token comment">// \u73B0\u5728\u7740\u8272\u5668\u867D\u7136\u7ED1\u5B9A\u4E86\u7F13\u51B2\u533A\uFF0C\u53EF\u4EE5\u8BBF\u95EE\u91CC\u9762\u7684\u6570\u636E\u4E86\uFF0C\u4F46\u662F\u6211\u4EEC\u8FD8\u5F97\u8BA9\u7740\u8272\u5668\u77E5\u9053\u8FD9\u4E2A\u4ED3\u5E93\u662F\u7ED9\u54EA\u4E2A\u53D8\u91CF\u7684\uFF0C</span>
<span class="token comment">//\u6BD4\u5982\u54B1\u4EEC\u8FD9\u91CC\u7528\u4E8E\u63A7\u5236\u70B9\u4F4D\u7684attribute \u53D8\u91CF\u3002\u8FD9\u6837\u505A\u662F\u4E3A\u4E86\u63D0\u9AD8\u7ED8\u56FE\u6548\u7387\u3002</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="5"><li>\u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u5206\u914D\u7ED9 attribute \u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// gl.vertexAttribPointer(local,size,type,normalized,stride,offset)   \u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u5206\u914D\u7ED9attribute \u53D8\u91CF</span>

<span class="token comment">// - local  attribute\u53D8\u91CF</span>
<span class="token comment">// - size \u9876\u70B9\u5206\u91CF\u7684\u4E2A\u6570\uFF0C\u6BD4\u5982\u6211\u4EEC\u7684vertices \u6570\u7EC4\u4E2D\uFF0C\u4E24\u4E2A\u6570\u636E\u8868\u793A\u4E00\u4E2A\u9876\u70B9\uFF0C\u90A3\u54B1\u4EEC\u5C31\u51992</span>
<span class="token comment">// - type \u6570\u636E\u7C7B\u578B\uFF0C\u6BD4\u5982 gl.FLOAT \u6D6E\u70B9\u578B</span>
<span class="token comment">// - normalized \u662F\u5426\u5C06\u9876\u70B9\u6570\u636E\u5F52\u4E00</span>
<span class="token comment">// - stride \u76F8\u90BB\u4E24\u4E2A\u9876\u70B9\u95F4\u7684\u5B57\u8282\u6570\uFF0C\u6211\u7684\u4F8B\u5B50\u91CC\u5199\u7684\u662F0\uFF0C\u90A3\u5C31\u662F\u9876\u70B9\u4E4B\u95F4\u662F\u7D27\u6328\u7740\u7684</span>
<span class="token comment">// - offset \u4ECE\u7F13\u51B2\u533A\u7684\u4EC0\u4E48\u4F4D\u7F6E\u5F00\u59CB\u5B58\u50A8\u53D8\u91CF\uFF0C\u6211\u7684\u4F8B\u5B50\u91CC\u5199\u7684\u662F0\uFF0C\u90A3\u5C31\u662F\u4ECE\u5934\u5F00\u59CB\u5B58\u50A8\u53D8\u91CF</span>

<span class="token comment">// \u5230\u4E86\u8FD9\u91CC\uFF0C\u7740\u8272\u5C31\u77E5\u9053\u7F13\u51B2\u533A\u7684\u6570\u636E\u662F\u7ED9\u8C01\u7684\u4E86\u3002\u56E0\u4E3A\u7F13\u51B2\u533A\u91CC\u7684\u9876\u70B9\u6570\u636E\u662F\u6570\u7EC4\uFF0C\u91CC\u9762\u6709\u591A\u4E2A\u9876\u70B9\u3002</span>
<span class="token comment">//\u6240\u4EE5\u5F97\u5F00\u542F\u4E00\u4E2A\u8BA9\u7740\u8272\u5668\u6279\u91CF\u5904\u7406\u9876\u70B9\u6570\u636E\u7684\u5C5E\u6027\u3002\u9ED8\u8BA4\u7740\u8272\u5668\u53EA\u4F1A\u4E00\u4E2A\u4E00\u4E2A\u7684\u63A5\u6536\u9876\u70B9\u6570\u636E\uFF0C\u7136\u540E\u4E00\u4E2A\u4E00\u4E2A\u7684\u7ED8\u5236\u9876\u70B9\u3002</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="6"><li>\u5F00\u542F\u9876\u70B9\u6570\u636E\u7684\u6279\u5904\u7406\u529F\u80FD</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// - location attribute\u53D8\u91CF</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="7"><li>\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// drawArrays(mode,first,count)</span>

<span class="token comment">// - mode \u7ED8\u56FE\u6A21\u5F0F\uFF0C\u6BD4\u5982 gl.POINTS \u753B\u70B9</span>
<span class="token comment">// - first \u4ECE\u54EA\u4E2A\u9876\u70B9\u5F00\u59CB\u7ED8\u5236</span>
<span class="token comment">// - count \u8981\u753B\u591A\u5C11\u4E2A\u9876\u70B9</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>\u6574\u4F53\u4EE3\u7801</strong></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">50.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5982\u4F55\u5411attribute \u53D8\u91CF\u4E2D\u5199\u5165\u591A\u70B9\uFF0C\u5E76\u7ED8\u5236\u591A\u70B9</span>
  <span class="token comment">//\u9876\u70B9\u6570\u636E</span>
  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="_3-\u7ED8\u5236\u56FE\u5F62" tabindex="-1"><a class="header-anchor" href="#_3-\u7ED8\u5236\u56FE\u5F62" aria-hidden="true">#</a> 3. \u7ED8\u5236\u56FE\u5F62</h3><ol><li>\u7ED8\u5236\u4E09\u89D2\u9762</li></ol><ul><li>\u9876\u70B9\u7740\u8272\u5668\u4E2D\u7684 gl_PointSize = 20.0 \u4E0D\u8981\uFF0C\u56E0\u4E3A\u8FD9\u4E2A\u5C5E\u6027\u662F\u63A7\u5236\u9876\u70B9\u5927\u5C0F\u7684\uFF0C\u54B1\u4EEC\u5DF2\u7ECF\u4E0D\u9700\u8981\u663E\u793A\u9876\u70B9\u4E86\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
        <span class="token comment">//gl_PointSize = 20.0;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>\u5728 js \u4E2D\u4FEE\u6539\u7ED8\u56FE\u65B9\u5F0F</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// gl.drawArrays(gl.POINTS, 0, 3);</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>gl.TRIANGLES \u5C31\u662F\u7ED8\u5236\u4E09\u89D2\u9762</strong></p><p><img src="`+w+'" alt=""></p><ol start="2"><li>\u57FA\u672C\u56FE\u5F62</li></ol><p>gl.drawArrays(mode,first,count) \u65B9\u6CD5\u53EF\u4EE5\u7ED8\u5236\u4E00\u4E0B\u56FE\u5F62\uFF1A</p><ul><li><p>POINTS \u53EF\u89C6\u7684\u70B9</p></li><li><p>LINES \u5355\u72EC\u7EBF\u6BB5</p></li><li><p>LINE_STRIP \u7EBF\u6761</p></li><li><p>LINE_LOOP \u95ED\u5408\u7EBF\u6761</p></li><li><p>TRIANGLES \u5355\u72EC\u4E09\u89D2\u5F62</p></li><li><p>TRIANGLE_STRIP \u4E09\u89D2\u5E26</p></li><li><p>TRIANGLE_FAN \u4E09\u89D2\u6247</p><p><strong>2.1 \u70B9\u7684\u7ED8\u5236</strong><br> POINTS \u53EF\u89C6\u7684\u70B9</p><p><img src="'+_+'" alt=""></p><p>\u4E0A\u9762\u516D\u4E2A\u70B9\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1Av0, v1, v2, v3, v4, v5</p><p><strong>2.2 \u7EBF\u7684\u7ED8\u5236</strong></p><ol><li>LINES \u5355\u72EC\u7EBF\u6BB5</li></ol><p><img src="'+j+'" alt=""></p><p>\u4E0A\u9762\u4E09\u6761\u6709\u5411\u7EBF\u6BB5\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1A<br> \u200B v0&gt;v1<br> \u200B v2&gt;v3<br> \u200B v4&gt;v5</p><ol start="2"><li>LINE_STRIP \u7EBF\u6761</li></ol><p><img src="'+q+'" alt=""></p><p>\u4E0A\u9762\u7EBF\u6761\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1Av0&gt;v1&gt;v2&gt;v3&gt;v4&gt;v5</p><ol start="3"><li>LINE_LOOP \u95ED\u5408\u7EBF\u6761</li></ol><p><img src="'+P+'" alt=""></p><p>\u4E0A\u9762\u7EBF\u6761\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1Av0&gt;v1&gt;v2&gt;v3&gt;v4&gt;v5&gt;v0</p><p><strong>2.3 \u9762\u7684\u7ED8\u5236</strong></p><p>\u5BF9\u4E8E\u9762\u7684\u7ED8\u5236\uFF0C\u6211\u4EEC\u9996\u5148\u8981\u77E5\u9053\u4E00\u4E2A\u539F\u7406\uFF1A</p><ul><li>\u9762\u6709\u6B63\u53CD\u4E24\u9762\u3002</li><li>\u9762\u5411\u6211\u4EEC\u7684\u9762\uFF0C\u5982\u679C\u662F\u6B63\u9762\uFF0C\u90A3\u5B83\u5FC5\u7136\u662F\u9006\u65F6\u9488\u7ED8\u5236\u7684\uFF1B</li><li>\u9762\u5411\u6211\u4EEC\u7684\u9762\uFF0C\u5982\u679C\u662F\u53CD\u9762\uFF0C\u90A3\u5B83\u5FC5\u7136\u662F\u987A\u65F6\u9488\u7ED8\u5236\u7684\uFF1B</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u770B\u4E0B\u9762\u7684\u4E09\u79CD\u7ED8\u5236\u65B9\u5F0F\uFF1A</p><ol><li>TRIANGLES \u5355\u72EC\u4E09\u89D2\u5F62</li></ol><p><img src="'+S+'" alt=""></p><p>\u4E0A\u9762\u4E24\u4E2A\u9762\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1A\u200B<br> \u200B v0&gt;v1&gt;v2<br> \u200B v3&gt;v4&gt;v5</p><ol start="2"><li>TRIANGLE_STRIP \u4E09\u89D2\u5E26</li></ol><p><img src="'+M+'" alt=""></p><p>\u4E0A\u9762\u56DB\u4E2A\u9762\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1A<br> v0&gt;v1&gt;v2<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E8C\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E8C\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> v2&gt;v1&gt;v3<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> v2&gt;v3&gt;v4<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E8C\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E8C\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> v4&gt;v3&gt;v5</p><p>\u89C4\u5F8B\uFF1A<br> \u7B2C\u4E00\u4E2A\u4E09\u89D2\u5F62\uFF1Av0&gt;v1&gt;v2<br> \u7B2C\u5076\u6570\u4E2A\u4E09\u89D2\u5F62\uFF1A\u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E8C\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E8C\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u7B2C\u5947\u6570\u4E2A\u4E09\u89D2\u5F62\uFF1A\u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62</p><ol start="3"><li>TRIANGLE_FAN \u4E09\u89D2\u6247</li></ol><p><img src="'+E+'" alt=""></p><p>\u4E0A\u9762\u56DB\u4E2A\u9762\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1A<br> \u200B v0&gt;v1&gt;v2<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u6309\u7167\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u987A\u5E8F\uFF0C\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u200B v0&gt;v2&gt;v3<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u6309\u7167\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u987A\u5E8F\uFF0C\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u200B v0&gt;v3&gt;v4<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u6309\u7167\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u987A\u5E8F\uFF0C\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u200B v0&gt;v4&gt;v5</p></li></ul><h3 id="_4-\u7ED8\u5236\u77E9\u5F62" tabindex="-1"><a class="header-anchor" href="#_4-\u7ED8\u5236\u77E9\u5F62" aria-hidden="true">#</a> 4. \u7ED8\u5236\u77E9\u5F62</h3><p>\u9996\u5148\uFF0Cwebgl \u53EF\u4EE5\u7ED8\u5236\u7684\u9762\u53EA\u6709\u4E09\u89D2\u9762\uFF0C\u6240\u4EE5\u8981\u7ED8\u5236\u77E9\u5F62\u9762\u7684\u8BDD\uFF0C\u53EA\u80FD\u7528\u4E24\u4E2A\u4E09\u89D2\u5F62\u53BB\u62FC\u3002</p><ol><li>TRIANGLE_STRIP \u4E09\u89D2\u5E26\u62FC\u77E9\u5F62</li></ol><p><img src="'+A+`" alt=""></p><p>\u4E0A\u9762\u7684\u4E24\u4E2A\u4E09\u89D2\u5F62\u5206\u522B\u662F\uFF1A<br> v0&gt;v1&gt;v2<br> v2&gt;v1&gt;v3</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1.\u5EFA\u7ACB\u9876\u70B9\u6570\u636E(\u4E0B\u9762\u4E24\u4E2A\u6D6E\u70B9\u4EE3\u8868\u4E00\u4E2A\u9876\u70B9\uFF0C\u4F9D\u6B21\u662Fv0\u3001v1\u3001v2\u3001v3\uFF0C\u5982\u4E0A\u56FE\u6240\u793A)</span>
<span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.\u7ED8\u56FE</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+T+`" alt=""></p><h3 id="_5-\u5F02\u6B65\u7ED8\u5236\u591A\u70B9" tabindex="-1"><a class="header-anchor" href="#_5-\u5F02\u6B65\u7ED8\u5236\u591A\u70B9" aria-hidden="true">#</a> 5. \u5F02\u6B65\u7ED8\u5236\u591A\u70B9</h3><blockquote><p>\u5F53\u7F13\u51B2\u533A\u88AB\u7ED1\u5B9A\u5728\u4E86 webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A\u540E\uFF0C\u6211\u4EEC\u5728\u5F02\u6B65\u65B9\u6CD5\u91CC\u76F4\u63A5\u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u5373\u53EF\uFF0C\u9876\u70B9\u7740\u8272\u5668\u5728\u7ED8\u56FE\u7684\u65F6\u5019\u4F1A\u81EA\u52A8\u4ECE\u5176\u4E2D\u8C03\u7528\u6570\u636E\u3002<br> WebGLBuffer \u7F13\u51B2\u533A\u4E2D\u7684\u6570\u636E\u5728\u5F02\u6B65\u65B9\u6CD5\u91CC\u4E0D\u4F1A\u88AB\u91CD\u65B0\u7F6E\u7A7A\u3002</p></blockquote><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">20.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u9876\u70B9\u6570\u636E</span>
  <span class="token keyword">let</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h3 id="_6-\u56FE\u5F62\u8F6C\u9762" tabindex="-1"><a class="header-anchor" href="#_6-\u56FE\u5F62\u8F6C\u9762" aria-hidden="true">#</a> 6.\u56FE\u5F62\u8F6C\u9762</h3><p><strong>\u201C\u780D\u89D2\u201D\uFF0C\u5176\u539F\u7406\u5C31\u662F\u4ECE\u8D77\u70B9\u5C06\u591A\u8FB9\u5F62\u4E2D\u7B26\u5408\u7279\u5B9A\u6761\u4EF6\u7684\u89D2\u9010\u4E2A\u780D\u6389\uFF0C\u7136\u540E\u4FDD\u5B58\u5230\u4E00\u4E2A\u96C6\u5408\u91CC\uFF0C\u76F4\u5230\u628A\u591A\u8FB9\u5F62\u780D\u5F97\u53EA\u5269\u4E0B\u4E00\u4E2A\u4E09\u89D2\u5F62\u4E3A\u6B62\u3002\u8FD9\u65F6\u5019\u96C6\u5408\u91CC\u7684\u6240\u6709\u4E09\u89D2\u5F62\u5C31\u662F\u60F3\u8981\u7684\u72EC\u7ACB\u4E09\u89D2\u5F62</strong></p><h2 id="\u4E94\u3001\u77E9\u9635\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001\u77E9\u9635\u53D8\u6362" aria-hidden="true">#</a> \u4E94\u3001\u77E9\u9635\u53D8\u6362</h2><p>\u53D8\u6362\u6709\u4E09\u79CD\u72B6\u6001\uFF1A\u5E73\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u3002</p><p>\u5F53\u53D8\u6362\u4E00\u4E2A\u56FE\u5F62\u65F6\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F\u5728\u79FB\u52A8\u8FD9\u4E2A\u56FE\u5F62\u7684\u6240\u6709\u9876\u70B9\u3002</p><h3 id="_1-\u5E73\u79FB" tabindex="-1"><a class="header-anchor" href="#_1-\u5E73\u79FB" aria-hidden="true">#</a> 1.\u5E73\u79FB</h3><p>\u5BF9\u56FE\u5F62\u7684\u5E73\u79FB\u5C31\u662F\u5BF9\u56FE\u5F62\u6240\u6709\u9876\u70B9\u7684\u5E73\u79FB</p><p><img src="`+R+`" alt=""></p><p>\u5728\u5B9E\u9645\u4EE3\u7801\u4E2D\uFF0C\u8981\u6709\u4E00\u4E2A\u5411\u91CF\u7684\u6982\u5FF5\uFF0C\u6BD4\u5982 (x,y,z) \uFF0C\u6211\u4EEC\u65E2\u53EF\u4EE5\u8BF4\u5B83\u662F\u4E00\u4E2A\u9876\u70B9\u4F4D\u7F6E\uFF0C\u4E5F\u53EF\u4EE5\u8BF4\u5B83\u662F\u4E00\u4E2A\u5411\u91CF\uFF0C\u9876\u70B9\u7684\u4F4D\u79FB\u5176\u5B9E\u5C31\u662F\u5411\u91CF\u7684\u52A0\u6CD5\u3002</p><p>GLSL ES \u8BED\u8A00\u91CC\u7684\u5411\u91CF\u8FD0\u7B97</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>attribute vec4 a_Position<span class="token punctuation">;</span>
vec4 translation<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token operator">+</span>translation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>a_Position \u662F\u539F\u59CB\u70B9\u4F4D\uFF0C\u5C5E\u4E8E attribute \u53D8\u91CF</li><li>translation \u662F\u9876\u70B9\u7740\u8272\u5668\u91CC\u7684\u79C1\u6709\u53D8\u91CF\uFF0C\u6CA1\u6709\u5411\u5916\u90E8\u66B4\u9732\uFF0C\u5C5E\u4E8E 4 \u7EF4\u5411\u91CF</li><li>a_Position+translation \u4FBF\u662F\u7740\u8272\u5668\u5185\u7684\u5411\u91CF\u52A0\u6CD5\uFF0C\u8FD9\u91CC\u662F\u5BF9\u539F\u59CB\u70B9\u4F4D\u8FDB\u884C\u4F4D\u79FB</li></ul><h3 id="_2-\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-\u65CB\u8F6C" aria-hidden="true">#</a> 2.\u65CB\u8F6C</h3><p>\u7269\u4F53\u7684\u65CB\u8F6C\u65B9\u5411\u662F\u6709\u6B63\u8D1F\u4E4B\u5206\u7684\uFF0C\u5728 webgl \u4E2D\uFF0C\u9664\u88C1\u526A\u7A7A\u95F4\u4E4B\u5916\u7684\u5927\u90E8\u5206\u529F\u80FD\u90FD\u4F7F\u7528\u4E86\u53F3\u624B\u5750\u6807\u7CFB\u3002</p><p><img src="`+B+'" alt=""></p><ul><li>\u5F53\u7269\u4F53\u7ED5 z \u8F74\uFF0C\u4ECE x \u8F74\u6B63\u534A\u8F74\u5411 y \u8F74\u6B63\u534A\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u662F\u6B63\u5411\u65CB\u8F6C\uFF0C\u53CD\u4E4B\u4E3A\u8D1F\u3002</li><li>\u5F53\u7269\u4F53\u7ED5 x \u8F74\uFF0C\u4ECE y \u8F74\u6B63\u534A\u8F74\u5411 z \u8F74\u6B63\u534A\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u662F\u6B63\u5411\u65CB\u8F6C\uFF0C\u53CD\u4E4B\u4E3A\u8D1F\u3002</li><li>\u5F53\u7269\u4F53\u7ED5 y \u8F74\uFF0C\u4ECE z \u8F74\u6B63\u534A\u8F74\u5411 x \u8F74\u6B63\u534A\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u662F\u6B63\u5411\u65CB\u8F6C\uFF0C\u53CD\u4E4B\u4E3A\u8D1F\u3002</li></ul><p>\u65CB\u8F6C\u516C\u5F0F:</p><p>\u7531\u4E00\u4E2A\u8BA9\u9876\u70B9\u56F4\u7ED5 z \u8F74\u65CB\u8F6C\u7684\u4F8B\u5B50\u5F15\u51FA</p><p><img src="'+z+`" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u70B9 A \u7684\u4F4D\u7F6E\u662F(ax,ay,az)</li><li>\u70B9 A \u8981\u56F4\u7ED5 z \u8F74\u65CB\u8F6C \u03B2 \u5EA6\uFF0C\u8F6C\u5230\u70B9 B \u7684\u4F4D\u7F6E</li></ul><p>\u6C42\uFF1A\u70B9 A \u65CB\u8F6C\u540E\u7684 bx\u3001by \u4F4D\u7F6E</p><p>\u56E0\u4E3A \u2220\u03B2 \u662F\u5DF2\u77E5\u7684\uFF0C\u2220\u03B1 \u53EF\u4EE5\u901A\u8FC7\u70B9 A \u5F97\u51FA:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u2220xOB<span class="token operator">=</span>\u03B1<span class="token operator">+</span>\u03B2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E09\u89D2\u51FD\u6570\u5C31\u53EF\u4EE5\u63A8\u51FA bx\u3001by</p><p>\u8BBE \u2220xOB=\u03B8\uFF0C\u5219\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx<span class="token operator">=</span>cos\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
by<span class="token operator">=</span>sin\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>|OA|\u662F\u70B9 O \u5230\u70B9 A \u7684\u8DDD\u79BB\uFF0C\u53EF\u4EE5\u76F4\u63A5\u7528\u70B9 A \u6C42\u51FA:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|=</span>Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>ax<span class="token operator">*</span>ax<span class="token operator">+</span>ay<span class="token operator">*</span>ay<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u53EA\u9700\u8981\u77E5\u9053 cos\u03B8 \u548C sin\u03B8 \u7684\u503C\u5373\u53EF\uFF0C\u56E0\u4E3A\uFF1A\u03B8=\u03B1+\u03B2<br> \u6240\u4EE5\u53EF\u4EE5\u5229\u7528\u548C\u89D2\u516C\u5F0F\u6C42 cos\u03B8 \u548C sin\u03B8 \u7684\u503C\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B8 <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>\u03B1 <span class="token operator">+</span> \u03B2<span class="token punctuation">)</span><span class="token punctuation">;</span>
cos\u03B8 <span class="token operator">=</span> cos\u03B1 <span class="token operator">*</span> cos\u03B2 <span class="token operator">-</span> sin\u03B1 <span class="token operator">*</span> sin\u03B2<span class="token punctuation">;</span>

sin\u03B8 <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>\u03B1 <span class="token operator">+</span> \u03B2<span class="token punctuation">)</span><span class="token punctuation">;</span>
sin\u03B8 <span class="token operator">=</span> cos\u03B2 <span class="token operator">*</span> sin\u03B1 <span class="token operator">+</span> sin\u03B2 <span class="token operator">*</span> cos\u03B1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6240\u4EE5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx<span class="token operator">=</span>cos\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
bx<span class="token operator">=</span><span class="token punctuation">(</span>cos\u03B1<span class="token operator">*</span>cos\u03B2<span class="token operator">-</span>sin\u03B1<span class="token operator">*</span>sin\u03B2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
bx<span class="token operator">=</span>cos\u03B1<span class="token operator">*</span>cos\u03B2<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span><span class="token operator">-</span>sin\u03B1<span class="token operator">*</span>sin\u03B2<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>

by<span class="token operator">=</span>sin\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
by<span class="token operator">=</span><span class="token punctuation">(</span>cos\u03B2<span class="token operator">*</span>sin\u03B1<span class="token operator">+</span>sin\u03B2<span class="token operator">*</span>cos\u03B1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
by<span class="token operator">=</span>cos\u03B2<span class="token operator">*</span>sin\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span><span class="token operator">+</span>sin\u03B2<span class="token operator">*</span>cos\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u56E0\u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|=</span>ax
sin\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|=</span>ay
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7B80\u5316\u5F97\u5230 bx\u3001by \u7684\u516C\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx <span class="token operator">=</span> ax <span class="token operator">*</span> cos\u03B2 <span class="token operator">-</span> ay <span class="token operator">*</span> sin\u03B2<span class="token punctuation">;</span>
by <span class="token operator">=</span> ay <span class="token operator">*</span> cos\u03B2 <span class="token operator">+</span> ax <span class="token operator">*</span> sin\u03B2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5728\u7740\u8272\u5668\u4E2D\u65CB\u8F6C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    float angle<span class="token operator">=</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">80.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float sinB<span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float cosB<span class="token operator">=</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_Position<span class="token punctuation">.</span>x<span class="token operator">=</span>a_Position<span class="token punctuation">.</span>x<span class="token operator">*</span>cosB<span class="token operator">-</span>a_Position<span class="token punctuation">.</span>y<span class="token operator">*</span>sinB<span class="token punctuation">;</span>
        gl_Position<span class="token punctuation">.</span>y<span class="token operator">=</span>a_Position<span class="token punctuation">.</span>y<span class="token operator">*</span>cosB<span class="token operator">+</span>a_Position<span class="token punctuation">.</span>x<span class="token operator">*</span>sinB<span class="token punctuation">;</span>
        gl_Position<span class="token punctuation">.</span>z<span class="token operator">=</span>a_Position<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
        gl_Position<span class="token punctuation">.</span>w<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>radians(float degree) \u5C06\u89D2\u5EA6\u8F6C\u5F27\u5EA6</li><li>sin(float angle) \u6B63\u5F26</li><li>cos(float angle) \u4F59\u5F26</li></ul><h3 id="_3-\u7F29\u653E" tabindex="-1"><a class="header-anchor" href="#_3-\u7F29\u653E" aria-hidden="true">#</a> 3.\u7F29\u653E</h3><p>\u7F29\u653E\u53EF\u4EE5\u7406\u89E3\u4E3A\u5BF9\u5411\u91CF\u957F\u5EA6\u7684\u6539\u53D8\uFF0C\u6216\u8005\u5BF9\u5411\u91CF\u5750\u6807\u5206\u91CF\u7684\u540C\u6B65\u7F29\u653E</p><p><img src="`+F+`" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u70B9 A \u7684\u4F4D\u7F6E\u662F(ax,ay,az)</li><li>\u70B9 A \u57FA\u4E8E\u539F\u70B9\u5167\u7F29\u4E86\u4E00\u534A</li></ul><p>\u6C42\uFF1A\u70B9 A \u5167\u7F29\u4E86\u4E00\u534A\u540E\u7684 bx\u3001by\u3001bz \u4F4D\u7F6E</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx <span class="token operator">=</span> ax <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
by <span class="token operator">=</span> ay <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
bz <span class="token operator">=</span> az <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5728\u7740\u8272\u5668\u4E2D\u7F29\u653E</p><p>\u5BF9 gl_Position \u7684 x\u3001y\u3001z \u4F9D\u6B21\u7F29\u653E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
attribute vec4 a_Position<span class="token punctuation">;</span>
float scale<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	gl_Position<span class="token punctuation">.</span>x<span class="token operator">=</span> a_Position<span class="token punctuation">.</span>x<span class="token operator">*</span>scale<span class="token punctuation">;</span>
	gl_Position<span class="token punctuation">.</span>y<span class="token operator">=</span> a_Position<span class="token punctuation">.</span>y<span class="token operator">*</span>scale<span class="token punctuation">;</span>
	gl_Position<span class="token punctuation">.</span>z<span class="token operator">=</span> a_Position<span class="token punctuation">.</span>z<span class="token operator">*</span>scale<span class="token punctuation">;</span>
	gl_Position<span class="token punctuation">.</span>w<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>a_Position \u4E2D\u62BD\u79BB\u51FA\u7531 x\u3001y\u3001z \u7EC4\u6210\u7684\u4E09\u7EF4\u5411\u91CF\uFF0C\u5BF9\u5176\u8FDB\u884C\u4E00\u6B21\u6027\u7F29\u653E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
attribute vec4 a_Position<span class="token punctuation">;</span>
float scale<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	gl_Position<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token operator">*</span>scale<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-\u77E9\u9635" aria-hidden="true">#</a> 4.\u77E9\u9635</h3><p>\u77E9\u9635\uFF08Matrix\uFF09\u662F\u4E00\u4E2A\u6309\u7167\u77E9\u5F62\u7EB5\u6A2A\u6392\u5217\u7684\u590D\u6570\u96C6\u5408</p><p>\u5728\u77E9\u9635\u4E2D\u7684\u6BCF\u4E00\u884C\uFF0C\u6216\u8005\u6BCF\u4E00\u5217\u6570\u5B57\u6784\u6210\u7684\u96C6\u5408\uFF0C\u53EF\u4EE5\u89C6\u4E4B\u4E3A\u5411\u91CF</p><ol><li>\u5411\u91CF</li></ol><p>\u5411\u91CF\uFF0C\u53C8\u53EB\u77E2\u91CF\uFF0C\u6307\u5177\u6709\u5927\u5C0F\uFF08magnitude\uFF09\u548C\u65B9\u5411\u7684\u91CF</p><p>webgl \u91CC\u7684\u5411\u91CF\u6709 1 \u7EF4\u5411\u91CF\u30012 \u7EF4\u5411\u91CF\u30013 \u7EF4\u5411\u91CF\u548C 4 \u7EF4\u5411\u91CF\uFF1A</p><ul><li>\u7EF4\u5411\u91CF\u4E2D\u6709 1 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F\u5355\u8F74\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\u3002</li><li>2 \u7EF4\u5411\u91CF\u4E2D\u6709 2 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F 2 \u7EF4\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\u3002</li><li>3 \u7EF4\u5411\u91CF\u4E2D\u6709 3 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F 3 \u7EF4\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\u3002</li><li>4 \u7EF4\u5411\u91CF\u4E2D\u6709 4 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F 3 \u7EF4\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\uFF0C\u5916\u52A0\u4E00\u4E2A\u9644\u52A0\u6570\u636E\uFF0C\u81F3\u4E8E\u8FD9\u4E2A\u6570\u636E\u662F\u4EC0\u4E48\uFF0C\u8981\u770B\u9879\u76EE\u9700\u6C42\u3002</li></ul><ol start="2"><li>\u77E9\u9635\u548C\u5411\u91CF\u7684\u4E58\u6CD5</li></ol><p>\u77E9\u9635\u548C\u5411\u91CF\u7684\u4E58\u6CD5\uFF1A</p><p><img src="`+O+'" alt=""></p><p>\u7528\u4E13\u4E1A\u672F\u8BED\u6765\u8BF4\uFF1A</p><ul><li>\u6A2A\u7740\u7684\u4E24\u7EC4\u9075\u5FAA\u7684\u89C4\u5219\u662F\u884C\u4E3B\u5E8F\uFF0C\u5373\u5C06\u77E9\u9635\u4E2D\u7684\u4E00\u884C\u6570\u636E\u89C6\u4E4B\u4E3A\u4E00\u4E2A\u5411\u91CF\u3002</li><li>\u7AD6\u7740\u7684\u4E24\u7EC4\u9075\u5FAA\u7684\u89C4\u5219\u662F\u5217\u4E3B\u5E8F\uFF0C\u5373\u5C06\u77E9\u9635\u4E2D\u7684\u4E00\u5217\u6570\u636E\u89C6\u4E4B\u4E3A\u4E00\u4E2A\u5411\u91CF\u3002</li></ul><p>\u81F3\u4E8E\u662F\u4F7F\u7528\u884C\u4E3B\u5E8F\uFF0C\u8FD8\u662F\u5217\u4E3B\u5E8F\uFF0C\u8FD9\u5C31\u5F97\u770B\u89C4\u5219\u7684\u5B9A\u5236\u8005\u4E86\u3002</p><p>\u5728 webgl \u91CC\uFF0C\u77E9\u9635\u5143\u7D20\u7684\u6392\u5217\u89C4\u5219\u662F\u5217\u4E3B\u5E8F\u3002</p><p>\u6570\u5B66\u4E2D\u5E38\u7528\u7684\u5199\u6CD5\u662F\u884C\u4E3B\u5E8F</p><p>\u53EF\u4EE5\u7528\u77E9\u9635\u4E58\u4EE5\u5411\u91CF\u7684\u65B9\u5F0F\u8BA9\u70B9 p \u65CB\u8F6C \u03B2 \u5EA6\uFF1A</p><p><img src="'+I+`" alt=""></p><ol start="3"><li>\u5728\u7740\u8272\u5668\u4E2D\u5199\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    float angle<span class="token operator">=</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">40.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float sinB<span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float cosB<span class="token operator">=</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mat2 m2<span class="token operator">=</span><span class="token function">mat2</span><span class="token punctuation">(</span>
      cosB<span class="token punctuation">,</span> sinB<span class="token punctuation">,</span>
      <span class="token operator">-</span>sinB<span class="token punctuation">,</span>cosB
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>
        m2<span class="token operator">*</span><span class="token function">vec2</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">,</span>
        a_Position<span class="token punctuation">.</span>z<span class="token punctuation">,</span>a_Position<span class="token punctuation">.</span>w
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="4"><li>\u56DB\u7EF4\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    float angle<span class="token operator">=</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float cosB<span class="token operator">=</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float sinB<span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5217\u4E3B\u5E8F</span>
    mat4 m4<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      cosB<span class="token punctuation">,</span> sinB<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span>sinB<span class="token punctuation">,</span>cosB<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> m4<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="5"><li>\u77E9\u9635\u5E73\u79FB</li></ol><p>\u8BA9\u9876\u70B9\u7684 x \u79FB\u52A8 0.1\uFF0Cy \u79FB\u52A8 0.2\uFF0Cz \u79FB\u52A8 0.3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5217\u4E3B\u5E8F</span>
    mat4 m4<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> m4<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="6"><li>\u77E9\u9635\u7F29\u653E</li></ol><p>\u9876\u70B9\u5728 x \u8F74\u5411\u7F29\u653E 2\uFF0Cy \u8F74\u5411\u7F29\u653E 3\uFF0C\u8F74\u5411\u7F29\u653E 4\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5217\u4E3B\u5E8F</span>
    mat4 m4<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> m4<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="7"><li>\u77E9\u9635\u5E93</li></ol><p>three.js \u7684 Matrix3 \u548C Matrix4 \u5BF9\u8C61\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1.\u5F15\u5165Matrix4\u5BF9\u8C61</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Matrix4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 2.\u5B9E\u4F8B\u5316\u77E9\u9635\u5BF9\u8C61\uFF0C\u5728\u5176\u4E2D\u5199\u5165\u65CB\u8F6C\u4FE1\u606F</span>
<span class="token keyword">const</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matrix<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.\u57FA\u4E8Ematrix \u5BF9\u8C61\u7684elements \u5C5E\u6027\uFF0C\u4FEE\u6539uniform \u53D8\u91CF</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="\u516D\u3001-\u77E9\u9635\u590D\u5408\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001-\u77E9\u9635\u590D\u5408\u53D8\u6362" aria-hidden="true">#</a> \u516D\u3001 \u77E9\u9635\u590D\u5408\u53D8\u6362</h2><h3 id="_1-\u77E9\u9635\u76F8\u4E58" tabindex="-1"><a class="header-anchor" href="#_1-\u77E9\u9635\u76F8\u4E58" aria-hidden="true">#</a> 1.\u77E9\u9635\u76F8\u4E58</h3><p>\u77E9\u9635\u76F8\u4E58\u53EF\u4EE5\u5B9E\u73B0\u590D\u5408\u53D8\u6362\uFF0C\u5C31\u6BD4\u5982\u5148\u4F4D\u79FB\u518D\u65CB\u8F6C\u3001\u5148\u65CB\u8F6C\u5728\u4F4D\u79FB\uFF0C\u6216\u7740\u8FDE\u7EED\u4F4D\u79FB\u3002</p><p>\u77E9\u9635\u4E58\u4EE5\u77E9\u9635\u7684\u7ED3\u679C\u8FD8\u662F\u77E9\u9635\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u77E9\u9635\u5E93\u9A8C\u8BC1\u4E00\u4E0B\u77E9\u9635\u76F8\u4E58\u7684\u89C4\u5F8B\u3002</p><ol><li>\u4F7F\u7528 three.js \u7684 Matrix4 \u5BF9\u8C61\u5EFA\u7ACB\u77E9\u9635</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const a=new Matrix4().set(
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span>
    <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span>
)
const b=new Matrix4().set(
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span>
    <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span>
    <span class="token number">120</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token number">150</span>
)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u6CE8\uFF1Aset()\u65B9\u6CD5\u91CC\u8F93\u5165\u7684\u77E9\u9635\u662F\u884C\u4E3B\u5E8F\u7684\uFF0C\u4F46 elements \u8F93\u51FA\u7684\u77E9\u9635\u662F\u5217\u4E3B\u5E8F\u7684\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const ca=a.elements
console.log(ca);
<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span>
<span class="token punctuation">]</span>

const cb=b.elements
console.log(cb);
<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span>
    <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span>
    <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">150</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="2"><li>\u8BA9\u77E9\u9635 a \u4E58\u4EE5\u77E9\u9635 b</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const c=a.multiply(b)
console.log(c.elements);
<span class="token punctuation">[</span>
    <span class="token number">560</span><span class="token punctuation">,</span> <span class="token number">1520</span><span class="token punctuation">,</span> <span class="token number">2480</span><span class="token punctuation">,</span> <span class="token number">3440</span><span class="token punctuation">,</span>
    <span class="token number">620</span><span class="token punctuation">,</span> <span class="token number">1740</span><span class="token punctuation">,</span> <span class="token number">2860</span><span class="token punctuation">,</span> <span class="token number">3980</span><span class="token punctuation">,</span>
    <span class="token number">680</span><span class="token punctuation">,</span> <span class="token number">1960</span><span class="token punctuation">,</span> <span class="token number">3240</span><span class="token punctuation">,</span> <span class="token number">4520</span><span class="token punctuation">,</span>
    <span class="token number">740</span><span class="token punctuation">,</span> <span class="token number">2180</span><span class="token punctuation">,</span> <span class="token number">3620</span><span class="token punctuation">,</span> <span class="token number">5060</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u5206\u6790\u4E00\u4E0B\u7ED3\u679C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token number">560</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">*</span><span class="token number">0</span> <span class="token operator">+</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">80</span> <span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">120</span>
<span class="token number">620</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">50</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">90</span> <span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">130</span>
<span class="token number">680</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">*</span><span class="token number">20</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">140</span>
<span class="token number">740</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">*</span><span class="token number">30</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">70</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">110</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">150</span>

<span class="token number">1520</span><span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">0</span> <span class="token operator">+</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">80</span> <span class="token operator">+</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">120</span>
<span class="token number">1740</span><span class="token operator">=</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">50</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">90</span> <span class="token operator">+</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">130</span>
\u2026\u2026
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u603B\u7ED3\u51FA\u77E9\u9635 a \u4E58\u4EE5\u77E9\u9635 b \u89C4\u5F8B:</p><p>\u4EE5\u5217\u4E3B\u5E8F\u7684 ca\u3001cb \u4E3A\u4F8B\uFF1A<br> \u5148\u904D\u5386 ca \u7684\u6BCF\u4E00\u5217\uFF0C\u518D\u904D\u5386 cb \u7684\u6BCF\u4E00\u884C\uFF0C\u5C06 ca \u7684\u6BCF\u4E00\u5217\u4E58\u4EE5 cb \u7684\u6BCF\u4E00\u884C\uFF0C\u6309\u7167\u5217\u4E3B\u5E8F\u6392\u5217\u540E\u5F97\u5230\u7684\u7ED3\u679C\u3002</p><p>\u4EE5\u884C\u4E3B\u5E8F\u7684 ca\u3001cb \u4E3A\u4F8B\uFF1A<br> \u5148\u904D\u5386 ca \u7684\u6BCF\u4E00\u884C\uFF0C\u518D\u904D\u5386 cb \u7684\u6BCF\u4E00\u5217\uFF0C\u5C06 ca \u7684\u6BCF\u4E00\u884C\u4E58\u4EE5 cb \u7684\u6BCF\u4E00\u5217\uFF0C\u6309\u7167\u884C\u4E3B\u5E8F\u6392\u5217\u540E\u5F97\u5230\u7684\u7ED3\u679C\u3002</p><p>\u9A8C\u8BC1\u4E00\u4E0B\u540E\u8005\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const cc=<span class="token punctuation">[</span><span class="token punctuation">]</span>
for(let y=<span class="token number">0</span>;y&lt;<span class="token number">16</span>;y+=<span class="token number">4</span>)<span class="token punctuation">{</span>
    const <span class="token punctuation">[</span>ax<span class="token punctuation">,</span>ay<span class="token punctuation">,</span>az<span class="token punctuation">,</span>aw<span class="token punctuation">]</span>=<span class="token punctuation">[</span>ca<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span>ca<span class="token punctuation">[</span>y+<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ca<span class="token punctuation">[</span>y+<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ca<span class="token punctuation">[</span>y+<span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    for (let x=<span class="token number">0</span>;x&lt;<span class="token number">4</span>;x++)<span class="token punctuation">{</span>
        console.log(x);
        const <span class="token punctuation">[</span>bx<span class="token punctuation">,</span>by<span class="token punctuation">,</span>bz<span class="token punctuation">,</span>bw<span class="token punctuation">]</span>=<span class="token punctuation">[</span>cb<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span>cb<span class="token punctuation">[</span>x+<span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cb<span class="token punctuation">[</span>x+<span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cb<span class="token punctuation">[</span>x+<span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        cc.push(ax*bx+ay*by+az*bz+aw*bw)
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console.log(cc);
<span class="token punctuation">[</span>
    <span class="token number">560</span><span class="token punctuation">,</span> <span class="token number">1520</span><span class="token punctuation">,</span> <span class="token number">2480</span><span class="token punctuation">,</span> <span class="token number">3440</span><span class="token punctuation">,</span>
    <span class="token number">620</span><span class="token punctuation">,</span> <span class="token number">1740</span><span class="token punctuation">,</span> <span class="token number">2860</span><span class="token punctuation">,</span> <span class="token number">3980</span><span class="token punctuation">,</span>
    <span class="token number">680</span><span class="token punctuation">,</span> <span class="token number">1960</span><span class="token punctuation">,</span> <span class="token number">3240</span><span class="token punctuation">,</span> <span class="token number">4520</span><span class="token punctuation">,</span>
    <span class="token number">740</span><span class="token punctuation">,</span> <span class="token number">2180</span><span class="token punctuation">,</span> <span class="token number">3620</span><span class="token punctuation">,</span> <span class="token number">5060</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2-\u53D8\u6362\u89C4\u5F8B" tabindex="-1"><a class="header-anchor" href="#_2-\u53D8\u6362\u89C4\u5F8B" aria-hidden="true">#</a> 2.\u53D8\u6362\u89C4\u5F8B</h3><ol><li>\u4F4D\u79FB\u52A0\u4F4D\u79FB</li></ol><p>\u63A5\u4E0B\u6765\u6211\u60F3\u8BA9\u4E00\u4E2A\u7269\u4F53\u6CBF x \u8F74\u4F4D\u79FB ax\uFF0C\u6CBF y \u8F74\u4F4D\u79FB ay \u540E\uFF0C\u518D\u6CBF x \u8F74\u4F4D\u79FB bx\uFF0C\u6CBF y \u8F74\u4F4D\u79FB by\u3002</p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u521D\u59CB\u70B9\u4F4D A(ax,ay,az,1.0)</li><li>\u521D\u6B21\u4F4D\u79FB\uFF1A\u6CBF x \u8F74\u4F4D\u79FB bx\uFF0C\u6CBF y \u8F74\u4F4D\u79FB by</li><li>\u7B2C\u4E8C\u6B21\u4F4D\u79FB\uFF1A\u6CBF x \u8F74\u4F4D\u79FB cx\uFF0C\u6CBF y \u8F74\u4F4D\u79FB cy</li></ul><p>\u6C42\uFF1A\u53D8\u6362\u540E\u7684\u4F4D\u7F6E F(fx,fy,fz,fw)</p><p>\u89E3\uFF1A</p><p>1.\u8BBE\u521D\u6B21\u53D8\u6362\u77E9\u9635\u4E3A bm(\u884C\u4E3B\u5E8F)\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>bm
<span class="token punctuation">[</span>
	<span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>bx<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>by<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5219\u521D\u6B21\u53D8\u6362\u540E\u7684\u70B9 F \u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">F</span> <span class="token operator">=</span> bm <span class="token operator">*</span> <span class="token constant">A</span><span class="token punctuation">;</span>
fx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> ax <span class="token operator">+</span> bx<span class="token punctuation">;</span>
fy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> by<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> ay <span class="token operator">+</span> by<span class="token punctuation">;</span>
fz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> az<span class="token punctuation">;</span>
fw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2.\u8BBE\u7B2C\u4E8C\u6B21\u53D8\u6362\u77E9\u9635\u4E3A cm(\u884C\u4E3B\u5E8F)\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cm
<span class="token punctuation">[</span>
	<span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>cx<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>cy<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5219\u7B2C\u4E8C\u6B21\u53D8\u6362\u540E\u7684\u70B9 F \u4E3A\u7B2C\u4E8C\u6B21\u53D8\u6362\u77E9\u9635\u4E58\u4EE5\u4E0A\u4E00\u6B21\u53D8\u6362\u540E\u7684\u70B9 F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">F</span> <span class="token operator">=</span> cm <span class="token operator">*</span> <span class="token constant">F</span><span class="token punctuation">;</span>
fx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> cx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> fx <span class="token operator">+</span> cx<span class="token punctuation">;</span>
fy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> cy<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> fy <span class="token operator">+</span> cy<span class="token punctuation">;</span>
fz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> fz<span class="token punctuation">;</span>
fw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6240\u4EE5\u7406\u89E3\u6700\u7EC8\u7684\u70B9 F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fx <span class="token operator">=</span> ax <span class="token operator">+</span> bx <span class="token operator">+</span> cx<span class="token punctuation">;</span>
fy <span class="token operator">=</span> ay <span class="token operator">+</span> by <span class="token operator">+</span> cy<span class="token punctuation">;</span>
fz <span class="token operator">=</span> az<span class="token punctuation">;</span>
fw <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u4E0A\u9762\u7684\u70B9 F \u8FD8\u53EF\u4EE5\u8FD9\u4E48\u7406\u89E3\uFF1A\uFF08\u77E9\u9635\u4E58\u4EE5\u77E9\u9635\uFF09</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">F</span> <span class="token operator">=</span> cm <span class="token operator">*</span> bm <span class="token operator">*</span> <span class="token constant">A</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8BBE cm*bm \u7684\u7ED3\u679C\u4E3A\u77E9\u9635 dm(\u884C\u4E3B\u5E8F)\uFF0C\u53C2\u7167 dm \u4E2D\u5143\u7D20\u7684\u7D22\u5F15\u4F4D\u7F6E\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cm
<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
	<span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span>
	<span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5219 dm \u4E2D\u7684\u7B2C\u4E00\u884C\u5143\u7D20\u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>dm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
dm<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
dm<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
dm<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> cx <span class="token operator">+</span> bx<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u901A\u8FC7 dm \u77E9\u9635\u7684\u7B2C\u4E00\u884C\u5143\u7D20\u6211\u4EEC\u5C31\u53EF\u4EE5\u5F97\u5230\u70B9 F \u7684 fx \u503C\u4E86\uFF0C\u6211\u4EEC\u9A8C\u8BC1\u4E00\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> cx <span class="token operator">+</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> ax <span class="token operator">+</span> cx <span class="token operator">+</span> bx<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u548C\u6211\u4EEC\u4E4B\u524D\u4E24\u6B21\u77E9\u9635\u4E58\u4EE5\u5411\u91CF\u5F97\u5230\u7684\u7ED3\u679C\u662F\u4E00\u6837\u7684\u3002</p><ol start="2"><li>\u5148\u79FB\u52A8\u540E\u65CB\u8F6C</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mt<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> mr<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>mr.multiply(mt) \u4FBF\u662F\u5148\u4F4D\u79FB\u518D\u65CB\u8F6C\uFF1A<br><img src="`+C+`" alt=""></p><ol start="3"><li>\u5148\u65CB\u8F6C\u540E\u79FB\u52A8</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mt<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> mt<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>mt.multiply(mr)\u4FBF\u662F\u5148\u65CB\u8F6C\u518D\u4F4D\u79FB\uFF1A<br><img src="`+L+`" alt=""></p><ol start="4"><li>\u5176\u5B83\u53D8\u6362\u65B9\u5F0F</li></ol><p>1)\u65CB\u8F6C\u548C\u7F29\u653E</p><ul><li>\u5148\u65CB\u8F6C\u540E\u7F29\u653E</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>\u5148\u7F29\u653E\u540E\u65CB\u8F6C</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matrix <span class="token operator">=</span> mr<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5728\u6B64\u8981\u6CE8\u610F\u4E00\u4E2A\u6027\u8D28\uFF1A\u5F53\u7F29\u653E\u56E0\u5B50\u4E00\u81F4\u65F6\uFF0C\u65CB\u8F6C\u548C\u7F29\u653E\u6CA1\u6709\u5148\u540E\u4E4B\u5206\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6B64\u662F\u4E0B\u9762\u7684\u4E24\u79CD\u53D8\u6362\u7ED3\u679C\u90FD\u662F\u4E00\u6837\u7684:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matrix <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> matrix <span class="token operator">=</span> mr<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2)\u7EFC\u5408\u53D8\u6362</p><p>Matrix4 \u8FD8\u6709\u4E00\u4E2A compose \u7EFC\u5408\u53D8\u6362\u65B9\u6CD5\uFF0C\u5B83\u53EF\u4EE5\u5C06\u6240\u6709\u53D8\u6362\u4FE1\u606F\u90FD\u5199\u8FDB\u53BB\uFF0C\u5176\u53D8\u6362\u987A\u5E8F\u5C31\u662F\u5148\u7F29\u653E\uFF0C\u518D\u65CB\u8F6C\uFF0C\u6700\u540E\u4F4D\u79FB\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u4F4D\u79FB</span>
<span class="token keyword">const</span> pos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u65CB\u8F6C</span>
<span class="token keyword">const</span> rot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rot<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u7F29\u653E</span>
<span class="token keyword">const</span> scale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matrix<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> rot<span class="token punctuation">,</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>compose ( position : Vector3, quaternion : Quaternion, scale : Vector3 )</p><ul><li>position \u4F4D\u7F6E</li><li>quaternion \u7528\u56DB\u5143\u6570\u5B58\u50A8\u7684\u65CB\u8F6C\u6570\u636E</li><li>scale \u7F29\u653E</li></ul><p>compose() \u65B9\u6CD5\u5206\u89E3\u5F00\u6765\uFF0C\u5C31\u662F\u8FD9\u6837\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mt<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> mt<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_3-\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> 3.\u89C6\u56FE\u77E9\u9635</h3><p>\u89C6\u56FE\u77E9\u9635\u662F\u7528\u4E8E\u786E\u5B9A\u76F8\u673A\u89D2\u5EA6\u548C\u4F4D\u7F6E\u7684\u77E9\u9635\u3002</p><p>\u80FD\u4E0D\u80FD\u5728\u6CA1\u6709\u89C6\u56FE\u77E9\u9635\u7684\u60C5\u51B5\u4E0B\uFF0C\u770B\u89C1\u7269\u4F53\u7684\u53E6\u4E00\u4E2A\u89D2\u5EA6\u5462\uFF1F</p><p>\u7B54\u6848\u80AF\u5B9A\u662F\u53EF\u4EE5\uFF0C\u6211\u4EEC\u81EA\u5DF1\u7528\u6A21\u578B\u77E9\u9635\u628A\u7269\u4F53\u8F6C\u4E00\u4E0B\u5C31\u53EF\u4EE5\u4E86\u3002</p><p>\u56E0\u6B64\uFF0C\u89C6\u56FE\u77E9\u9635\u7684\u672C\u8D28\u662F\u5BF9\u7269\u4F53\u7684\u65CB\u8F6C\u53D8\u6362\u3002</p><p>\u800C\u7269\u4F53\u53D8\u6362\u7684\u672C\u8D28\u5219\u662F\u5BF9\u7269\u4F53\u9876\u70B9\u7684\u4F4D\u79FB\u3002</p><h4 id="_1-\u76F8\u673A\u7684\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#_1-\u76F8\u673A\u7684\u5B9A\u4E49" aria-hidden="true">#</a> 1.\u76F8\u673A\u7684\u5B9A\u4E49</h4><p><img src="`+U+'" alt=""></p><ul><li>\u89C6\u70B9\uFF1A\u76F8\u673A\u7684\u4F4D\u7F6E</li><li>\u89C6\u7EBF\u65B9\u5411\uFF1A\u76F8\u673A\u6240\u770B\u7684\u65B9\u5411</li><li>\u4E0A\u65B9\u5411\uFF1A\u76F8\u673A\u7ED5\u89C6\u7EBF\u8F6C\u52A8\u7684\u65B9\u5411</li></ul><h4 id="_2-\u76F8\u5BF9\u8FD0\u52A8" tabindex="-1"><a class="header-anchor" href="#_2-\u76F8\u5BF9\u8FD0\u52A8" aria-hidden="true">#</a> 2.\u76F8\u5BF9\u8FD0\u52A8</h4><p>\u5F53\u76F8\u673A\u4E0E\u5B83\u6240\u62CD\u6444\u7684\u7269\u4F53\u540C\u65F6\u8FD0\u52A8\u7684\u65F6\u5019\uFF0C\u76F8\u673A\u6240\u62CD\u6444\u7684\u753B\u9762\u4E0D\u4F1A\u6709\u4EFB\u4F55\u6539\u53D8</p><p><img src="'+V+'" alt=""></p><p>\u56E0\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u9ED8\u8BA4\u76F8\u673A\u7684\u89C6\u70B9\u5C31\u5728\u96F6\u70B9\uFF0C\u76F8\u673A\u770B\u5411-z \u65B9\u5411\uFF0C\u5176\u4E0A\u65B9\u5411\u5C31\u662F y \u8F74\u3002<br> \u5F53\u6211\u6211\u4EEC\u6539\u53D8\u7684\u76F8\u673A\u7684\u89C6\u70B9\u3001\u89C6\u7EBF\u548C\u4E0A\u65B9\u5411\u7684\u65F6\u5019\uFF0C\u53EA\u8981\u76F8\u5BF9\u7684\u53BB\u6539\u53D8\u573A\u666F\u4E2D\u7684\u7269\u4F53\u5373\u53EF\u3002<br> \u800C\u8FD9\u4E2A\u76F8\u5BF9\u7684\u53BB\u6539\u53D8\u573A\u666F\u4E2D\u7684\u7269\u4F53\u7684\u77E9\u9635\uFF0C\u5C31\u662F\u89C6\u56FE\u77E9\u9635\u3002</p><p><img src="'+D+'" alt=""></p><p>\u901A\u8FC7\u4E0A\u9762\u539F\u7406\u53EF\u4EE5\u77E5\u9053\uFF0C\u60F3\u8981\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635\uFF0C\u8BA9\u5176\u6EE1\u8DB3\u4EE5\u4E0B\u6761\u4EF6\u5373\u53EF\uFF1A</p><ol><li>\u628A\u89C6\u70B9 e(ex,ey,ez)\u5BF9\u9F50\u5230 O \u70B9\u4E0A</li><li>\u628A\u89C6\u7EBF c(cx,cy,cz) \u65CB\u8F6C\u5230-z \u8F74\u4E0A</li><li>\u628A\u4E0A\u65B9\u5411 b(bx,by,bz) \u65CB\u8F6C\u5230 y \u8F74\u4E0A</li><li>\u628A c \u4E0E b \u7684\u5782\u7EBF a(ax,ay,az) \u65CB\u8F6C\u5230 x \u8F74\u4E0A</li></ol><h4 id="_3-\u6B63\u4EA4\u77E9\u9635\u7684\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_3-\u6B63\u4EA4\u77E9\u9635\u7684\u65CB\u8F6C" aria-hidden="true">#</a> 3.\u6B63\u4EA4\u77E9\u9635\u7684\u65CB\u8F6C</h4><p>\u4E3A\u4E86\u7406\u89E3\u89C6\u56FE\u77E9\u9635\u7684\u8FD0\u7B97\uFF0C\u4ECE\u51E0\u4E2A\u4F8B\u9898\u8BF4\u8D77\u3002</p><p>\u9898 1<br> \u5DF2\u77E5\uFF1A\u70B9 A(1,0,0)<br> \u6C42\uFF1A\u628A\u70B9 A \u7ED5 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 30\xB0\uFF0C\u65CB\u8F6C\u5230 B \u70B9\u7684\u884C\u4E3B\u5E8F\u77E9\u9635 m1<br><img src="'+W+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m1<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token constant">B</span><span class="token operator">=</span>m1<span class="token operator">*</span><span class="token constant">A</span>
<span class="token constant">B</span><span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token punctuation">(</span>cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">\xB7</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>cos30\xB0
<span class="token constant">B</span><span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token punctuation">(</span>sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">\xB7</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>sin30\xB0
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u9898 2<br> \u7EE7\u9898 1 \u7684\u5DF2\u77E5\u6761\u4EF6<br> \u6C42\uFF1A\u628A\u70B9 B \u7ED5 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C-30\xB0\uFF0C\u65CB\u8F6C\u5230 A \u70B9\u7684\u5217\u884C\u5E8F\u77E9\u9635 m2</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m2<span class="token operator">=</span><span class="token punctuation">[</span>
	cos<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span>cos<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
m2<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span> sin30\xB0<span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u89C2\u5BDF\u9898 1\u3001\u9898 2\uFF0C\u6211\u4EEC\u53EF\u4EE5\u53D1\u73B0\u4E24\u4E2A\u89C4\u5F8B\uFF1A</p><ul><li>m2 \u662F m1 \u7684\u9006\u77E9\u9635</li><li>m2 \u4E5F\u662F m1 \u7684\u8F6C\u7F6E\u77E9\u9635</li></ul><p>\u7531\u6B64\u6211\u4EEC\u53EF\u4EE5\u5F97\u5230\u4E00\u4E2A\u7ED3\u8BBA\uFF1A<strong>\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u5C31\u662F\u5176\u8F6C\u7F6E\u77E9\u9635</strong>\u3002</p><p>\u9898 3<br> \u5DF2\u77E5\uFF1A</p><ul><li><p>\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u7CFB m1\uFF0C\u5176\u57FA\u5411\u91CF\u662F\uFF1A</p><ul><li>x(1,0,0)</li><li>y(0,1,0)</li><li>z(0,0,1)</li></ul></li><li><p>\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u7CFB m2\uFF0C\u5176\u57FA\u5411\u91CF\u662F\uFF1A</p><ul><li>x(cos30\xB0, sin30\xB0,0)</li><li>y(-sin30\xB0,cos30\xB0,0)</li><li>z(0, 0, 1)</li></ul></li></ul><p>\u6C42\uFF1A\u5C06 m1 \u4E2D\u7684\u57FA\u5411\u91CF\u5BF9\u9F50\u5230 m2 \u7684\u884C\u4E3B\u5E8F\u77E9\u9635 m3<br><img src="`+N+`" alt=""></p><p>\u89E3\uFF1A</p><p>\u5C06 m2 \u7684\u57FA\u5411\u91CF x,y,z \u4E2D\u7684 x \u5206\u91CF\u5199\u5165 m3 \u7B2C 1 \u884C;<br> \u5C06 m2 \u7684\u57FA\u5411\u91CF x,y,z \u4E2D\u7684 y \u5206\u91CF\u5199\u5165 m3 \u7B2C 2 \u884C;<br> \u5C06 m2 \u7684\u57FA\u5411\u91CF x,y,z \u4E2D\u7684 z \u5206\u91CF\u5199\u5165 m3 \u7B2C 3 \u884C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m3<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u9898 4<br> \u7EE7\u9898 3 \u7684\u5DF2\u77E5\u6761\u4EF6<br> \u6C42\uFF1A\u5C06 m2 \u4E2D\u7684\u57FA\u5411\u91CF\u5BF9\u9F50\u5230 m1 \u7684\u884C\u4E3B\u5E8F\u77E9\u9635 m4</p><p>\u89E3\uFF1A<br> \u7531\u9898 3 \u5DF2\u77E5\uFF1A\u5C06 m1 \u4E2D\u7684\u57FA\u5411\u91CF\u5BF9\u9F50\u5230 m2 \u7684\u884C\u4E3B\u5E8F\u77E9\u9635\u662F m3<br> \u7531\u9898 4 \u7684\u95EE\u9898\u53EF\u77E5\uFF1Am4 \u5C31\u662F m3 \u7684\u9006\u77E9\u9635<br> \u56E0\u4E3A\uFF1A\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u5C31\u662F\u5176\u8F6C\u7F6E\u77E9\u9635<br> \u6240\u4EE5\uFF1Am4 \u5C31\u662F m3 \u7684\u8F6C\u7F6E\u77E9\u9635</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m3<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
m4<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_4-\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> 4.\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635</h4><p><img src="`+c+`" alt=""></p><ol><li>\u5148\u4F4D\u79FB\uFF1A\u5199\u51FA\u628A\u89C6\u70B9 e(ex,ey,ez) \u5BF9\u9F50\u5230 O \u70B9\u4E0A\u7684\u884C\u4E3B\u5E8F\u4F4D\u79FB\u77E9\u9635 mt</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mt
mt=<span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>-ex<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>-ey<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>-ez<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>\u5199\u51FA\u628A{o;x,y,-z} \u5BF9\u9F50\u5230{e;a,b,c} \u7684\u884C\u4E3B\u5E8F\u65CB\u8F6C\u77E9\u9635 mr1</li></ol><p>\u628A a,b,-c \u7684 x \u5206\u91CF\u5199\u5165 mr1 \u7684\u7B2C 1 \u884C\uFF1B<br> \u200B \u628A a,b,-c \u7684 y \u5206\u91CF\u5199\u5165 mr1 \u7684\u7B2C 2 \u884C\uFF1B<br> \u200B \u628A a,b,-c \u7684 z \u5206\u91CF\u5199\u5165 mr1 \u7684\u7B2C 3 \u884C\uFF1B</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mr1
mr1=<span class="token punctuation">[</span>
	 ax<span class="token punctuation">,</span> bx<span class="token punctuation">,</span> -cx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 ay<span class="token punctuation">,</span> by<span class="token punctuation">,</span> -cy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 az<span class="token punctuation">,</span> bz<span class="token punctuation">,</span> -cz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>\u8BA1\u7B97 mr1 \u7684\u9006\u77E9\u9635 mr2\u3002</li></ol><p>\u56E0\u4E3A\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u5C31\u662F\u5176\u8F6C\u7F6E\u77E9\u9635\uFF0C\u6240\u4EE5 mr2 \u5C31\u662F mr1 \u7684\u8F6C\u7F6E\u77E9\u9635\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mr2
mr2=<span class="token punctuation">[</span>
	 ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 bx<span class="token punctuation">,</span> by<span class="token punctuation">,</span> bz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	-cx<span class="token punctuation">,</span>-cy<span class="token punctuation">,</span>-cz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>\u89C6\u56FE\u6295\u5F71\u77E9\u9635=mr2*mt</li></ol><h4 id="_5-\u89C6\u56FE\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-\u89C6\u56FE\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 5.\u89C6\u56FE\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0</h4><p><img src="`+c+`" alt=""></p><p>\u57FA\u4E8E\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u751F\u6210\u89C6\u56FE\u77E9\u9635\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>getViewMatrix \u76F8\u5F53\u4E8E threeJS \u7684 lookAt \u65B9\u6CD5
function getViewMatrix(e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> u) <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u5411\u91CFc\uFF0C\u89C6\u7EBF</span>
  const c = new Vector3().subVectors(e<span class="token punctuation">,</span> t).normalize()
  <span class="token comment">//\u57FA\u5411\u91CFa\uFF0C\u89C6\u7EBF\u548C\u4E0A\u65B9\u5411\u7684\u5782\u7EBF</span>
  const a = new Vector3().crossVectors(u<span class="token punctuation">,</span> c).normalize()
  <span class="token comment">//\u57FA\u5411\u91CFb\uFF0C\u4FEE\u6B63\u4E0A\u65B9\u5411</span>
  const b = new Vector3().crossVectors(c<span class="token punctuation">,</span> a).normalize()
  <span class="token comment">//\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635</span>
  const mr = new Matrix4().set(
    ...a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    ...b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    -c.x<span class="token punctuation">,</span> -c.y<span class="token punctuation">,</span> -c.z<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
  )
  <span class="token comment">//\u4F4D\u79FB\u77E9\u9635</span>
  const mt = new Matrix4().set(
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> -e.x<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> -e.y<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> -e.z<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
  )
  return mr.multiply(mt).elements
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>getViewMatrix \u65B9\u6CD5\u5C31\u662F\u4ECE\u4E00\u4E2A\u65B0\u7684\u89D2\u5EA6\u53BB\u770B\u67D0\u4E00\u4E2A\u4E1C\u897F\u7684\u610F\u601D</p><ul><li>e \u89C6\u70B9</li><li>t \u76EE\u6807\u70B9</li><li>u \u4E0A\u65B9\u5411</li></ul><p>\u5728\u5176\u4E2D\u6211\u501F\u52A9\u4E86 Three.js \u7684 Vector3 \u5BF9\u8C61</p><ul><li>subVectors(e, t) \u5411\u91CF e \u51CF\u5411\u91CF t</li><li>normalize() \u5411\u91CF\u7684\u5F52\u4E00\u5316</li><li>crossVectors(u, d) \u5411\u91CF u \u548C\u5411\u91CF d \u7684\u53C9\u4E58</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">crossVectors</span><span class="token punctuation">(</span> <span class="token parameter">a<span class="token punctuation">,</span> b</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ax <span class="token operator">=</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> ay <span class="token operator">=</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> az <span class="token operator">=</span> a<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
  <span class="token keyword">const</span> bx <span class="token operator">=</span> b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> by <span class="token operator">=</span> b<span class="token punctuation">.</span>y<span class="token punctuation">,</span> bz <span class="token operator">=</span> b<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> ay <span class="token operator">*</span> bz <span class="token operator">-</span> az <span class="token operator">*</span> by<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> az <span class="token operator">*</span> bx <span class="token operator">-</span> ax <span class="token operator">*</span> bz<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token operator">=</span> ax <span class="token operator">*</span> by <span class="token operator">-</span> ay <span class="token operator">*</span> bx<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u57FA\u5411\u91CF a,b,c \u7684\u8FD0\u7B97\u539F\u7406\uFF0C\u4EE5\u4E0B\u56FE\u4E3A\u4F8B\uFF1A</p><p><img src="`+Y+`" alt=""></p><p>\u89C6\u7EBF c \u4E4B\u6240\u4EE5\u662F\u89C6\u70B9 e \u51CF\u76EE\u6807\u70B9 t\uFF0C\u662F\u4E3A\u4E86\u53D6\u4E00\u4E2A\u6B63\u5411\u7684\u57FA\u5411\u91CF\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>c<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token operator">-</span>t<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">|</span>e<span class="token operator">-</span>t<span class="token operator">|</span>
c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u57FA\u5411\u91CF a \u662F\u4E0A\u65B9\u5411 u \u548C\u5411\u91CF c \u7684\u53C9\u4E58</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a<span class="token operator">=</span>u<span class="token operator">^</span>c<span class="token operator">/</span><span class="token operator">|</span>u<span class="token operator">^</span>c<span class="token operator">|</span>
a<span class="token operator">=</span><span class="token punctuation">(</span>cos30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>cos30\xB0
a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u57FA\u5411\u91CF b \u662F\u5411\u91CF c \u548C\u5411\u91CF a \u7684\u53C9\u4E58\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3A\u628A\u4E0A\u65B9\u5411\u6446\u6B63</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>b<span class="token operator">=</span>c<span class="token operator">^</span>a<span class="token operator">/</span><span class="token operator">|</span>c<span class="token operator">^</span>a<span class="token operator">|</span>
b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1</span>
b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_6-\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_6-\u6D4B\u8BD5" aria-hidden="true">#</a> 6.\u6D4B\u8BD5</h4><ol><li>\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u89C6\u56FE\u77E9\u9635</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u89C6\u56FE\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token function">getViewMatrix</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u6CE8\uFF1A</p><p>three.js \u91CC\u7684 lookAt() \u65B9\u6CD5\u4FBF\u53EF\u4EE5\u5B9E\u73B0\u77E9\u9635\u7684\u6B63\u4EA4\u65CB\u8F6C\uFF0C\u5176\u53C2\u6570\u4E5F\u662F\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\uFF0C\u5B83\u7684\u5B9E\u73B0\u539F\u7406\u4E0A\u9762\u8BF4\u7684\u662F\u4E00\u6837\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-\u6A21\u578B\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-\u6A21\u578B\u77E9\u9635" aria-hidden="true">#</a> 4.\u6A21\u578B\u77E9\u9635</h3><p>\u6A21\u578B\u77E9\u9635\u53EF\u4EE5\u5BF9\u7269\u4F53\u8FDB\u884C\u4F4D\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u53D8\u6362\uFF0C\u6BD4\u5982\u6211\u4EEC\u60F3\u8BA9\u7269\u4F53\u6CBF z \u65CB\u8F6C</p><p>\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><ol><li>\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u6DFB\u52A0\u4E00\u4E2A\u6A21\u578B\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u6A21\u578B\u77E9\u9635</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    <span class="token comment">//\u89C6\u56FE\u77E9\u9635</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>\u5728 js \u4E2D\u5EFA\u7ACB\u6A21\u578B\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ModelMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="3"><li>\u6DFB\u52A0\u4E00\u4E2A\u65CB\u8F6C\u52A8\u753B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  angle <span class="token operator">+=</span> <span class="token number">0.02</span><span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>\u8FD8\u53EF\u4EE5\u6765\u4E2A\u5F39\u6027\u52A8\u753B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> maxY <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> maxY<span class="token punctuation">;</span>
<span class="token keyword">let</span> vy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ay <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.001</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bounce <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  angle <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
  vy <span class="token operator">+=</span> ay<span class="token punctuation">;</span>
  y <span class="token operator">+=</span> vy<span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> minY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> minY<span class="token punctuation">;</span>
    vy <span class="token operator">*=</span> <span class="token operator">-</span>bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="\u4E03\u3001\u989C\u8272\u4E0E\u7EB9\u7406" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001\u989C\u8272\u4E0E\u7EB9\u7406" aria-hidden="true">#</a> \u4E03\u3001\u989C\u8272\u4E0E\u7EB9\u7406</h2><h3 id="_1-\u591A-attribute-\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_1-\u591A-attribute-\u53D8\u91CF" aria-hidden="true">#</a> 1.\u591A attribute \u53D8\u91CF</h3><p>\u5982\u4F55\u4E00\u6B21\u6027\u7ED8\u5236\u4E09\u4E2A\u4E0D\u540C\u989C\u8272\u7684\u70B9\uFF1F</p><ol><li>\u591A\u70B9\u540C\u8272</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">50.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_FragColor<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>u_FragColor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u8FD9\u79CD\u65B9\u5F0F\u53EA\u4F1A\u7ED8\u5236\u4E09\u4E2A\u540C\u6837\u989C\u8272\u7684\u70B9\u3002<br> \u90A3\u6211\u4EEC\u82E5\u60F3\u7ED9\u8FD9\u4E09\u4E2A\u70B9\u4E0D\u540C\u7684\u989C\u8272\uFF0C\u5C31\u9700\u8981\u518D\u5EFA\u7ACB\u4E00\u4E2A\u63A5\u6536\u989C\u8272\u6570\u636E\u7684 attribute \u53D8\u91CF\u3002</p><ol start="2"><li>\u591A\u70B9\u5F02\u8272</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>&lt;canvas id=<span class="token string">&quot;canvas&quot;</span>&gt;&lt;/canvas&gt;
&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;
&lt;script id=<span class="token string">&quot;vertexShader&quot;</span> type=<span class="token string">&quot;x-shader/x-vertex&quot;</span>&gt;
  attribute vec4 a_Position;
  attribute vec4 a_Color;
  varying vec4 v_Color;
  void main()<span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position=a_Position;
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize=<span class="token number">50.0</span>;
      v_Color=a_Color;
  <span class="token punctuation">}</span>
&lt;/script&gt;
&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;
&lt;script id=<span class="token string">&quot;fragmentShader&quot;</span> type=<span class="token string">&quot;x-shader/x-fragment&quot;</span>&gt;
  precision mediump float;
  varying vec4 v_Color;
  void main()<span class="token punctuation">{</span>
      gl_FragColor=v_Color;
  <span class="token punctuation">}</span>
&lt;/script&gt;
&lt;script type=<span class="token string">&quot;module&quot;</span>&gt;
  import <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> from <span class="token string">&quot;../jsm/Utils.js&quot;</span>;

  const canvas = document.querySelector(<span class="token string">&quot;#canvas&quot;</span>);
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  const vsSource = document.querySelector(<span class="token string">&quot;#vertexShader&quot;</span>).innerText;
  const fsSource = document.querySelector(<span class="token string">&quot;#fragmentShader&quot;</span>).innerText;

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  const gl = canvas.getContext(<span class="token string">&quot;webgl&quot;</span>);

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  initShaders(gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource);
  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl.clearColor(<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>);

  <span class="token comment">//\u5982\u4F55\u5411attribute \u53D8\u91CF\u4E2D\u5199\u5165\u591A\u70B9\uFF0C\u5E76\u7ED8\u5236\u591A\u70B9</span>
  <span class="token comment">//\u9876\u70B9\u6570\u636E</span>
  const vertices = new Float32Array(<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token number">-0.2</span><span class="token punctuation">,</span> <span class="token number">-0.1</span><span class="token punctuation">,</span>
    <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">-0.1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>);
  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  const vertexBuffer = gl.createBuffer();
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl.bindBuffer(gl.ARRAY_BUFFER<span class="token punctuation">,</span> vertexBuffer);
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl.bufferData(gl.ARRAY_BUFFER<span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl.STATIC_DRAW)
  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  const a_Position = gl.getAttribLocation(gl.program<span class="token punctuation">,</span> &#39;a_Position&#39;)
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl.vertexAttribPointer(a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl.FLOAT<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>)
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl.enableVertexAttribArray(a_Position)


  <span class="token comment">//\u989C\u8272\u6570\u636E</span>
  const colors = new Float32Array(<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
  <span class="token punctuation">]</span>);
  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  const colorBuffer = gl.createBuffer();
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl.bindBuffer(gl.ARRAY_BUFFER<span class="token punctuation">,</span> colorBuffer);
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl.bufferData(gl.ARRAY_BUFFER<span class="token punctuation">,</span> colors<span class="token punctuation">,</span> gl.STATIC_DRAW)
  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  const a_Color = gl.getAttribLocation(gl.program<span class="token punctuation">,</span> &#39;a_Color&#39;)
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl.vertexAttribPointer(a_Color<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> gl.FLOAT<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>)
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl.enableVertexAttribArray(a_Color)

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl.clear(gl.COLOR_BUFFER_BIT);

  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl.drawArrays(gl.POINTS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span>);
&lt;/script&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><p>\u5728\u4E0A\u9762\u7684\u6848\u4F8B\u91CC\uFF0C\u7528 js \u5EFA\u7ACB\u4E86\u4E24\u4EFD attribute \u6570\u636E\uFF0C\u4E00\u4EFD\u662F\u9876\u70B9\u4F4D\u7F6E\u6570\u636E\uFF0C\u4E00\u4EFD\u662F\u9876\u70B9\u989C\u8272\u6570\u636E\u3002<br> \u7136\u540E\u5C06\u4E24\u4EFD attribute \u6570\u636E\u653E\u8FDB\u4E86\u4E86\u4E24\u4E2A\u7F13\u51B2\u533A\u5BF9\u8C61\u91CC\uFF0C\u540E\u9762\u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u9876\u70B9\u7740\u8272\u5668\u5C31\u4F1A\u4ECE\u8FD9\u91CC\u9762\u627E\u6570\u636E\u3002<br> \u5176\u5B9E\uFF0C\u4E5F\u53EF\u4EE5\u628A\u6570\u636E\u5408\u4E00\u4E0B\uFF0C\u628A\u70B9\u4F4D\u6570\u636E\u548C\u989C\u8272\u6570\u636E\u653E\u8FDB\u4E00\u4E2A\u96C6\u5408\u91CC\uFF0C\u7136\u540E\u8BA9 attribute \u53D8\u91CF\u6309\u7167\u67D0\u79CD\u89C4\u5F8B\u4ECE\u5176\u4E2D\u5BFB\u627E\u6570\u636E\u3002</p><ol start="3"><li>\u591A attribute \u6570\u636E\u5408\u4E00</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>&lt;canvas id=<span class="token string">&quot;canvas&quot;</span>&gt;&lt;/canvas&gt;
&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;
&lt;script id=<span class="token string">&quot;vertexShader&quot;</span> type=<span class="token string">&quot;x-shader/x-vertex&quot;</span>&gt;
  attribute vec4 a_Position;
  attribute vec4 a_Color;
  varying vec4 v_Color;
  void main()<span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position=a_Position;
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize=<span class="token number">50.0</span>;
      v_Color=a_Color;
  <span class="token punctuation">}</span>
&lt;/script&gt;
&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;
&lt;script id=<span class="token string">&quot;fragmentShader&quot;</span> type=<span class="token string">&quot;x-shader/x-fragment&quot;</span>&gt;
  precision mediump float;
  varying vec4 v_Color;
  void main()<span class="token punctuation">{</span>
      gl_FragColor=v_Color;
  <span class="token punctuation">}</span>
&lt;/script&gt;
&lt;script type=<span class="token string">&quot;module&quot;</span>&gt;
  import <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> from <span class="token string">&quot;../jsm/Utils.js&quot;</span>;

  const canvas = document.querySelector(<span class="token string">&quot;#canvas&quot;</span>);
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
  const vsSource = document.querySelector(<span class="token string">&quot;#vertexShader&quot;</span>).innerText;
  const fsSource = document.querySelector(<span class="token string">&quot;#fragmentShader&quot;</span>).innerText;

  <span class="token comment">//\u4E09\u7EF4\u753B\u7B14</span>
  const gl = canvas.getContext(<span class="token string">&quot;webgl&quot;</span>);

  <span class="token comment">//\u521D\u59CB\u5316\u7740\u8272\u5668</span>
  initShaders(gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource);
  <span class="token comment">//\u58F0\u660E\u989C\u8272 rgba</span>
  gl.clearColor(<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>);

  <span class="token comment">//\u6570\u636E\u6E90</span>
  const source = new Float32Array(<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">-0.2</span><span class="token punctuation">,</span> <span class="token number">-0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">-0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>);
  <span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
  const elementBytes = source.BYTES_PER_ELEMENT
  <span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
  const verticeSize = <span class="token number">3</span>
  const colorSize = <span class="token number">4</span>
  <span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
  const categorySize = verticeSize + colorSize
  <span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
  const categoryBytes = categorySize * elementBytes
  <span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
  const verticeByteIndex = <span class="token number">0</span>
  const colorByteIndex = verticeSize * elementBytes
  <span class="token comment">//\u9876\u70B9\u603B\u6570</span>
  const sourceSize = source.length / categorySize


  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  const sourceBuffer = gl.createBuffer();
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl.bindBuffer(gl.ARRAY_BUFFER<span class="token punctuation">,</span> sourceBuffer);
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl.bufferData(gl.ARRAY_BUFFER<span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl.STATIC_DRAW)

  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  const a_Position = gl.getAttribLocation(gl.program<span class="token punctuation">,</span> &#39;a_Position&#39;)
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl.vertexAttribPointer(
    a_Position<span class="token punctuation">,</span>
    verticeSize<span class="token punctuation">,</span>
    gl.FLOAT<span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    verticeByteIndex
  )
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl.enableVertexAttribArray(a_Position)

  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  const a_Color = gl.getAttribLocation(gl.program<span class="token punctuation">,</span> &#39;a_Color&#39;)
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl.vertexAttribPointer(
    a_Color<span class="token punctuation">,</span>
    colorSize<span class="token punctuation">,</span>
    gl.FLOAT<span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    colorByteIndex
  )
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl.enableVertexAttribArray(a_Color)

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl.clear(gl.COLOR_BUFFER_BIT);

  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl.drawArrays(gl.POINTS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize);
&lt;/script&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p>\u5BF9\u5E94\u4E0A\u9762\u7684\u6570\u636E\uFF0C\u6211\u4EEC\u8981\u5148\u6709\u4EE5\u4E0B\u6982\u5FF5\uFF1A</p><ul><li>\u6570\u636E\u6E90\uFF1A\u6574\u4E2A\u5408\u800C\u4E3A\u4E00\u7684\u6570\u636E source</li><li>\u5143\u7D20\u5B57\u8282\u6570\uFF1A32 \u4F4D\u6D6E\u70B9\u96C6\u5408\u4E2D\u6BCF\u4E2A\u5143\u7D20\u7684\u5B57\u8282\u6570</li><li>\u7C7B\u76EE\uFF1A\u4E00\u4E2A\u9876\u70B9\u5BF9\u5E94\u4E00\u4E2A\u7C7B\u76EE\uFF0C\u4E5F\u5C31\u662F\u4E0A\u9762 source \u4E2D\u7684\u6BCF\u4E00\u884C</li><li>\u7CFB\u5217\uFF1A\u4E00\u4E2A\u7C7B\u76EE\u4E2D\u6240\u5305\u542B\u7684\u6BCF\u4E00\u79CD\u6570\u636E\uFF0C\u6BD4\u5982\u9876\u70B9\u4F4D\u7F6E\u6570\u636E\u3001\u9876\u70B9\u989C\u8272\u6570\u636E</li><li>\u7CFB\u5217\u5C3A\u5BF8\uFF1A\u4E00\u4E2A\u7CFB\u5217\u6240\u5BF9\u5E94\u7684\u5411\u91CF\u7684\u5206\u91CF\u6570\u76EE</li><li>\u7C7B\u76EE\u5C3A\u5BF8\uFF1A\u4E00\u4E2A\u7C7B\u76EE\u4E2D\u6240\u6709\u7CFB\u5217\u5C3A\u5BF8\u7684\u603B\u548C</li><li>\u7C7B\u76EE\u5B57\u8282\u6570\uFF1A\u4E00\u4E2A\u7C7B\u76EE\u7684\u6240\u6709\u5B57\u8282\u6570\u91CF</li><li>\u7CFB\u5217\u5143\u7D20\u7D22\u5F15\u4F4D\u7F6E\uFF1A\u4E00\u4E2A\u7CFB\u5217\u5728\u4E00\u4E2A\u7C7B\u76EE\u4E2D\uFF0C\u4EE5\u96C6\u5408\u5143\u7D20\u4E3A\u5355\u4F4D\u7684\u7D22\u5F15\u4F4D\u7F6E</li><li>\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E\uFF1A\u4E00\u4E2A\u7CFB\u5217\u5728\u4E00\u4E2A\u7C7B\u76EE\u4E2D\uFF0C\u4EE5\u5B57\u8282\u4E3A\u5355\u4F4D\u7684\u7D22\u5F15\u4F4D\u7F6E</li><li>\u9876\u70B9\u603B\u6570\uFF1A\u6570\u636E\u6E90\u4E2D\u7684\u9876\u70B9\u603B\u6570</li></ul><p>vertexAttribPointer() \u65B9\u6CD5\u73A9\u8F6C\u6570\u636E\u6E90\uFF1A</p><ul><li>\u4EE5\u524D\u5728\u8BF4 vertexAttribPointer() \u7684\u65F6\u5019\uFF0C\u8BF4\u8FC7\u5B83\u7684\u529F\u80FD\u5C31\u662F\u8BA9 gl \u4FEE\u6539 attribute \u4E0A\u4E0B\u6587\u5BF9\u8C61\u7684\u3002</li><li>\u5176\u5B9E\u5177\u4F53\u800C\u8A00\uFF0C\u5B83\u662F\u5728\u544A\u8BC9\u9876\u70B9\u7740\u8272\u5668\u4E2D\u7684 attribute \u53D8\u91CF\u4EE5\u600E\u6837\u7684\u65B9\u5F0F\u4ECE\u9876\u70B9\u7740\u8272\u5668\u4E2D\u5BFB\u627E\u5B83\u6240\u9700\u8981\u7684\u6570\u636E\u3002</li><li>\u6BD4\u5982\uFF0C\u6211\u60F3\u8BA9\u9876\u70B9\u7740\u8272\u5668\u4E2D\uFF0C\u540D\u53EB a_Position \u7684 attribute \u7684\u53D8\u91CF\u4ECE\u6570\u636E\u6E90\u4E2D\uFF0C\u5BFB\u627E\u5B83\u6240\u9700\u8981\u7684\u6570\u636E\u3002</li></ul><p>gl.vertexAttribPointer(index, size, type, normalized, stride, offset)</p><ul><li>index\uFF1Aattribute \u53D8\u91CF\uFF0C\u5177\u4F53\u800C\u8A00\u662F\u6307\u5411\u5B58\u50A8 attribute \u53D8\u91CF\u7684\u7A7A\u95F4\u7684\u6307\u9488</li><li>size\uFF1A\u7CFB\u5217\u5C3A\u5BF8</li><li>type\uFF1A\u5143\u7D20\u7684\u6570\u636E\u7C7B\u578B</li><li>normalized\uFF1A\u662F\u5426\u5F52\u4E00\u5316</li><li>stride\uFF1A\u7C7B\u76EE\u5B57\u8282\u6570</li><li>offset\uFF1A\u7CFB\u5217\u7D22\u5F15\u4F4D\u7F6E</li></ul><h3 id="_2-\u5F69\u8272\u4E09\u89D2\u5F62" tabindex="-1"><a class="header-anchor" href="#_2-\u5F69\u8272\u4E09\u89D2\u5F62" aria-hidden="true">#</a> 2.\u5F69\u8272\u4E09\u89D2\u5F62</h3><p>\u53EF\u4EE5\u7528\u72EC\u7ACB\u4E09\u89D2\u5F62\u7ED8\u56FE\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourseSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+X+'" alt=""></p><p>\u539F\u7406\uFF1A<br> \u4E09\u89D2\u5F62\u7684\u4E09\u4E2A\u9876\u70B9\u7ED1\u5B9A\u4E86\u4E09\u79CD\u989C\u8272\uFF0C\u5728\u4E09\u4E2A\u70B9\u4E4B\u95F4\u505A\u7EBF\u6027\u8865\u95F4\uFF0C\u5C06\u8865\u95F4\u5F97\u51FA\u7684\u989C\u8272\u586B\u5145\u5230\u4E09\u89D2\u5F62\u6240\u56F4\u6210\u7684\u6BCF\u4E2A\u7247\u5143\u4E4B\u4E2D\u3002</p><p><img src="'+H+'" alt=""></p><h3 id="_3-\u7EB9\u7406" tabindex="-1"><a class="header-anchor" href="#_3-\u7EB9\u7406" aria-hidden="true">#</a> 3.\u7EB9\u7406</h3><p>\u7EB9\u7406\uFF0C\u901A\u5E38\u6307\u7684\u5C31\u662F\u4E8C\u7EF4\u7684\u6805\u683C\u56FE\u50CF\uFF0C\u53EF\u4EE5\u5C06\u5176\u4F5C\u4E3A webgl \u56FE\u5F62\u7684\u8D34\u56FE\u3002</p><p>\u800C\u5728 webgl \u91CC\uFF0C\u8FD8\u6709\u4E00\u4E2A\u7EB9\u7406\u5BF9\u8C61\u7684\u6982\u5FF5\uFF0C\u5B83\u662F\u5BF9\u56FE\u50CF\u53C8\u505A\u4E86\u4E00\u5C42\u5C01\u88C5\u3002</p><h4 id="_1-\u57FA\u7840\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u7840\u6982\u5FF5" aria-hidden="true">#</a> 1.\u57FA\u7840\u6982\u5FF5</h4><ol><li>\u6805\u683C\u7CFB\u7EDF</li></ol><p>\u5728\u8BF4\u56FE\u50CF\u7684\u65F6\u5019\uFF0C\u5F80\u5F80\u90FD\u662F\u6307\u70B9\u9635\u56FE\u3001\u6805\u683C\u56FE\u3001\u4F4D\u56FE\uFF0C\u800C\u4E0E\u5176\u76F8\u5BF9\u5E94\u7684\u662F\u56FE\u5F62\uFF0C\u4E5F\u505A\u77E2\u91CF\u56FE\u3002</p><p>\u7EB9\u7406\uFF0C\u5C31\u662F\u5C5E\u4E8E\u56FE\u50CF\uFF0C\u5176\u56FE\u50CF\u7684\u5EFA\u7ACB\u548C\u663E\u793A\u4F1A\u9075\u5FAA\u6805\u683C\u7CFB\u7EDF\u91CC\u7684\u89C4\u8303</p><p>\u6240\u6709\u56FE\u50CF\u90FD\u662F\u7531\u50CF\u7D20\u7EC4\u6210\u7684\uFF0C\u5728 webgl \u91CC\u6211\u4EEC\u628A\u50CF\u7D20\u79F0\u4E3A\u7247\u5143\uFF0C\u50CF\u7D20\u662F\u6309\u7167\u76F8\u4E92\u5782\u76F4\u7684\u884C\u5217\u6392\u5217\u7684</p><p>\u5982\u4E0B\u56FE\uFF1A<br><img src="'+G+'" alt=""></p><p>\u5C06\u5176\u653E\u5927\u540E\u5C31\u53EF\u4EE5\u770B\u89C1\u5176\u4E2D\u7684\u6805\u683C\uFF1A<br><img src="'+Z+'" alt=""></p><p>\u56FE\u50CF\u4E2D\u7684\u6BCF\u4E2A\u50CF\u7D20\u90FD\u53EF\u4EE5\u901A\u8FC7\u884C\u6570 y \u548C\u5217\u6570 x \u6765\u627E\u5230\uFF0C\u7531(x,y) \u6784\u6210\u7684\u70B9\u4F4D\uFF0C\u5C31\u662F\u56FE\u50CF\u7684\u50CF\u7D20\u5750\u6807\u3002</p><p>\u56E0\u4E3A canvas \u753B\u5E03\u4E5F\u662F\u4E00\u5F20\u56FE\u50CF\uFF0C\u6240\u4EE5\u56FE\u50CF\u7684\u6805\u683C\u5750\u6807\u7CFB\u548C\u6211\u4EEC\u4E4B\u524D\u8BF4\u8FC7\u7684 canvas2d \u7684\u5750\u6807\u7CFB\u662F\u4E00\u6837\u7684\uFF0C\u6211\u4EEC\u53EF\u4EE5\u7B80\u5355\u56DE\u987E\u4E00\u4E0B\uFF1A</p><p><img src="'+o+'" alt=""></p><p>\u6805\u683C\u5750\u6807\u7CFB\u7684\u539F\u70B9\u5728\u5DE6\u4E0A\u89D2\u3002<br> \u6805\u683C\u5750\u6807\u7CFB\u7684 y \u8F74\u65B9\u5411\u662F\u671D\u4E0B\u7684\u3002<br> \u6805\u683C\u5750\u6807\u7CFB\u7684\u5750\u6807\u57FA\u5E95\u7531\u4E24\u4E2A\u5206\u91CF\u7EC4\u6210\uFF0C\u5206\u522B\u662F\u4E00\u4E2A\u50CF\u7D20\u7684\u5BBD\u548C\u4E00\u4E2A\u50CF\u7D20\u7684\u9AD8\u3002</p><ol start="2"><li>\u56FE\u9489</li></ol><p>\u56FE\u9489\u662F\u6211\u81EA\u5DF1\u5199\u7684\u6982\u5FF5\uFF0C\u6E90\u81EA\u4E8E photoshop \u4E2D\u56FE\u50CF\u7684\u64CD\u63A7\u53D8\u5F62\u529F\u80FD\uFF0C\u8FD9\u79CD\u79F0\u547C\u5F88\u5F62\u8C61\u3002</p><p><img src="'+Q+'" alt=""></p><p>webgl \u4E2D\uFF0C\u56FE\u9489\u7684\u4F4D\u7F6E\u662F\u901A\u8FC7 uv \u5750\u6807\u6765\u63A7\u5236\u7684\uFF0C\u56FE\u9489\u7684 uv \u5750\u6807\u548C\u9876\u70B9\u7684 webgl \u5750\u6807\u662F\u4E24\u79CD\u4E0D\u540C\u7684\u5750\u6807\u7CFB\u7EDF\uFF0C\u4E4B\u540E\u4F1A\u5C06\u5176\u76F8\u4E92\u6620\u5C04\uFF0C\u4ECE\u800C\u5C06\u56FE\u50CF\u7279\u5B9A\u7684\u4E00\u5757\u533A\u57DF\u8D34\u5230 webgl \u56FE\u5F62\u4E2D\u3002</p><p>\u6BD4\u5982\u5C06\u5176\u6620\u5C04\u5230\u4E0B\u9762\u7684\u84DD\u8272\u4E09\u89D2\u5F62\u4E2D\uFF1A<br><img src="'+K+'" alt=""></p><p>\u6CE8\uFF1A\u5728 webgl \u91CC\u6253\u56FE\u9489\u7684\u65F6\u5019\u4E0D\u4F1A\u53D1\u751F\u8FB9\u754C\u7EBF\u7684\u626D\u66F2\uFF0C\u4E0A\u56FE\u91CD\u5728\u793A\u610F\u3002</p><ol start="3"><li>uv \u5750\u6807\u7CFB</li></ol><p><img src="'+J+`" alt=""></p><p>uv \u5750\u6807\u7CFB\uFF0C\u4E5F\u53EB st \u5750\u6807\u7CFB\uFF0C\u5750\u6807\u539F\u70B9\u5728\u56FE\u50CF\u7684\u5DE6\u4E0B\u89D2\uFF0Cu \u8F74\u5728\u53F3\uFF0Cv \u8F74\u5728\u4E0A<br> u \u8F74\u4E0A\u7684 1 \u4E2A\u5355\u4F4D\u662F\u56FE\u50CF\u7684\u5BBD\uFF1B<br> v \u8F74\u4E0A\u7684\u4E00\u4E2A\u5355\u4F4D\u662F\u56FE\u50CF\u7684\u9AD8\u3002</p><ol start="4"><li>\u91C7\u6837\u5668</li></ol><p>\u91C7\u6837\u5668\u662F\u6309\u7167\u56FE\u9489\u4F4D\u7F6E\u4ECE\u56FE\u50CF\u4E2D\u83B7\u53D6\u7247\u5143\u7684\u65B9\u5F0F\u3002</p><p>\u5728\u56FE\u50CF\u4E2D\u6240\u6253\u7684\u56FE\u9489\u4F4D\u7F6E\uFF0C\u5E76\u4E0D\u662F\u56FE\u50CF\u4E2D\u67D0\u4E00\u4E2A\u7247\u5143\u7684\u4F4D\u7F6E\uFF0C\u56E0\u4E3A\u7247\u5143\u4F4D\u7F6E\u8D70\u7684\u662F\u6805\u683C\u5750\u6807\u7CFB\u3002</p><p>\u6240\u4EE5\u9700\u8981\u4E00\u4E2A\u91C7\u6837\u5668\u53BB\u5BF9\u56FE\u9489\u7684 uv \u5750\u6807\u7CFB\u548C\u50CF\u7D20\u7684\u6805\u683C\u5750\u6807\u7CFB\u505A\u6620\u5C04\uFF0C\u4ECE\u800C\u53BB\u91C7\u96C6\u56FE\u50CF\u4E2D\u56FE\u9489\u6240\u5BF9\u5E94\u7684\u7247\u5143\u3002</p><p>\u7740\u8272\u5668\u57FA\u4E8E\u4E00\u5F20\u56FE\u50CF\u53EF\u4EE5\u5EFA\u7ACB\u4E00\u4E2A\u6216\u591A\u4E2A\u91C7\u6837\u5668\uFF0C\u4E0D\u540C\u7684\u91C7\u6837\u5668\u53EF\u4EE5\u5B9A\u4E49\u4E0D\u540C\u7684\u89C4\u5219\u53BB\u83B7\u53D6\u56FE\u50CF\u4E2D\u7684\u7247\u5143\u3002</p><p>\u91C7\u6837\u5668\u5728\u7740\u8272\u5668\u4E2D\u662F\u4E00\u79CD\u53D8\u91CF\u7C7B\u578B\uFF0C\u5199\u505A sampler2D\uFF0C\u5B83\u5C31\u50CF\u6211\u4EEC\u4E4B\u524D\u5199\u8FC7\u7684 vec4 \u7C7B\u578B\u4E00\u6837\uFF0C\u53EF\u4EE5\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u901A\u8FC7 uniform \u53D8\u91CF\u66B4\u9732\u7ED9 js\uFF0C\u8BA9 js \u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u3002</p><ol start="5"><li>\u7EB9\u7406\u5BF9\u8C61</li></ol><p>\u7740\u8272\u5668\u4F7F\u7528\u4E00\u4E2A\u7EB9\u7406\u5BF9\u8C61\uFF0C\u5C31\u53EF\u4EE5\u5EFA\u7ACB\u4E00\u4E2A\u91C7\u6837\u5668\u3002</p><p>\u7EB9\u7406\u5BF9\u8C61\u7684\u5EFA\u7ACB\u9700\u8981\u4E00\u4E2A\u56FE\u50CF\u6E90\uFF0C\u6BD4\u5982 Image \u5BF9\u8C61\u3002</p><p>\u540C\u65F6\uFF0C\u8FD8\u9700\u8981\u8BBE\u7F6E\u7EB9\u7406\u5BF9\u8C61\u548C\u56FE\u9489\u8FDB\u884C\u6570\u636E\u6620\u5C04\u7684\u65B9\u5F0F\u3002</p><p>js =&gt; \u7EB9\u7406\u5BF9\u8C61\uFF0Cwebgl =&gt; \u7F13\u51B2\u533A<br> \u7F13\u5B58\u533A\u7528\u4E8E\u5B58\u653E\u7EB9\u7406\u5BF9\u8C61\u7684\u78C1\u76D8\u7A7A\u95F4\uFF0C\u8FD9\u5757\u7A7A\u95F4\u53EF\u4EE5\u5C06\u7EB9\u7406\u5BF9\u8C61\u7FFB\u8BD1\u6210\u7740\u8272\u5668\u53EF\u4EE5\u8BFB\u61C2\u7684\u6570\u636E\u3002<br> \u4E4B\u540E\u4F1A\u628A\u8FD9\u4E2A\u7A7A\u95F4\u7684\u7D22\u5F15\u4F4D\u7F6E\u4F20\u7ED9\u7740\u8272\u5668\uFF0C\u8BA9\u7740\u8272\u5668\u57FA\u4E8E\u8FD9\u4E2A\u7A7A\u95F4\u7684\u7D22\u5F15\u4F4D\u7F6E\uFF0C\u627E\u5230\u8FD9\u4E2A\u7A7A\u95F4\uFF0C\u7136\u540E\u518D\u4ECE\u7A7A\u95F4\u4E2D\u627E\u5230\u7EB9\u7406\u5BF9\u8C61\uFF0C\u6700\u540E\u901A\u8FC7\u7EB9\u7406\u5BF9\u8C61\u5EFA\u7ACB\u91C7\u6837\u5668\u3002</p><ol start="6"><li>\u7EB9\u7406\u5355\u5143</li></ol><p>\u7EB9\u7406\u5355\u5143\u662F\u4E00\u79CD\u4E13\u95E8\u7528\u6765\u5B58\u653E\u7EB9\u7406\u5BF9\u8C61\u7684\u7F13\u51B2\u533A\uFF0C\u5C31\u50CF\u6211\u4EEC\u4E4B\u524D\u7528 createBuffer()\u65B9\u6CD5\u5EFA\u7ACB\u7684\u7528\u4E8E\u5B58\u50A8\u6570\u636E\u6E90\u7684\u7F13\u51B2\u533A\u4E00\u6837\u3002</p><p>webgl=&gt; \u7EB9\u7406\u5355\u5143\uFF0C\u5982 TEXTURE0|1|2|3|4|5|6|7|</p><p>\u7EB9\u7406\u5355\u5143\u867D\u7136\u65E0\u9700\u6211\u4EEC\u81EA\u5DF1\u5EFA\u7ACB\uFF0C\u4F46\u9700\u8981\u6211\u4EEC\u81EA\u5DF1\u6FC0\u6D3B\uFF0C\u8BA9\u5176\u8FDB\u5165\u4F7F\u7528\u72B6\u6001</p><h4 id="_2-\u6574\u4F53\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_2-\u6574\u4F53\u4EE3\u7801" aria-hidden="true">#</a> 2.\u6574\u4F53\u4EE3\u7801</h4><ol><li>\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      v_Pin<span class="token operator">=</span>a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>a_Pin \u56FE\u9489\u4F4D\u7F6E</li></ul><ol start="2"><li>\u7247\u5143\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>sampler2D \u662F uniform \u53D8\u91CF\u7684\u7C7B\u578B\uFF0C\u53EB\u505A\u4E8C\u7EF4\u53D6\u6837\u5668</li><li>texture2D() \u57FA\u4E8E\u56FE\u9489\u4ECE\u53D6\u6837\u5668\u4E2D\u83B7\u53D6\u7247\u5143\u989C\u8272</li></ul><ol start="3"><li>\u521D\u59CB\u5316\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="4"><li>\u5EFA\u7ACB\u6570\u636E\u6E90\uFF0C\u5E76\u8BA1\u7B97\u76F8\u5E94\u5C3A\u5BF8</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//\u6570\u636E\u6E90</span>
const source = new Float32Array(<span class="token punctuation">[</span>
    <span class="token number">-0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">-0.5</span><span class="token punctuation">,</span> <span class="token number">-0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">-0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>);
const FSIZE = source.BYTES_PER_ELEMENT;
<span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
const elementBytes = source.BYTES_PER_ELEMENT
<span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
const posSize = <span class="token number">2</span>
const PinSize = <span class="token number">2</span>
<span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
const categorySize = posSize + PinSize
<span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
const categoryBytes = categorySize * elementBytes
<span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
const posByteIndex = <span class="token number">0</span>
const pinByteIndex = posSize * elementBytes
<span class="token comment">//\u9876\u70B9\u603B\u6570</span>
const sourceSize = source.length / categorySize
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>\u6570\u636E\u6E90\u4E2D\u6709\u4E24\u4E2A\u7CFB\u5217\uFF0C\u5206\u522B\u662F\u9876\u70B9\u4F4D\u7F6E\u7CFB\u5217\u548C\u56FE\u9489\u4F4D\u7F6E\u7CFB\u5217\u3002</p><ol start="5"><li>\u5C06\u6570\u636E\u6E90\u5199\u5165\u5230\u7F13\u51B2\u533A\uFF0C\u8BA9 attribute \u53D8\u91CF\u4ECE\u5176\u4E2D\u5BFB\u627E\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sourceBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
  a_Position<span class="token punctuation">,</span>
  posSize<span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  categoryBytes<span class="token punctuation">,</span>
  posByteIndex
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> a_Pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Pin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
  a_Pin<span class="token punctuation">,</span>
  pinSize<span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  categoryBytes<span class="token punctuation">,</span>
  pinByteIndex
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ol start="6"><li>\u5EFA\u7ACB Image \u56FE\u50CF\u4F5C\u4E3A\u56FE\u50CF\u6E90\uFF0C\u5F53\u56FE\u50CF\u6E90\u52A0\u8F7D\u6210\u529F\u540E\u518D\u8D34\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5BF9\u7EB9\u7406\u56FE\u50CF\u5782\u76F4\u7FFB\u8F6C</span>
gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6FC0\u6D3B0\u53F7\u7EB9\u7406\u5355\u5143</span>
gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7EB9\u7406\u5BF9\u8C61</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u628A\u7EB9\u7406\u5BF9\u8C61\u88C5\u8FDB\u7EB9\u7406\u5355\u5143\u91CC</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//image \u5BF9\u8C61</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha2.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">showMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//\u8D34\u56FE</span>
<span class="token keyword">function</span> <span class="token function">showMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u914D\u7F6E\u7EB9\u7406\u56FE\u50CF</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u914D\u7F6E\u7EB9\u7406\u53C2\u6570</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u83B7\u53D6u_Sampler</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5C060\u53F7\u7EB9\u7406\u5206\u914D\u7ED9\u7740\u8272\u5668\uFF0C0 \u662F\u7EB9\u7406\u5355\u5143\u7F16\u53F7</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="_3-\u8D34\u56FE\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#_3-\u8D34\u56FE\u8BE6\u89E3" aria-hidden="true">#</a> 3.\u8D34\u56FE\u8BE6\u89E3</h4><ol><li>\u51C6\u5907\u4E09\u4E2A\u89D2\u8272</li></ol><ul><li>Image \u56FE\u50CF</li><li>\u7EB9\u7406\u5BF9\u8C61</li><li>\u7EB9\u7406\u5355\u5143</li></ul><p><img src="`+$+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6FC0\u6D3B0\u53F7\u7EB9\u7406\u5355\u5143</span>
gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7EB9\u7406\u5BF9\u8C61</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//image \u5BF9\u8C61</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>\u628A\u7EB9\u7406\u5BF9\u8C61\u88C5\u8FDB\u5F53\u524D\u5DF2\u88AB\u6FC0\u6D3B\u7684\u7EB9\u7406\u5355\u5143\u91CC</li></ol><p><img src="`+nn+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>TEXTURE_2D \u7EB9\u7406\u5BF9\u8C61\u7684\u7C7B\u578B</li></ul><ol start="3"><li>\u5F53 Image \u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u628A\u56FE\u50CF\u88C5\u8FDB\u5F53\u524D\u7EB9\u7406\u5355\u5143\u7684\u7EB9\u7406\u5BF9\u8C61\u91CC</li></ol><p><img src="`+sn+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>texImage2D(type, level, internalformat, format, type, pixels)</p><ul><li>type \u7EB9\u7406\u7C7B\u578B</li><li>level \u57FA\u672C\u56FE\u50CF\u7B49\u7EA7</li><li>internalformat \u7EB9\u7406\u4E2D\u7684\u989C\u8272\u7EC4\u4EF6</li><li>format \u7EB9\u7406\u6570\u636E\u683C\u5F0F\uFF0C\u5FC5\u987B\u548C internalformat \u4E00\u6837</li><li>type \u7EB9\u7406\u6570\u636E\u7684\u6570\u636E\u7C7B\u578B <ul><li>UNSIGNED_BYTE \u65E0\u7B26\u53F7\u5B57\u8282</li></ul></li><li>pixels \u56FE\u50CF\u6E90</li></ul><ol start="4"><li>\u7EB9\u7406\u5BF9\u8C61\u8FD8\u6709\u4E00\u4E9B\u76F8\u5E94\u53C2\u6570\u9700\u8981\u8BBE\u7F6E\u4E00\u4E0B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>texParameteri(type, pname, param)</p><ul><li>type \u7EB9\u7406\u7C7B\u578B <ul><li>TEXTURE_2D \u4E8C\u7EF4\u7EB9\u7406</li></ul></li><li>pname \u7EB9\u7406\u53C2\u6570\u7684\u540D\u79F0 <ul><li>TEXTURE_MIN_FILTER \u7EB9\u7406\u7F29\u5C0F\u6EE4\u6CE2\u5668</li></ul></li><li>param \u4E0E pname \u76F8\u5BF9\u5E94\u7684\u7EB9\u7406\u53C2\u6570\u503C <ul><li>gl.LINEAR \u7EBF\u6027</li></ul></li></ul><ol start="5"><li>\u5728 js \u4E2D\u83B7\u53D6\u91C7\u6837\u5668\u5BF9\u5E94\u7684 Uniform \u53D8\u91CF,\u544A\u8BC9\u7247\u5143\u7740\u8272\u5668\u4E2D\u7684\u91C7\u6837\u5668\uFF0C\u7EB9\u7406\u5BF9\u8C61\u5728\u54EA\u4E2A\u5355\u5143\u91CC\u3002\u4E4B\u540E\u91C7\u6837\u5668\u4FBF\u4F1A\u6839\u636E\u5355\u5143\u53F7\u53BB\u5355\u5143\u5BF9\u8C61\u4E2D\u5BFB\u627E\u7EB9\u7406\u5BF9\u8C61</li></ol><p><img src="`+an+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="6"><li>\u6E32\u67D3</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+pn+`" alt=""><br> \u8FD9\u65F6\u5019\u7684\u56FE\u50CF\u662F\u5012\u7ACB\u7684\uFF0C\u8FD9\u662F\u7531\u4E8E Image \u5BF9\u8C61\u9075\u5B88\u7684\u662F\u6805\u683C\u5750\u6807\u7CFB\uFF0C\u6805\u683C\u5750\u6807\u7CFB\u7684 y \u8F74\u671D\u4E0B\uFF0C\u800C uv \u5750\u6807\u7CFB\u7684 y \u671D\u4E0A\uFF0C\u4E24\u8005\u76F8\u53CD\uFF0C\u6240\u4EE5\u753B\u51FA\u7684\u56FE\u5F62\u53CD\u4E86\u3002</p><ol start="7"><li>\u5BF9\u56FE\u50CF\u8FDB\u884C\u9884\u5904\u7406\uFF0C\u5C06\u56FE\u50CF\u5782\u76F4\u7FFB\u8F6C</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>pixelStorei(pname, param) \u56FE\u50CF\u9884\u5904\u7406</p><ul><li>pname \u53C2\u6570\u540D <ul><li>gl.UNPACK_FLIP_Y_WEBGL \u662F\u5426\u5782\u76F4\u7FFB\uFF0C\u5E03\u5C14\u503C\uFF0C1|0</li></ul></li><li>param \u53C2\u6570\u503C</li></ul><p><img src="`+tn+`" alt=""></p><h4 id="_4-\u7EB9\u7406\u5BB9\u5668" tabindex="-1"><a class="header-anchor" href="#_4-\u7EB9\u7406\u5BB9\u5668" aria-hidden="true">#</a> 4.\u7EB9\u7406\u5BB9\u5668</h4><p>\u5728\u8D34\u56FE\u7684\u65F6\u5019\uFF0C\u9ED8\u8BA4\u56FE\u50CF\u6E90\u7684\u5C3A\u5BF8\u53EA\u80FD\u662F 2 \u7684 n \u6B21\u65B9\uFF0C\u6BD4\u5982 2\u30014\u30018\u300116\u3001\u2026\u2026\u3001256\u3001512 \u7B49\uFF0C\u5982\u679C\u6211\u4EEC\u628A\u56FE\u50CF\u7684\u5C3A\u5BF8\u6539\u6210\u975E 2 \u6B21\u5E42\u5C3A\u5BF8\uFF0C\u5982 300*300\uFF0C\u90A3\u8D34\u56FE\u5C31\u65E0\u6CD5\u663E\u793A\u3002</p><p>\u8981\u60F3\u89E3\u51B3\u8FD9\u79CD\u95EE\u9898\uFF0C\u5C31\u5F97\u8BBE\u7F6E\u4E00\u4E0B\u7EB9\u7406\u7684\u5BB9\u5668\uFF0C\u5728\u56FE\u50CF\u4E0A\u6253\u56FE\u9489\u7684\u65F6\u5019\uFF0C\u5F62\u6210\u4E00\u5757 uv \u533A\u57DF\uFF0C\u8FD9\u5757\u533A\u57DF\u53EF\u4EE5\u7406\u89E3\u4E3A\u7EB9\u7406\u5BB9\u5668\u3002\u7EB9\u7406\u5BB9\u5668\u53EF\u4EE5\u5B9A\u4E49\u56FE\u9489\u533A\u57DF\u7684\u7EB9\u7406\u5982\u4F55\u663E\u793A\u5728 webgl \u56FE\u5F62\u4E2D\u3002\u901A\u8FC7\u5BF9\u7EB9\u7406\u5BB9\u5668\u7684\u8BBE\u7F6E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5B9E\u73B0\u4EE5\u4E0B\u529F\u80FD\uFF1A</p><ul><li>\u975E\u4E8C\u6B21\u5E42\u56FE\u50CF\u6E90\u7684\u663E\u793A</li><li>\u7EB9\u7406\u7684\u590D\u5236</li><li>\u7EB9\u7406\u7684\u955C\u50CF</li></ul><ol><li>\u975E\u4E8C\u6B21\u5E42\u56FE\u50CF\u6E90\u7684\u663E\u793A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>TEXTURE_WRAP_S \u548C TEXTURE_WRAP_T \u5C31\u662F\u7EB9\u7406\u5BB9\u5668\u5728 s \u65B9\u5411\u548C t \u65B9\u5411\u7684\u5C3A\u5BF8\uFF0C\u8FD9\u91CC\u7684 s\u3001t \u5C31\u662F st \u5750\u6807\u7CFB\u91CC\u7684 s\u3001t\uFF0Cst \u5750\u6807\u7CFB\u548C uv \u5750\u6807\u7CFB\u662F\u4E00\u56DE\u4E8B\u3002</p><p>CLAMP_TO_EDGE \u7FFB\u8BD1\u8FC7\u6765\u5C31\u662F\u8FB9\u7F18\u5939\u7D27\u7684\u610F\u601D\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3A\u4EFB\u610F\u5C3A\u5BF8\u7684\u56FE\u50CF\u6E90\u90FD\u53EF\u4EE5\u88AB\u5BBD\u9AD8\u4E3A 1 \u7684 uv \u5C3A\u5BF8\u5939\u7D27\u3002</p><p>\u6CE8\uFF1A\u53EA\u6709 CLAMP_TO_EDGE \u624D\u80FD\u5B9E\u73B0\u975E\u4E8C\u6B21\u5E42\u56FE\u50CF\u6E90\u7684\u663E\u793A\uFF0C\u5176\u5B83\u7684\u53C2\u6570\u90FD\u4E0D\u53EF\u4EE5\u3002</p><ol start="2"><li>\u7EB9\u7406\u7684\u590D\u5236</li></ol><p>uv \u5750\u6807\u7CFB\u7684\u5750\u6807\u57FA\u5E95\u5206\u522B\u662F 1 \u4E2A\u56FE\u7247\u7684\u5BBD\u548C 1 \u4E2A\u56FE\u7247\u7684\u9AD8\uFF0C\u53EF\u662F\u5982\u679C\u6211\u4EEC\u5C06 2 \u4E2A\u56FE\u7247\u7684\u5BBD\u9AD8\u6620\u5C04\u5230\u4E86\u56FE\u5F62\u4E0A\u4F1A\u662F\u4EC0\u4E48\u7ED3\u679C\u5462\uFF1F</p><p>\u9ED8\u8BA4\u662F\u8FD9\u6837\u7684\uFF1A<br><img src="`+en+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>REPEAT \u5C31\u662F\u7EB9\u7406\u91CD\u590D\u7684\u610F\u601D</p><ol start="3"><li>\u7EB9\u7406\u7684\u955C\u50CF\u590D\u5236 \u7EB9\u7406\u7684\u955C\u50CF\u590D\u5236\u53EF\u4EE5\u5B9E\u73B0\u7EB9\u7406\u7684\u6C34\u5E73\u3001\u5782\u76F4\u7FFB\u8F6C\u548C\u590D\u5236\u3002</li></ol><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+on+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">MIRRORED_REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">MIRRORED_REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>MIRRORED_REPEAT \u5C31\u662F\u955C\u50CF\u590D\u5236\u7684\u610F\u601D\u3002</p><p>\u4E5F\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528 CLAMP_TO_EDGE \u53EA\u5BF9\u67D0\u4E00\u4E2A\u65B9\u5411\u7EB9\u7406\u955C\u50CF\u590D\u5236</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">MIRRORED_REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+cn+'" alt=""></p><h4 id="_5-\u5206\u5B50\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_5-\u5206\u5B50\u8D34\u56FE" aria-hidden="true">#</a> 5.\u5206\u5B50\u8D34\u56FE</h4><p>\u5206\u5B50\u8D34\u56FE mipmap \u662F\u4E00\u79CD\u7EB9\u7406\u6620\u5C04\u6280\u672F\u3002</p><p>\u6BD4\u5982\uFF1A</p><p>webgl \u4E2D\u6709\u4E00\u4E2A\u6B63\u65B9\u5F62\uFF0C\u5B83\u5728 canvas \u753B\u5E03\u4E2D\u663E\u793A\u7684\u65F6\u5019\uFF0C\u5360\u636E\u4E86 2*2 \u4E2A\u50CF\u7D20\uFF0C\u6211\u4EEC\u8981\u5C06\u4E00\u4E2A 8*8 \u7684\u56FE\u50CF\u6E90\u8D34\u4E0A\u53BB\u3002</p><p>\u6B63\u65B9\u5F62\u4E2D\u80AF\u5B9A\u4E0D\u80FD\u663E\u793A\u56FE\u50CF\u6E90\u4E2D\u7684\u6240\u6709\u50CF\u7D20\uFF0C\u56E0\u4E3A\u5B83\u53EA\u6709 2*2=4 \u4E2A\u50CF\u7D20\u3002</p><p>\u5728 Photoshop \u4E2D\uFF0C\u4F1A\u5C06\u56FE\u50CF\u6E90\u5207\u5272\u6210 2 \u884C\u30012 \u5217\u7684\u8272\u5757\uFF0C\u7136\u540E\u5C06\u6BCF\u4E2A\u8272\u5757\u7684\u5747\u503C\u4EA4\u4E2A\u6B63\u65B9\u5F62\u3002</p><p>\u5728 webgl \u4E2D\u4E5F\u6709\u7C7B\u4F3C\u7684\u65B9\u6CD5\uFF0C\u5E76\u4E14\u5B83\u8FD8\u6709\u4E00\u5C42\u6E32\u67D3\u6027\u80FD\u7684\u4F18\u5316\uFF08Photoshop \u5E95\u5C42\u662F\u5426\u6709\u8FD9\u5C42\u4F18\u5316\u6211\u5C1A\u4E14\u4E0D\u77E5\uFF09\u3002</p><p>\u63A5\u4E0B\u6765\u54B1\u4EEC\u5C31\u8BF4\u4E00\u4E0B\u8FD9\u5C42\u4F18\u5316\u4F18\u5316\u7684\u662F\u4EC0\u4E48\u3002</p><p>\u5148\u60F3\u8C61\u4E00\u4E2A\u573A\u666F\uFF0C\u6211\u8981\u628A 1024*1024 \u7684\u56FE\u50CF\u6E90\u6620\u5C04\u5230 canvas \u753B\u5E03\u4E0A 2*2 \u7684\u6B63\u65B9\u5F62\u4E2D\uFF0C\u82E5\u628A\u56FE\u50CF\u6E90\u5206\u5272\u6C42\u5747\u503C\u4F1A\u4EA7\u751F\u5E9E\u5927\u7684\u6570\u636E\u8FD0\u7B97\uFF0C\u6211\u4EEC\u9700\u8981\u60F3\u529E\u6CD5\u628A\u548C\u6B63\u65B9\u5F62\u76F8\u6620\u5C04\u7684\u56FE\u50CF\u6E90\u7684\u5C3A\u5BF8\u964D\u5230\u6700\u5C0F\uFF0C\u6BD4\u5982\u5C31\u662F 2*2 \u7684\u3002</p>',458),Cn=n("\u56E0\u6B64\uFF0C\u6211\u4EEC\u5C31\u9700\u8981"),Ln={href:"https://baike.baidu.com/item/Mipmap/3722136?fr=aladdin",target:"_blank",rel:"noopener noreferrer"},Un=n("\u5206\u5B50\u8D34\u56FE"),Vn=n("\u4E86\u3002"),Dn=p('<p>\u5206\u5B50\u8D34\u56FE\u662F\u4E00\u4E2A\u57FA\u4E8E\u5206\u8FA8\u7387\u7B49\u6BD4\u6392\u5217\u7684\u56FE\u50CF\u96C6\u5408\uFF0C\u96C6\u5408\u4E2D\u6BCF\u4E00\u9879\u7684\u5BBD\u9AD8\u4E0E\u5176\u524D\u4E00\u9879\u5BBD\u9AD8\u7684\u6BD4\u503C\u90FD\u662F 1/2\u3002</p><p>\u5982\u4E0B\u56FE\uFF1A</p><p><img src="'+ln+`" alt=""></p><p>\u5728 webgl \u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 gl.generateMipmap() \u65B9\u6CD5\u4E3A\u56FE\u50CF\u6E90\u521B\u5EFA\u5206\u5B50\u8D34\u56FE\uFF0C</p><p>\u6709\u4E86\u5206\u5B50\u8D34\u56FE\u540E\uFF0C\u4E4B\u524D 2*2 \u7684\u6B63\u65B9\u5F62\u4FBF\u4F1A\u4ECE\u5206\u5B50\u96C6\u5408\u4E2D\u5BFB\u627E\u4E0E\u5176\u5206\u8FA8\u7387\u6700\u63A5\u8FD1\u7684\u5206\u5B50\u56FE\u50CF\u3002</p><p>\u5728\u627E\u5230\u5206\u5B50\u56FE\u50CF\u540E\uFF0C\u5C31\u9700\u8981\u57FA\u4E8E webgl \u56FE\u5F62\u7684\u7247\u5143\u5C3A\u5BF8\u5BF9\u5176\u5206\u5272\u53D6\u8272\u4E86\u3002</p><p>\u5BF9\u4E8E\u53D6\u8272\u7684\u65B9\u6CD5\uFF0C\u54B1\u4EEC\u4E4B\u524D\u8BF4\u4E00\u4E2A\u5747\u503C\u7B97\u6CD5\uFF0C\u5176\u5B9E\u8FD8\u6709\u5176\u5B83\u7B97\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u521B\u5EFA\u5206\u5B50\u8D34\u56FE</span>
gl<span class="token punctuation">.</span><span class="token function">generateMipmap</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u5B9A\u4E49\u4ECE\u5206\u5B50\u56FE\u50CF\u4E2D\u53D6\u8272\u7684\u65B9\u6CD5</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>gl.texParameteri()\u65B9\u6CD5\u4E2D\u7684\u7B2C 2 \u4E2A\u53C2\u6570\u548C\u7B2C 3 \u4E2A\u53C2\u6570\u662F\u952E\u503C\u5BF9\u7684\u5173\u7CFB\u3002</p><p>TEXTURE_MAG_FILTER \u548C TEXTURE_MIN_FILTER\uFF0C\u5BF9\u5E94\u7684\u662F\u7EB9\u7406\u5728 webgl \u56FE\u5F62\u4E2D\u7684\u7F29\u653E\u60C5\u51B5\u3002</p><ul><li>TEXTURE_MAG_FILTER \u7EB9\u7406\u653E\u5927\u6EE4\u6CE2\u5668\uFF0C\u662F\u7EB9\u7406\u5728 webgl \u56FE\u5F62\u4E2D\u88AB\u653E\u5927\u7684\u60C5\u51B5\u3002</li><li>TEXTURE_MIN_FILTER \u7EB9\u7406\u7F29\u5C0F\u6EE4\u6CE2\u5668\uFF0C\u662F\u7EB9\u7406\u5728 webgl \u56FE\u5F62\u4E2D\u88AB\u7F29\u5C0F\u7684\u60C5\u51B5\u3002</li></ul><p>TEXTURE_MAG_FILTER \u5177\u5907\u4EE5\u4E0B\u53C2\u6570\uFF1A</p><ul><li>LINEAR (\u9ED8\u8BA4\u503C) \uFF0C\u7EBF\u6027\u6EE4\u955C\uFF0C \u83B7\u53D6\u7EB9\u7406\u5750\u6807\u70B9\u9644\u8FD1 4 \u4E2A\u50CF\u7D20\u7684\u52A0\u6743\u5E73\u5747\u503C\uFF0C\u6548\u679C\u5E73\u6ED1</li><li>NEAREST \u6700\u8FD1\u6EE4\u955C\uFF0C \u83B7\u5F97\u6700\u9760\u8FD1\u7EB9\u7406\u5750\u6807\u70B9\u7684\u50CF\u7D20 \uFF0C\u6548\u679C\u9510\u5229</li></ul><p>TEXTURE_MIN_FILTER \u5177\u5907\u4EE5\u4E0B\u53C2\u6570\uFF1A</p><ul><li>LINEAR \u7EBF\u6027\u6EE4\u955C\uFF0C\u83B7\u53D6\u7EB9\u7406\u5750\u6807\u70B9\u9644\u8FD1 4 \u4E2A\u50CF\u7D20\u7684\u52A0\u6743\u5E73\u5747\u503C\uFF0C\u6548\u679C\u5E73\u6ED1</li><li>NEAREST \u6700\u8FD1\u6EE4\u955C\uFF0C \u83B7\u5F97\u6700\u9760\u8FD1\u7EB9\u7406\u5750\u6807\u70B9\u7684\u50CF\u7D20\uFF0C\u6548\u679C\u9510\u5229</li><li>NEAREST_MIPMAP_NEAREST Select the nearest mip level and perform nearest neighbor filtering .</li><li>NEAREST_MIPMAP_LINEAR (\u9ED8\u8BA4\u503C) Perform a linear interpolation between mip levels and perform nearest neighbor filtering within each .</li><li>LINEAR_MIPMAP_NEAREST Select the nearest mip level and perform linear filtering within it .</li><li>LINEAR_MIPMAP_LINEAR Perform a linear interpolation between mip levels and perform linear filtering : also called trilinear filtering .</li></ul><p>\u6CE8\uFF1A\u540E\u9762\u8FD9 4 \u4E2A\u4E0E\u5206\u5B50\u8D34\u56FE\u76F8\u5173\u7684\u53C2\u6570\u9002\u5408\u6BD4\u8F83\u5927\u7684\u8D34\u56FE\uFF0C\u82E5\u662F\u6BD4\u8F83\u5C0F\u7684\u8D34\u56FE\uFF0C\u4F7F\u7528 LINEAR \u6216 NEAREST \u5C31\u597D\u3002</p><p>\u6CE8\uFF1A\u7F29\u5C0F\u6EE4\u6CE2\u5668\u7684\u9ED8\u8BA4\u503C\u53D6\u8272\u65B9\u6CD5\u662F NEAREST_MIPMAP_LINEAR \uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u4ECE\u5206\u5B50\u8D34\u56FE\u91CC\u627E\u5206\u5B50\u56FE\u50CF\uFF0C\u7136\u540E\u4ECE\u5176\u4E2D\u53D6\u8272\uFF0C\u7136\u800C\u5F53\u6211\u4EEC\u6CA1\u6709\u4F7F\u7528 gl.generateMipmap()\u65B9\u6CD5\u5EFA\u7ACB\u5206\u5B50\u8D34\u56FE\u7684\u65F6\u5019\uFF0C\u5C31\u5F97\u7ED9\u5B83\u4E00\u4E2A\u4E0D\u9700\u8981\u4ECE\u5206\u5B50\u8D34\u56FE\u4E2D\u53BB\u8272\u7684\u65B9\u6CD5\uFF0C\u5982 LINEAR \u6216 NEAREST\u3002</p><h4 id="_6-\u591A\u7EB9\u7406\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_6-\u591A\u7EB9\u7406\u6A21\u578B" aria-hidden="true">#</a> 6.\u591A\u7EB9\u7406\u6A21\u578B</h4><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u7ECF\u5E38\u4F1A\u9047\u5230\u4E00\u4E2A\u6A21\u578B\uFF0C\u591A\u4E2A\u7EB9\u7406\u7684\u7684\u60C5\u51B5\u3002</p><p>\u6BD4\u5982\u8FD9\u4E2A\u9B54\u65B9\uFF1A</p><p><img src="`+un+'" alt=""></p><p>\u6709\u65F6\u5019\u4F1A\u5F88\u81EA\u7136\u7684\u60F3\u5230\u4E00\u4E2A\u9762\u7ED9\u5B83\u4E00\u4E2A\u8D34\u56FE\uFF0C\u800C\u5B9E\u9645\u4E0A\uFF0C\u6700\u9AD8\u6548\u7684\u65B9\u5F0F\u662F\u4E00\u4E2A\u7269\u4F53\u7ED9\u5B83\u4E00\u4E2A\u8D34\u56FE\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><p><img src="'+rn+`" alt=""></p><p>\u8FD9\u6837\u53EA\u9700\u8981\u52A0\u8F7D\u4E00\u6B21\u56FE\u7247\uFF0C\u5EFA\u7ACB\u4E00\u4E2A\u7EB9\u7406\u5BF9\u8C61\uFF0C\u505A\u4E00\u6B21\u7EB9\u7406\u548C\u9876\u70B9\u6570\u636E\u7684\u6620\u5C04\u5C31\u53EF\u4EE5\u4E86\u3002</p><p>\u8FD9\u91CC\u9762\u6CA1\u6709\u6D89\u53CA\u4EFB\u4F55\u65B0\u7684\u77E5\u8BC6\u70B9\uFF0C\u4F46\u8FD9\u662F\u4E00\u79CD\u5F88\u91CD\u8981\u7684\u9879\u76EE\u5F00\u53D1\u7ECF\u9A8C\u3002</p><h3 id="_4-\u7EB9\u7406\u5408\u6210" tabindex="-1"><a class="header-anchor" href="#_4-\u7EB9\u7406\u5408\u6210" aria-hidden="true">#</a> 4.\u7EB9\u7406\u5408\u6210</h3><p>\u7EB9\u7406\u5408\u6210\u5C31\u662F\u6309\u7167\u67D0\u79CD\u89C4\u5219\u5C06\u591A\u5F20\u56FE\u7247\u5408\u5728\u4E00\u8D77\u3002</p><h4 id="_4-1-\u591A\u56FE\u52A0\u8F7D" tabindex="-1"><a class="header-anchor" href="#_4-1-\u591A\u56FE\u52A0\u8F7D" aria-hidden="true">#</a> 4-1 \u591A\u56FE\u52A0\u8F7D</h4><p>\u7EB9\u7406\u5408\u6210\u662F\u9700\u8981\u591A\u5F20\u56FE\u50CF\u6E90\u7684\uFF0C\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u591A\u5F20\u56FE\u50CF\u6E90\u90FD\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u518D\u53BB\u5408\u6210\u7EB9\u7406\u3002</p><ol><li>\u5C06\u56FE\u50CF\u7684\u52A0\u8F7D\u65B9\u6CD5\u5C01\u88C5\u8FDB\u4E00\u4E2A Promise \u4E2D\uFF0C\u7B49\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u518D resolve\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">imgPromise</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u591A\u4E2A Image \u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> originImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
originImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/dress.jpg&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pattern<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/pattern1.jpg&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>\u5229\u7528 Promise.all \u76D1\u542C\u6240\u6709\u56FE\u7247\u7684\u8BB0\u8F7D\u6210\u529F</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">imgPromise</span><span class="token punctuation">(</span>originImg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">imgPromise</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rect<span class="token punctuation">.</span>maps <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> originImg <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_Pattern</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> pattern <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  rect<span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u7B49\u6240\u6709\u7684\u56FE\u7247\u90FD\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u4F1A\u5F80 rect \u7684 maps \u96C6\u5408\u91CC\u5199\u5165\u8D34\u56FE\uFF0C\u7136\u540E\u5BF9\u5176\u66F4\u65B0\u548C\u6E32\u67D3\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u770B\u4E00\u4E0B\u7EB9\u7406\u5408\u6210\u6700\u6838\u5FC3\u7684\u5730\u65B9\uFF0C\u7247\u5143\u7740\u8272\u5668\u3002</p><h4 id="_4-2-\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5408\u6210\u7EB9\u7406" tabindex="-1"><a class="header-anchor" href="#_4-2-\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5408\u6210\u7EB9\u7406" aria-hidden="true">#</a> 4-2 \u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5408\u6210\u7EB9\u7406</h4><p>\u7247\u5143\u7740\u8272\u5668\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>  
  precision mediump float<span class="token punctuation">;</span>  
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>  
  uniform sampler2D u_Pattern<span class="token punctuation">;</span>  
  varying vec2 v_Pin<span class="token punctuation">;</span>  
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    vec4 o<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    vec4 p<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    gl_FragColor<span class="token operator">=</span>p<span class="token operator">*</span>o<span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>u_Sampler \u662F\u539F\u59CB\u56FE\u7247\u91C7\u6837\u5668\uFF0C\u5BF9\u5E94\u4E0B\u56FE\uFF1A</li></ul><p><img src="`+kn+'" alt=""></p><ul><li>u_Pattern \u662F\u7EB9\u7406\u56FE\u6848\u91C7\u6837\u5668\uFF0C\u5BF9\u5E94\u4E0B\u56FE\uFF1A</li></ul><p><img src="'+bn+`" alt=""></p><p>\u4E4B\u540E\uFF0C\u901A\u8FC7\u91C7\u6837\u5668\u627E\u5230\u539F\u59CB\u56FE\u7247\u548C\u7EB9\u7406\u56FE\u6848\u7684\u7247\u5143\u540E\uFF0C\u4FBF\u53EF\u4EE5\u5BF9\u5176\u8FDB\u884C\u8FD0\u7B97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 o<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 p<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl_FragColor<span class="token operator">=</span>p<span class="token operator">*</span>o<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4E0A\u9762\u7684 p*o \u4FBF\u662F\u5728\u5BF9\u7247\u5143\u505A\u5206\u91CF\u76F8\u4E58\u7684\u8FD0\u7B97\uFF0C\u8FD9\u79CD\u7B97\u6CD5\u4F1A\u8BA9\u539F\u59CB\u56FE\u7247\u7684\u4EAE\u5EA6\u53D8\u6697\uFF0C\u6709\u70B9\u7C7B\u4F3C\u4E8E ps \u91CC\u7684\u6B63\u7247\u53E0\u5E95\u3002</p><p><img src="`+mn+`" alt=""></p><p>\u4E3E\u4E2A\u4F8B\u5B50\u8BF4\u4E00\u4E0B\u7247\u5143\u76F8\u4E58\u7684\u903B\u8F91\u3002</p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u539F\u59CB\u56FE\u50CF\u7247\u5143 o(ox,oy,oz,ow)</li><li>\u7EB9\u7406\u56FE\u6848\u7247\u5143 p(px,py,pz,pw)</li></ul><p>\u6C42\uFF1Ap*o</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>p <span class="token operator">*</span> o <span class="token operator">=</span> <span class="token punctuation">(</span>px <span class="token operator">*</span> ox<span class="token punctuation">,</span> py <span class="token operator">*</span> oy<span class="token punctuation">,</span> pz <span class="token operator">*</span> oz<span class="token punctuation">,</span> pw <span class="token operator">*</span> ow<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u901A\u8FC7\u6B64\u4F8B\u53EF\u77E5\uFF1A\u56E0\u4E3A\u7247\u5143\u5206\u91CF\u7684\u503C\u57DF\u4E3A[0,1]\uFF0C\u6240\u4EE5 p*o \u7684\u4EAE\u5EA6\u5C0F\u4E8E\u7B49\u4E8E p \u548C o</p><ul><li>\u5F53 p=(1,1,1,1) \u65F6\uFF0Cp*o=o</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>p <span class="token operator">*</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> ox<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> oy<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> oz<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> ow<span class="token punctuation">)</span><span class="token punctuation">;</span>
p <span class="token operator">*</span> o <span class="token operator">=</span> <span class="token punctuation">(</span>ox<span class="token punctuation">,</span> oy<span class="token punctuation">,</span> oz<span class="token punctuation">,</span> ow<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>\u5F53 p=(0,0,0,0) \u65F6\uFF0Cp*o=(0,0,0,0)</li></ul><h4 id="_4-3-\u7EB9\u7406\u6DF7\u5408" tabindex="-1"><a class="header-anchor" href="#_4-3-\u7EB9\u7406\u6DF7\u5408" aria-hidden="true">#</a> 4-3 \u7EB9\u7406\u6DF7\u5408</h4><p>\u7EB9\u7406\u6DF7\u5408\u5C31\u662F\u6309\u7167\u4E00\u5B9A\u6BD4\u4F8B\uFF0C\u5C06\u7B2C\u4E00\u5F20\u56FE\u50CF\u5408\u5230\u53E6\u4E00\u5F20\u56FE\u50CF\u4E0A\uFF0C\u8FD9\u7C7B\u4F3C\u4E8E ps \u91CC\u7684\u900F\u660E\u5EA6\u5408\u6210\u3002</p><p>\u76F4\u63A5\u770B\u4E00\u4E0B\u7EB9\u7406\u5728\u7247\u5143\u7740\u8272\u91CC\u7684\u5408\u6210\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>  
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  uniform sampler2D u_Pattern<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec4 o<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 p<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">mix</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span>p<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u4E0A\u9762\u7684 mix() \u65B9\u6CD5\u4FBF\u662F\u6309\u7167\u6BD4\u4F8B\u5BF9\u4E24\u4E2A\u7EB9\u7406\u7684\u5408\u6210\u65B9\u6CD5\u3002</p><p>mix() \u65B9\u6CD5\u7684\u8FD4\u56DE\u6570\u636E\u7C7B\u578B\u4F1A\u56E0\u5176\u5408\u6210\u5BF9\u8C61\u7684\u4E0D\u540C\u800C\u4E0D\u540C\u3002</p><p>\u5176\u89C4\u5219\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> m <span class="token operator">+</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> m<span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4F8B 1\uFF1A</p><ul><li>m=3</li><li>n=5</li><li>a=0.5</li></ul><p>\u6C42\uFF1Amix(m,n,a)</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4F8B 2\uFF1A</p><ul><li>m=(1,2,3)</li><li>n=(3,4,5)</li><li>a=0.5</li></ul><p>\u6C42\uFF1Amix(m,n,a)</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7B80\u5355\u603B\u7ED3\u4E00\u4E0B mix(m,n,a) \u65B9\u6CD5\u7684\u7279\u6027\uFF1A</p><ul><li>\u5F53 a=0 \u65F6\uFF0Cmix(m,n,a)=m</li><li>\u5F53 a=1 \u65F6\uFF0Cmix(m,n,a)=n</li></ul><p>\u53C2\u8003\u5730\u5740\uFF1Ahttps://www.khronos.org/registry/OpenGL-Refpages/gl4/</p><p>\u5229\u7528\u7EB9\u7406\u6DF7\u5408\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5B9E\u73B0\u8F6C\u573A\u52A8\u753B\u3002</p><h3 id="_5-\u8DE8\u57DF\u56FE\u50CF\u505A\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_5-\u8DE8\u57DF\u56FE\u50CF\u505A\u8D34\u56FE" aria-hidden="true">#</a> 5.\u8DE8\u57DF\u56FE\u50CF\u505A\u8D34\u56FE</h3><p>\u8FD9\u91CC\u8981\u8BF4\u7684\u8DE8\u57DF\u56FE\u50CF\u95EE\u9898\uFF0C\u5E76\u4E0D\u5355\u662F webgl \u95EE\u9898\uFF0C\u4E5F\u662F canvas 2d \u91CC\u7684\u95EE\u9898\u3002</p><ol><li>img \u6807\u7B7E\u4E0E\u8DE8\u57DF\u56FE\u50CF</li></ol><p>\u7528 img \u6807\u7B7E\u663E\u793A\u8DE8\u57DF\u56FE\u50CF\u7684\u65F6\u5019\uFF0C\u53EA\u80FD\u5C06\u56FE\u50CF\u5C55\u793A\u7ED9\u7528\u6237\uFF0C\u4F46\u5E76\u4E0D\u80FD\u83B7\u53D6\u56FE\u50CF\u4E2D\u7684\u6570\u636E\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;https://xxx/xxx.png&#39;&quot;</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0D\u80FD\u901A\u8FC7 img \u6807\u7B7E\u83B7\u53D6\u56FE\u50CF\u6570\u636E\uFF0C\u662F\u6D4F\u89C8\u5668\u51FA\u4E8E\u5B89\u5168\u8003\u8651\u7684\uFF0C\u56E0\u4E3A\u6709\u7684\u56FE\u50CF\u91CC\u53EF\u80FD\u4F1A\u542B\u6709\u9A8C\u8BC1\u7801\u3001\u7B7E\u540D\u3001\u6216\u8005\u5176\u5B83\u4E0D\u53EF\u544A\u4EBA\u7684\u4E1C\u4E1C\uFF0C\u8FD9\u79CD\u6570\u636E\u662F\u4E0D\u80FD\u968F\u610F\u88AB\u522B\u4EBA\u83B7\u53D6\u7684\u3002</p><ol start="2"><li>\u83B7\u53D6\u56FE\u50CF\u6570\u636E</li></ol><p>\u82E5\u56FE\u50CF\u662F\u540C\u57DF\u7684\uFF0C\u4E0B\u9762\u7684\u65B9\u6CD5\u662F\u6CA1\u95EE\u9898\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx.png&quot;</span><span class="token punctuation">;</span>

img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u82E5\u56FE\u50CF\u662F\u8DE8\u57DF\u7684\uFF0C\u90A3\u5C31\u4F1A\u62A5\u9519\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Failed to execute <span class="token string">&#39;getImageData&#39;</span> on <span class="token string">&#39;CanvasRenderingContext2D&#39;</span><span class="token operator">:</span> The canvas has been tainted by cross<span class="token operator">-</span>origin data<span class="token punctuation">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7528 webgl \u83B7\u53D6\u8DE8\u57DF\u56FE\u50CF\u6570\u636E\u65F6\uFF0C\u4E5F\u4F1A\u62A5\u9519\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx.png&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u9519\u8BEF\u4FE1\u606F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Failed to execute <span class="token string">&#39;texImage2D&#39;</span> on <span class="token string">&#39;WebGLRenderingContext&#39;</span><span class="token operator">:</span> The image element contains cross<span class="token operator">-</span>origin data<span class="token punctuation">,</span> and may not be loaded<span class="token punctuation">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>CORS \u8DE8\u57DF</li></ol><p>CORS \u662F Cross Origin Resource Sharing \u7684\u7B80\u5199\uFF0C\u8BD1\u4F5C\u8DE8\u57DF\u8D44\u6E90\u5171\u4EAB\u3002</p><p>CORS \u662F\u4E00\u79CD\u7F51\u9875\u5411\u56FE\u50CF\u670D\u52A1\u5668\u8BF7\u6C42\u4F7F\u7528\u56FE\u50CF\u8BB8\u53EF\u7684\u65B9\u5F0F\u3002</p><p>CORS \u7684\u5B9E\u73B0\u8FC7\u7A0B\u5982\u4E0B\uFF1A</p><p>1.\u5148\u8BA9\u670D\u52A1\u5668\u5411\u5176\u5B83\u57DF\u540D\u653E\u6743\uFF0C\u6BD4\u5982 Apache \u670D\u52A1\u5668\u9700\u8981\u8FD9\u6837\u8BBE\u7F6E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Header <span class="token keyword">set</span> Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin <span class="token string">&quot;*&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0A\u9762\u4EE3\u7801\u7684\u610F\u601D\u5C31\u662F\u5141\u8BB8\u5176\u5B83\u57DF\u540D\u7684\u7F51\u9875\u8DE8\u57DF\u83B7\u53D6\u81EA\u5DF1\u670D\u52A1\u7AEF\u7684\u8D44\u6E90\u3002</p><p>\u4E0A\u9762\u7684* \u662F\u5141\u8BB8\u6240\u6709\u57DF\u540D\u83B7\u53D6\u5176\u670D\u52A1\u7AEF\u8D44\u6E90\u3002</p><p>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u5199\u5177\u4F53\u7684\u57DF\u540D\uFF0C\u4ECE\u800C\u5141\u8BB8\u7279\u5B9A\u57DF\u540D\u83B7\u53D6\u5176\u670D\u52A1\u7AEF\u8D44\u6E90\u3002</p><p>2.\u5728\u7F51\u9875\u91CC\uFF0C\u901A\u8FC7\u7279\u5B9A\u7684\u65B9\u6CD5\u544A\u8BC9\u670D\u52A1\u7AEF\uFF0C\u6211\u9700\u8981\u8DE8\u57DF\u83B7\u53D6\u4F60\u7684\u8D44\u6E90\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx.png&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;crossOrigin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6709\u4E86\u4E0A\u9762 crossOrigin \u5C5E\u6027\u7684\u8BBE\u7F6E\uFF0C\u65E0\u8BBA\u662F\u5728 canvas 2d \u91CC\u4F7F\u7528\u6B64\u56FE\u50CF\u6E90\uFF0C\u8FD8\u662F\u5728 webgl \u91CC\u4F7F\u7528\u6B64\u56FE\u50CF\u6E90\uFF0C\u90FD\u4E0D\u4F1A\u62A5\u9519\u3002</p><p>crossOrigin \u63A5\u6536\u7684\u503C\u6709\u4E09\u79CD\uFF1A</p><ul><li>undefined \u662F\u9ED8\u8BA4\u503C\uFF0C\u8868\u793A\u4E0D\u9700\u8981\u5411\u5176\u5B83\u57DF\u540D\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u5171\u4EAB</li><li>anonymous \u5411\u5176\u5B83\u57DF\u540D\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u5171\u4EAB\uFF0C\u4F46\u4E0D\u9700\u8981\u5411\u5176\u53D1\u9001\u4EFB\u4F55\u4FE1\u606F</li><li>use-credentials \u5411\u5176\u5B83\u57DF\u540D\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u5171\u4EAB\uFF0C\u5E76\u53D1\u9001 cookies \u7B49\u4FE1\u606F\uFF0C\u670D\u52A1\u5668\u4F1A\u901A\u8FC7\u8FD9\u4E9B\u4FE1\u606F\u51B3\u5B9A\u662F\u5426\u6388\u6743</li></ul><h3 id="_6-\u89C6\u9891\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-\u89C6\u9891\u8D34\u56FE" aria-hidden="true">#</a> 6.\u89C6\u9891\u8D34\u56FE</h3><p>\u4E4B\u524D\u4F7F\u7528 texImage2D \u65B9\u6CD5\u5C06 Image \u56FE\u50CF\u6E90\u88C5\u8FDB\u4E86\u7EB9\u7406\u5BF9\u8C61\u91CC\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E5F\u53EF\u4EE5\u628A\u4E0A\u9762\u7684 image \u6362\u6210 video \u5BF9\u8C61</p><ol><li>\u6B63\u5E38\u5EFA\u7ACB\u7EB9\u7406\u5BF9\u8C61\uFF0C\u5E76\u8BBE\u7F6E\u5176\u76F8\u5173\u5C5E\u6027</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>\u83B7\u53D6\u91C7\u6837\u5668\u5BF9\u5E94\u7684 uniform \u53D8\u91CF\uFF0C\u5E76\u5C06\u7EB9\u7406\u5355\u5143\u53F7\u8D4B\u7ED9\u5B83</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>\u5EFA\u7ACB video \u5BF9\u8C61\uFF0C\u5E76\u64AD\u653E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://img.yxyy.name/ripples.mp4&quot;</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>autoplay <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>muted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;crossOrigin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;playing&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>\u5728 video \u5BF9\u8C61\u64AD\u653E\u65F6\uFF0C\u5411\u7EB9\u7406\u5BF9\u8C61\u8FDE\u7EED\u5199\u5165 video</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> video<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="\u516B\u3001\u4E16\u754C\u5750\u6807\u548C\u672C\u5730\u5750\u6807" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001\u4E16\u754C\u5750\u6807\u548C\u672C\u5730\u5750\u6807" aria-hidden="true">#</a> \u516B\u3001\u4E16\u754C\u5750\u6807\u548C\u672C\u5730\u5750\u6807</h2><h3 id="_1-\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> 1-\u57FA\u672C\u6982\u5FF5</h3><p>\u8FDB\u5165\u4E09\u7EF4\u4E16\u754C\uFF0C\u5FC5\u987B\u8981\u5148\u6709\u5750\u6807\u7CFB\u7684\u6982\u5FF5\uFF0C\u800C\u4E0D\u8981\u53EA\u60F3\u7740\u5982\u4F55\u8BA9\u7269\u4F53\u98DE\u5929\u9041\u5730\u3002</p><p>\u5750\u6807\u7CFB\u6309\u7167\u5C42\u7EA7\u5206\u4E3A\uFF1A</p><ul><li>\u4E16\u754C\u5750\u6807\u7CFB</li><li>\u672C\u5730\u5750\u6807\u7CFB</li></ul><p>\u5F53\u7136\uFF0C\u5750\u6807\u7CFB\u8FD8\u53EF\u4EE5\u6309\u7167\u7C7B\u578B\u6765\u5206\uFF0C\u6BD4\u5982\uFF1A\u76F4\u89D2\u5750\u6807\u7CFB\u3001\u6781\u5750\u6807\u7CFB\u7B49\u3002</p><p>\u63A5\u4E0B\u6765\u8BF4\u8BF4\u4E16\u754C\u5750\u6807\u7CFB\u548C\u672C\u5730\u5750\u6807\u7CFB\u3002</p><p>\u901A\u8FC7\u4E00\u4E2A\u795E\u7684\u4F20\u8BF4\uFF0C\u5F15\u51FA\u4E16\u754C\u5750\u6807\u7CFB\u548C\u672C\u5730\u5750\u6807\u7CFB\u7684\u6982\u5FF5\u3002</p><p>\u5929\u5730\u6DF7\u6C8C\u4E4B\u65F6\uFF0C\u5B87\u5B99\u53EA\u662F\u4E00\u4E2A\u86CB\u3002</p><p>\u8FD9\u4E2A\u86CB\u4E4B\u6240\u5728\uFF0C\u5C31\u662F\u4E16\u754C\u5750\u6807\u7CFB\u7684\u539F\u70B9\u6240\u5728\u3002</p><p>\u5341\u4E07\u516B\u5343\u5E74\u540E\uFF0C\u76D8\u53E4\u4E00\u65A7\u5C06\u86CB\u5288\u5F00\uFF0C\u8FD9\u4E2A\u86CB\u6CA1\u4E86\uFF0C\u5B87\u5B99\u4E5F\u53D8\u5F97\u65E0\u7A77\u65E0\u5C3D\u4E86\uFF0C\u5176\u4E2D\u4E07\u7269\u521D\u751F\uFF0C\u4E16\u754C\u5750\u6807\u7CFB\u91CC\u7684\u5750\u6807\u8F74\u4E5F\u5E94\u8FD0\u800C\u751F\uFF0C\u4EE5\u6B64\u5B9A\u4F4D\u4E07\u7269\u3002</p><p>\u7136\u5219\uFF0C\u5B87\u5B99\u4E4B\u4E2D\uFF0C\u65E0\u8BBA\u662F\u65E5\u6708\u661F\u8FB0\uFF0C\u8FD8\u662F\u82B1\u9E1F\u9C7C\u866B\uFF0C\u5B83\u4EEC\u7686\u53EF\u81EA\u6210\u4E00\u754C\uFF0C\u5728\u8FD9\u4E00\u754C\u4E2D\uFF0C\u5B83\u4EEC\u90FD\u6709\u7740\u81EA\u5DF1\u7684\u5750\u6807\u7CFB\u3002</p><p>\u6BD4\u5982\uFF1A</p><p>\u5317\u4EAC\u5728\u4E1C\u7ECF 116\xB020\u2032\u3001\u5317\u7EAC 39\xB056\u2032 \u4E0A\uFF0C\u8FD9\u4E2A\u4F4D\u7F6E\u5C31\u662F\u5317\u4EAC\u5728\u5730\u7403\u7684\u672C\u5730\u5750\u6807\u7CFB\u91CC\u7684\u4F4D\u7F6E\u3002</p><p>\u90A3\u5317\u4EAC\u5728\u5B87\u5B99\u91CC\u7684\u4E16\u754C\u5750\u6807\u4F4D\u662F\u4EC0\u4E48\u5462\uFF1F\u8FD9\u9700\u8981\u77E5\u9053\u5B87\u5B99\u7684\u5750\u6807\u539F\u70B9\u5728\u54EA\u91CC\u3002</p><p>\u81F3\u4E8E\u5B87\u5B99\u7684\u5750\u6807\u539F\u70B9\u5728\u54EA\u91CC\uFF0C\u5C31\u4E0D\u518D\u505A\u6DF1\u5EA6\u63A2\u8BA8\u4E86\uFF0C\u4E0D\u7136\u80FD\u626F\u5230\u91CA\u8FE6\u6469\u5C3C\u7684\u7F18\u8D77\u6027\u7A7A\u548C\u7231\u56E0\u65AF\u5766\u7684\u76F8\u5BF9\u8BBA\u4E0A\u53BB\u3002</p><p>\u63A5\u4E0B\u6765\u62FF\u53D8\u6362\u4E3E\u4F8B\u5B50\u3002</p><h3 id="_2-\u8BA4\u8BC6\u4E16\u754C\u5750\u6807\u7CFB\u3001\u672C\u5730\u5750\u6807\u7CFB\u4E2D\u7684\u70B9\u4F4D\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_2-\u8BA4\u8BC6\u4E16\u754C\u5750\u6807\u7CFB\u3001\u672C\u5730\u5750\u6807\u7CFB\u4E2D\u7684\u70B9\u4F4D\u5173\u7CFB" aria-hidden="true">#</a> 2-\u8BA4\u8BC6\u4E16\u754C\u5750\u6807\u7CFB\u3001\u672C\u5730\u5750\u6807\u7CFB\u4E2D\u7684\u70B9\u4F4D\u5173\u7CFB</h3><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]</li><li>\u70B9 P</li><li>\u70B9 P \u6240\u5904\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O2;i2,j2,k2]</li><li>\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]\u220B \u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]</li></ul><p>\u89E3\u91CA\u4E00\u4E0B\uFF1A</p><p>[O;i,j,k]\u4E2D\uFF1A</p><ul><li>O \u662F\u5750\u6807\u539F\u70B9</li><li>i,j,k \u662F\u5750\u6807\u5411\u91CF</li></ul><p>\u8FD9\u662F\u7A7A\u95F4\u76F4\u89D2\u5750\u6807\u7CFB\u7684\u4E66\u5199\u65B9\u5F0F\uFF0C\u53EF\u5728\u9AD8\u4E2D\u6570\u5B66\u7684\u7A7A\u95F4\u51E0\u4F55\u90E8\u5206\u627E\u5230\u3002</p><p>\u521D\u5B66 three.js \uFF0C\u5F80\u5F80\u5F88\u96BE\u73A9\u8F6C\u5176\u4E2D\u77E9\u9635\u53D8\u6362\u3001\u6B27\u62C9\u3001\u56DB\u5143\u6570\u3001\u4E16\u754C\u5750\u6807\u4F4D\u3001\u672C\u5730\u5750\u6807\u4F4D\u7B49\u3002</p><p>\u63A5\u4E0B\u6211\u4EEC\u7EE7\u7EED\u56F4\u7ED5\u70B9 P \u6765\u8BF4\u4E8B\u3002</p><p>\u63D0\u95EE 1\uFF1A</p><p>\u6211\u8BF4\u70B9 P \u7684\u5750\u6807\u4F4D\u662F(x,y,z)\uFF0C\u53EF\u5426\u627E\u5230\u70B9 P\uFF1F</p><p>\u7B54\uFF1A\u4E0D\u53EF\u3002</p><p>\u56E0\u4E3A\u6CA1\u8BF4(x,y,z) \u662F\u5728\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]\u91CC\u7684\u4F4D\u7F6E\uFF0C\u8FD8\u662F\u5728\u672C\u5730\u5750\u6807\u7CFB\u662F[O2;i2,j2,k2]\u91CC\u7684\u4F4D\u7F6E\u3002</p><p>\u63D0\u95EE 2\uFF1A</p><p>\u70B9 P \u7684\u4E16\u754C\u5750\u6807\u4F4D\u662F(x,y,z)\uFF0C\u53EF\u5426\u627E\u5230\u70B9 P\uFF1F</p><p>\u7B54\uFF1A\u53EF</p><p>\u63D0\u95EE 3\uFF1A</p><p>\u70B9 P \u7684\u672C\u5730\u5750\u6807\u4F4D\u662F(x,y,z)\uFF0C\u53EF\u5426\u627E\u5230\u70B9 P\uFF1F\u82E5\u53EF\u4EE5\uFF0C\u6C42\u70B9 P \u7684\u4E16\u754C\u4F4D\u3002</p><p>\u7B54\uFF1A\u53EF</p><p>\u89E3\u70B9 P \u7684\u4E16\u754C\u4F4D\uFF1A</p><p>\u6839\u636E\u7A7A\u95F4\u5411\u91CF\u5206\u89E3\u5B9A\u7406\u3002</p><p>\u7531\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]\u53EF\u89E3\u6790\u51FA\u56DB\u7EF4\u77E9\u9635 m1\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	i1.x,j1.x,k1.x,0,
	i1.y,j1.y,k1.y,0,
	i1.z,j1.z,k1.z,0,
	O1.x,O1.y,O1.z,1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u540C\u7406\uFF0C\u7531\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u53EF\u89E3\u6790\u51FA\u56DB\u7EF4\u77E9\u9635 m2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	i2.x,j2.x,k2.x,0,
	i2.y,j2.y,k2.y,0,
	i2.z,j2.z,k2.z,0,
	O2.x,O2.y,O2.z,1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u70B9 P \u7684\u4E16\u754C\u4F4D\u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="\u4E5D\u3001\u6DF1\u5165\u8BA4\u77E5\u4E09\u7EF4\u4E16\u754C" tabindex="-1"><a class="header-anchor" href="#\u4E5D\u3001\u6DF1\u5165\u8BA4\u77E5\u4E09\u7EF4\u4E16\u754C" aria-hidden="true">#</a> \u4E5D\u3001\u6DF1\u5165\u8BA4\u77E5\u4E09\u7EF4\u4E16\u754C</h2><h3 id="_1-\u7528\u4F4D\u79FB\u77E9\u9635\u505A\u5B9E\u9A8C" tabindex="-1"><a class="header-anchor" href="#_1-\u7528\u4F4D\u79FB\u77E9\u9635\u505A\u5B9E\u9A8C" aria-hidden="true">#</a> 1-\u7528\u4F4D\u79FB\u77E9\u9635\u505A\u5B9E\u9A8C</h3><h4 id="_1-1-\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_1-1-\u793A\u4F8B" aria-hidden="true">#</a> 1-1-\u793A\u4F8B</h4><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u5B87\u5B99 universe</li><li>\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O1;i1,j1,k1] <ul><li>O1(0,0,0)</li><li>i1(1,0,0)</li><li>j1(0,1,0)</li><li>k1(0,0,1)</li></ul></li><li>\u5B87\u5B99\u5305\u542B\u4E07\u7269\uFF0C\u5176\u672C\u5730\u5750\u6807\u7CFB\u5C31\u662F\u4E07\u7269\u7684\u4E16\u754C\u5750\u6807\u7CFB</li><li>\u94F6\u6CB3\u7CFB galaxy</li><li>\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O2;i2,j2,k2] <ul><li>O2(1,2,3)</li><li>i2(1,0,0)</li><li>j2(0,1,0)</li><li>k2(0,0,1)</li></ul></li><li>\u592A\u9633 sun</li><li>\u592A\u9633\u5728\u94F6\u6CB3\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D\u662F P2(4,5,6)</li><li>\u592A\u9633 \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</li></ul><p>\u6C42\uFF1A\u592A\u9633\u7684\u4E16\u754C\u4F4D P1</p><p>\u89E3\uFF1A</p><p>\u7531\u5B87\u5B99\u5750\u6807\u7CFB[O1;i1,j1,k1]\u89E3\u77E9\u9635 m1\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1,0,0,0,
	0,1,0,0,
	0,0,1,0,
	0,0,0,1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u94F6\u6CB3\u7CFB[O2;i2,j2,k2]\u89E3\u77E9\u9635 m2:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1,0,0,0,
	0,1,0,0,
	0,0,1,0,
	1,2,3,1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u70B9 P \u7684\u4E16\u754C\u5750\u6807\u4F4D\u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u62FF three.js \u9A8C\u8BC1\u4E00\u4E0B</p><h4 id="_1-2-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_1-2-\u9A8C\u8BC1" aria-hidden="true">#</a> 1-2-\u9A8C\u8BC1</h4><p>1.\u4ECE three.js \u4E2D\u5F15\u5165\u6211\u4EEC\u8981\u7528\u5230\u7684\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Group<span class="token punctuation">,</span>
  Matrix4<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  Scene<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>2.\u57FA\u4E8E\u4E16\u754C\u5750\u6807\u7CFB\u548C\u672C\u5730\u5750\u6807\u7CFB\u6784\u5EFA\u77E9\u9635</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
const m1 = new Matrix4()
m1.elements = <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
const m2 = new Matrix4()
m2.elements = <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>3.\u58F0\u660E\u592A\u9633\u5728\u94F6\u6CB3\u7CFB\u5185\u672C\u5730\u5750\u6807 P2</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u672C\u5730\u5750\u6807\u4F4D-\u592A\u9633</span>
<span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4.\u521B\u9020\u4E00\u4E2A\u5B87\u5B99</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>applyMatrix4() \u901A\u8FC7\u56DB\u7EF4\u77E9\u9635\u8D4B\u4E88\u5BF9\u8C61\u5750\u6807\u7CFB</p><p>5.\u540C\u7406\uFF0C\u521B\u9020\u94F6\u6CB3\u7CFB</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>6.\u521B\u9020\u592A\u9633</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> sun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sun<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u592A\u9633\u7684 position \u5C5E\u6027\u4FBF\u662F\u5176\u5728\u94F6\u6CB3\u7CFB\u4E2D\u7684\u76F8\u5BF9\u4F4D</p><p>7.\u5B87\u5B99\u3001\u94F6\u6CB3\u7CFB\u548C\u592A\u9633\u7684\u5305\u542B\u5173\u7CFB\uFF1A\u592A\u9633 \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sun<span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>8.\u8BA1\u7B97\u592A\u9633\u7684\u5728\u5B87\u5B99\u4E2D\u7684\u4E16\u754C\u4F4D</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sun<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//{x:5,y:7,z:9}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-\u4F4D\u79FB\u6CD5\u5219" tabindex="-1"><a class="header-anchor" href="#_2-\u4F4D\u79FB\u6CD5\u5219" aria-hidden="true">#</a> 2-\u4F4D\u79FB\u6CD5\u5219</h3><p>\u5982\u679C\u4E0D\u60F3\u6C42\u592A\u9633\u7684\u4F4D\u7F6E\uFF0C\u800C\u662F\u60F3\u6C42\u592A\u9633\u7CFB\u5185\u7684\u5730\u7403\u7684\u4F4D\u7F6E\uFF0C\u90A3\u662F\u5426\u8FD8\u53EF\u4EE5\u6309\u7167\u4E4B\u524D\u7684\u601D\u8DEF\u6765\u6C42\u89E3\uFF1F\u7B54\u6848\u662F\u80AF\u5B9A\u7684\u3002</p><h4 id="_2-1-\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_2-1-\u793A\u4F8B" aria-hidden="true">#</a> 2-1-\u793A\u4F8B</h4><p>\u8C03\u6574\u4E00\u4E0B\u4E4B\u524D\u7684\u5DF2\u77E5\u6761\u4EF6\u3002</p><ul><li><p>\u628A\u592A\u9633\u6539\u6210\u592A\u9633\u7CFB solar</p></li><li><p>\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O3;i3,j3,k3]</p><ul><li>O3(4,5,6)</li><li>i3(1,0,0)</li><li>j3(0,1,0)</li><li>k3(0,0,1)</li></ul></li><li><p>\u5730\u7403 earth</p></li><li><p>\u5730\u7403\u5728\u592A\u9633\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D\u662F P3(7,8,9)</p></li><li><p>\u5730\u7403 \u2208 \u592A\u9633\u7CFB \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</p></li></ul><p>\u6C42\uFF1A\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1</p><p>\u89E3\uFF1A</p><p>\u7531\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, 0,
    4, 5, 6, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6C42\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-2-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_2-2-\u9A8C\u8BC1" aria-hidden="true">#</a> 2-2-\u9A8C\u8BC1</h4><p>\u6309\u7167\u4E4B\u524D\u7684\u539F\u7406\u7528 three.js \u9A8C\u8BC1\u4E00\u756A\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>import <span class="token punctuation">{</span> Group<span class="token punctuation">,</span> Matrix4<span class="token punctuation">,</span> Object3D<span class="token punctuation">,</span> Scene<span class="token punctuation">,</span> Vector3<span class="token punctuation">,</span> <span class="token punctuation">}</span> from &#39;https<span class="token operator">:</span><span class="token comment">//unpkg.com/three/build/three.module.js&#39;;</span>

<span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
const m1 = new Matrix4()
m1.elements = <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
const m2 = new Matrix4()
m2.elements = <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u592A\u9633\u7CFB</span>
const m3 = new Matrix4()
m3.elements = <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u4F4D-\u5730\u7403</span>
const P3 = new Vector3(<span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span>)


<span class="token comment">//\u5B87\u5B99(\u4E16\u754C\u5750\u6807\u7CFB\u662F\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB)</span>
const universe = new Scene()
universe.applyMatrix4(m1)
console.log(universe.position)
console.log(universe.matrix)

<span class="token comment">//\u94F6\u6CB3\u7CFB</span>
const galaxy = new Group()
galaxy.applyMatrix4(m2)

<span class="token comment">//\u592A\u9633\u7CFB</span>
const solar = new Group()
solar.applyMatrix4(m3)

<span class="token comment">//\u5730\u7403</span>
const earth = new Object3D()
earth.position.copy(P3)

<span class="token comment">//\u5305\u542B\u5173\u7CFB</span>
solar.add(earth)
galaxy.add(solar)
universe.add(galaxy)

<span class="token comment">//\u70B9P\u7684\u4E16\u754C\u4F4D</span>
const P1 = new Vector3()
earth.getWorldPosition(P1)
console.log(P1);
<span class="token comment">//{x: 12, y: 15, z: 18}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h4 id="_2-3-\u63A8\u7406" tabindex="-1"><a class="header-anchor" href="#_2-3-\u63A8\u7406" aria-hidden="true">#</a> 2-3-\u63A8\u7406</h4><p>\u53EF\u4EE5\u4ECE\u4E0A\u9762\u7684\u7ED3\u8BBA\u4E2D\u5F97\u5230\u4E00\u4E2A\u89C4\u5F8B\uFF1A</p><p>\u5F53\u4E00\u70B9 P \u548C\u5B87\u5B99\u4E4B\u95F4\u5B58\u5728 n \u5C42\u5D4C\u5957</p><p>\u70B9 P \u7684\u672C\u5730\u5750\u6807\u4F4D\u662F Pn</p><p>\u7B2C n \u5C42\u4E16\u754C\u7684\u672C\u5730\u5750\u6807\u7CFB\u6240\u5BF9\u5E94\u7684\u77E9\u9635\u662F mn</p><p>\u5219\u70B9 P \u7684\u4E16\u754C\u4F4D P1 \u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span><span class="token operator">=</span>m1<span class="token operator">*</span>m2<span class="token operator">*</span>\u2026\u2026<span class="token operator">*</span>mn<span class="token operator">*</span>pn
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0A\u9762\u7684\u516C\u5F0F\uFF0C\u5C31\u6682\u4E14\u53EB\u5B83\u201C<strong>\u672C\u5730\u5750\u6807\u8F6C\u4E16\u754C\u5750\u6807\u516C\u5F0F</strong>\u201D\u3002</p><h3 id="_3-\u7F29\u653E\u6CD5\u5219" tabindex="-1"><a class="header-anchor" href="#_3-\u7F29\u653E\u6CD5\u5219" aria-hidden="true">#</a> 3-\u7F29\u653E\u6CD5\u5219</h3><h4 id="_3-1-\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-1-\u793A\u4F8B" aria-hidden="true">#</a> 3-1-\u793A\u4F8B</h4><p>\u4FEE\u6539\u4E4B\u524D\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li><p>\u5728\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u4E2D\uFF0C\u8BA9 j2 \u662F\u5355\u4F4D\u5411\u91CF\u7684 2 \u500D\uFF1A</p><ul><li>O2(1,2,3)</li><li>i2(1,0,0)</li><li>j2(0,2,0)</li><li>k2(0,0,1)</li></ul></li><li><p>\u5728\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O3;i3,j3,k3]\uFF0C\u8BA9 k3 \u662F\u5355\u4F4D\u5411\u91CF\u7684 3 \u500D\uFF1A</p><ul><li>O3(4,5,6)</li><li>i3(1,0,0)</li><li>j3(0,1,0)</li><li>k3(0,0,3)</li></ul></li></ul><p>\u6C42\uFF1A\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1</p><p>\u89E3\uFF1A</p><p>\u7531\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, 0,
   0, 2, 0, 0,
   0, 0, 1, 0,
   1, 2, 3, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, 0,
   0, 1, 0, 0,
   0, 0, 3, 0,
   4, 5, 6, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6C42\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span><span class="token operator">=</span>m1<span class="token operator">*</span>m2<span class="token operator">*</span>m3<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span>
m1<span class="token operator">*</span>m2<span class="token operator">*</span>m3<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span>
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span>
    <span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">]</span>
m1<span class="token operator">*</span>m2<span class="token operator">*</span>m3<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">]</span>
<span class="token constant">P1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token constant">P1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-2-\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_3-2-\u6D4B\u8BD5" aria-hidden="true">#</a> 3-2-\u6D4B\u8BD5</h4><p>\u57FA\u4E8E\u201C\u4F4D\u79FB\u6CD5\u5219\u201D\u7684 three.js \u4EE3\u7801\u6539\u6539\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code> import <span class="token punctuation">{</span> Group<span class="token punctuation">,</span> Matrix4<span class="token punctuation">,</span> Object3D<span class="token punctuation">,</span> Scene<span class="token punctuation">,</span> Vector3<span class="token punctuation">,</span> <span class="token punctuation">}</span> from &#39;https<span class="token operator">:</span><span class="token comment">//unpkg.com/three/build/three.module.js&#39;;</span>

<span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
const m1 = new Matrix4()
m1.elements = <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
const m2 = new Matrix4()
m2.elements = <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u592A\u9633\u7CFB</span>
const m3 = new Matrix4()
m3.elements = <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u5730\u7403\u5728\u592A\u9633\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D</span>
const P3 = new Vector3(<span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span>)

<span class="token comment">//\u521B\u9020\u5B87\u5B99</span>
const universe = new Scene()
universe.applyMatrix4(m1)

<span class="token comment">//\u521B\u9020\u94F6\u6CB3\u7CFB</span>
const galaxy = new Group()
galaxy.applyMatrix4(m2)

<span class="token comment">//\u521B\u9020\u592A\u9633\u7CFB</span>
const solar = new Group()
solar.applyMatrix4(m3)

<span class="token comment">//\u521B\u9020\u5730\u7403</span>
const earth = new Object3D()
earth.position.copy(P3)

<span class="token comment">//\u592A\u9633\u7CFB\u5305\u542B\u5730\u7403</span>
solar.add(earth)

<span class="token comment">//\u94F6\u6CB3\u7CFB\u5305\u542B\u592A\u9633</span>
galaxy.add(solar)

<span class="token comment">//\u5B87\u5B99\u5305\u542B\u94F6\u6CB3\u7CFB</span>
universe.add(galaxy)

<span class="token comment">//\u6C42\u592A\u9633\u5728\u5B87\u5B99\u4E2D\u7684\u4E16\u754C\u4F4D</span>
const P1 = new Vector3()
earth.getWorldPosition(P1)
console.log(P1);  <span class="token comment">// {x: 12, y: 28, z: 36}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h3 id="_4-\u65CB\u8F6C\u6CD5\u5219" tabindex="-1"><a class="header-anchor" href="#_4-\u65CB\u8F6C\u6CD5\u5219" aria-hidden="true">#</a> 4-\u65CB\u8F6C\u6CD5\u5219</h3><h4 id="_4-1-\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_4-1-\u793A\u4F8B" aria-hidden="true">#</a> 4-1-\u793A\u4F8B</h4><p>\u4FEE\u6539\u4E4B\u524D\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li><p>\u8BA9\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u7ED5 j2 \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 20\xB0\u3002</p><p>\u8BBE\uFF1Ac2=cos(-20\xB0)\uFF0Cs2=sin(-20\xB0)</p><p>\u5219\uFF1A</p><ul><li>O2(1,2,3)</li><li>i2(c2,0,-s2)</li><li>j2(0,1,0)</li><li>k2(s2,0,c2)</li></ul></li><li><p>\u8BA9\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O3;i3,j3,k3]\u7ED5 k3 \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 30\xB0</p><p>\u8BBE\uFF1Ac3=cos(30\xB0)\uFF0Cs3=sin(30\xB0)</p><p>\u5219\uFF1A</p><ul><li>O3(4,5,6)</li><li>i3(c3,-s3,0)</li><li>j3(s3,c3,0)</li><li>k3(0,0,1)</li></ul></li></ul><p>\u6C42\uFF1A\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1</p><p>\u89E3\uFF1A</p><p>\u7531\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	c2, 0, s2, 0,
    0,  1, 0,  0,
    -s2,0, c2, 0,
    1,  2, 3,  1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	c3,  s3, 0, 0,
    -s3, c3, 0, 0,
    0,   0,  1, 0,
    4,   5,  6, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6C42\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>P1=m1*m2*m3*(7,8,9)
m1*m2*m3=[
    c2*c3,      s3,   s2*c3,      0,
    -c2*s3,     c3,   -s2*s3,     0,
    -s2,        0,    c2,         0,
    c2*4-s2*6+1,5+2,s2*4+c2*6+3,1
]
P1=(11.826885919330648,17.428203230275507,15.02200238270646)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u6CE8\uFF0C\u4E0A\u5F0F\u5F88\u96BE\u50CF\u4E4B\u524D\u90A3\u6837\u5FC3\u7B97\uFF0C\u53EF\u4EE5\u76F4\u63A5\u7528\u8BA1\u7B97\u673A\u7B97\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//\u8BA9\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u7ED5j2\u8F74\u9006\u65F6\u9488\u65CB\u8F6C20\xB0</span>
const ang2 = <span class="token number">-20</span> * Math.PI / <span class="token number">180</span>
const c2 = Math.cos(ang2)
const s2 = Math.sin(ang2)

<span class="token comment">//\u8BA9\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O3;i3,j3,k3]\u7ED5k3\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
const ang3 = <span class="token number">30</span> * Math.PI / <span class="token number">180</span>
const c3 = Math.cos(ang3)
const s3 = Math.sin(ang3)


const m=new Matrix4()
m.elements = <span class="token punctuation">[</span>
    c2 * c3<span class="token punctuation">,</span> s3<span class="token punctuation">,</span> s2 * c3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    -c2 * s3<span class="token punctuation">,</span> c3<span class="token punctuation">,</span> -s2 * s3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    -s2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    c2 * <span class="token number">4</span> - s2 * <span class="token number">6</span> + <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span> + <span class="token number">2</span><span class="token punctuation">,</span> s2 * <span class="token number">4</span> + c2 * <span class="token number">6</span> + <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
const P1 = P3.applyMatrix4(m)
console.log(P1);  <span class="token comment">// {x: 11.826885919330648, y: 17.428203230275507, z: 15.02200238270646}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-2-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_4-2-\u9A8C\u8BC1" aria-hidden="true">#</a> 4-2-\u9A8C\u8BC1</h4><p>\u57FA\u4E8E\u201C\u4F4D\u79FB\u6CD5\u5219\u201D\u7684 three.js \u4EE3\u7801\u6539\u6539\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Group<span class="token punctuation">,</span>
  Matrix4<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  Scene<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m1<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> ang2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m2<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>ang2<span class="token punctuation">)</span><span class="token punctuation">;</span>
m2<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m2<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> ang3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m3<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>ang3<span class="token punctuation">)</span><span class="token punctuation">;</span>
m3<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5730\u7403\u5728\u592A\u9633\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u5B87\u5B99</span>
<span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> solar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
solar<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u5730\u7403</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
earth<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u592A\u9633\u7CFB\u5305\u542B\u5730\u7403</span>
solar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u94F6\u6CB3\u7CFB\u5305\u542B\u592A\u9633</span>
galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5B87\u5B99\u5305\u542B\u94F6\u6CB3\u7CFB</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6C42\u592A\u9633\u5728\u5B87\u5B99\u4E2D\u7684\u4E16\u754C\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
earth<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {x: 11.826885919330648, y: 17.428203230275507, z: 15.02200238270646}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="\u5341\u3001\u65CB\u8F6C\u6CD5\u5219\u4E4B\u6DF1\u5EA6\u63A2\u7D22" tabindex="-1"><a class="header-anchor" href="#\u5341\u3001\u65CB\u8F6C\u6CD5\u5219\u4E4B\u6DF1\u5EA6\u63A2\u7D22" aria-hidden="true">#</a> \u5341\u3001\u65CB\u8F6C\u6CD5\u5219\u4E4B\u6DF1\u5EA6\u63A2\u7D22</h2><p>\u9996\u5148\u8981\u77E5\u9053\uFF0C\u7269\u4F53\u65CB\u8F6C\u7684\u590D\u6742\u7A0B\u5EA6\u662F\u4F4D\u79FB\u548C\u7F29\u653E\u7684 n \u591A\u500D\u3002</p><p>\u4EE5\u524D\u5728\u65CB\u8F6C\u7269\u4F53\u65F6\uFF0C\u53EA\u662F\u8BA9\u5176\u7ED5\u5750\u6807\u8F74 x|y|z \u65CB\u8F6C\u3002</p><p>\u7136\u800C\uFF0C\u5728\u5B9E\u9645\u9879\u76EE\u5F00\u53D1\u4E2D\uFF0C\u4F1A\u6709\u5176\u5B83\u7684\u65CB\u8F6C\u9700\u6C42\u3002</p><p>\u6BD4\u5982\uFF1A</p><ul><li><p>\u6B27\u62C9 Euler\uFF1A\u8BA9\u7269\u4F53\u57FA\u4E8E\u4E16\u754C\u5750\u6807\u7CFB\u7ED5 x \u8F74\u65CB\u8F6C a\xB0\uFF0C\u7136\u540E\u7ED5\u672C\u5730\u5750\u6807\u7CFB y \u8F74\u65CB\u8F6C b\xB0\uFF0C\u6700\u540E\u7ED5\u672C\u5730\u5750\u6807\u7CFB z \u8F74\u65CB\u8F6C c\xB0\u3002</p></li><li><p>\u56DB\u5143\u6570 Quaternion\uFF1A\u8BA9\u7269\u4F53\u7ED5\u4EFB\u610F\u4E00\u8F74\u65CB\u8F6C a\xB0\u3002</p></li></ul><p>\u5728\u8BF4\u590D\u6742\u65CB\u8F6C\u4E4B\u524D\uFF0C\u9700\u8981\u5BF9\u65CB\u8F6C\u7684\u65B9\u5411\u6709\u4E00\u4E2A\u900F\u5F7B\u7684\u8BA4\u77E5\uFF0C\u6240\u4EE5\u5148\u8BF4\u4E00\u4E0B\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u3002</p><h3 id="_1-\u9876\u70B9\u7ED5\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_1-\u9876\u70B9\u7ED5\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C" aria-hidden="true">#</a> 1-\u9876\u70B9\u7ED5\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C</h3><p>\u5728\u53F3\u624B\u5750\u6807\u7CFB\u7684\u9006\u65F6\u9488\u65CB\u8F6C\u91CC\uFF0C\u7ED5 y \u8F74\u7684\u9006\u65F6\u9488\u65CB\u8F6C\u6709\u70B9\u7279\u522B\u3002</p><p>\u7ED5 y \u8F74\u65CB\u8F6C\u65F6\uFF0Cx \u8F74\u6B63\u534A\u8F74\u662F\u8D77\u59CB\u8F74\uFF0C\u5373 x \u8F74\u6B63\u534A\u8F74\u7684\u5F27\u5EA6\u4E3A 0\u3002</p><p>\u4E00\u9876\u70B9\u7ED5 y \u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\uFF0C\u5F27\u5EA6\u503C\u8D8A\u5C0F\u3002</p><p>\u800C\u7ED5\u5176\u5B83\u4E24\u4E2A\u8F74\u65CB\u8F6C\u65F6\uFF0C\u5219\u4E0E\u5176\u76F8\u53CD\uFF1A</p><p>\u4E00\u9876\u70B9\u7ED5 x \u8F74\u6216 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\uFF0C\u5F27\u5EA6\u503C\u8D8A\u5927\u3002</p><p>\u8FD9\u5C31\u662F\u4E3A\u4EC0\u4E48\u6211\u8BA9\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u7ED5 j2 \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 20\xB0 \u65F6\uFF0C\u662F\u901A\u8FC7-20\xB0 \u53D6\u7684 sin \u503C\u548C cos \u503C\u3002</p><p>\u8FD9\u4E2A\u63A8\u7406\uFF0C\u53EF\u4EE5\u901A\u8FC7 three.js \u7684 Matrix4 \u5BF9\u8C61\u7684 makeRotationX()\u3001makeRotationY()\u3001makeRotationZ() \u6765\u6838\u5BF9\u4E00\u4E0B\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//30\xB0</span>
const ang = <span class="token number">30</span> * Math.PI / <span class="token number">180</span>
<span class="token comment">//three.js\u56DB\u7EF4\u77E9\u9635\u5BF9\u8C61</span>
const m = new Matrix4()

<span class="token comment">//\u7ED5x\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token punctuation">{</span>
    <span class="token comment">//three.js \u65CB\u8F6C</span>
    m.makeRotationX(ang)
    console.log(...m.elements);

    <span class="token comment">//\u624B\u52A8\u65CB\u8F6C</span>
    const c = Math.cos(ang)
    const s = Math.sin(ang)
    console.log(
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> -s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    );
<span class="token punctuation">}</span>

<span class="token comment">//\u7ED5y\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token punctuation">{</span>
    <span class="token comment">//three.js \u65CB\u8F6C</span>
    m.makeRotationY(ang)
    console.log(...m.elements);

    <span class="token comment">//\u624B\u52A8\u65CB\u8F6C</span>
    const c = Math.cos(-ang)
    const s = Math.sin(-ang)
    console.log(
        c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        -s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    );
<span class="token punctuation">}</span>

<span class="token comment">//\u7ED5z\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token punctuation">{</span>
    <span class="token comment">//three.js \u65CB\u8F6C</span>
    m.makeRotationZ(ang)
    console.log(...m.elements);

    <span class="token comment">//\u624B\u52A8\u65CB\u8F6C</span>
    const c = Math.cos(ang)
    const s = Math.sin(ang)
    console.log(
        c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        -s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    );
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="_2-\u6B27\u62C9\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-\u6B27\u62C9\u65CB\u8F6C" aria-hidden="true">#</a> 2-\u6B27\u62C9\u65CB\u8F6C</h3><p>\u6B27\u62C9\u65CB\u8F6C\u5C31\u662F\u7ED5\u5355\u8F74\u591A\u6B21\u9006\u65F6\u9488\u65CB\u8F6C\uFF0C\u7B2C\u4E00\u6B21\u662F\u7ED5\u4E16\u754C\u5750\u6807\u7CFB\u7684\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\uFF0C\u4E4B\u540E\u5219\u662F\u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u3002</p><h4 id="_2-1-\u793A\u4F8B-1" tabindex="-1"><a class="header-anchor" href="#_2-1-\u793A\u4F8B-1" aria-hidden="true">#</a> 2-1-\u793A\u4F8B</h4><p>\u5DF2\u77E5\uFF1A</p><p>\u4E16\u754C\u5750\u6807\u7CFB m1</p><p>\u70B9 P \u5728\u4E16\u754C\u5750\u6807\u7CFB\u5185</p><p>\u70B9 P \u7684\u4E16\u754C\u5750\u6807\u4F4D P1(x,y,z)</p><p>\u6C42\uFF1A</p><p>\u70B9 P \u7ED5\u4E16\u754C\u5750\u6807\u7CFB\u7684 x \u8F74\u9006\u65F6\u9488\u65CB\u8F6C angX \u5EA6\uFF0C</p><p>\u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684 y \u8F74\u9006\u65F6\u9488\u65CB\u8F6C angY \u5EA6\uFF0C</p><p>\u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C angZ \u5EA6\u540E\u7684\u4E16\u754C\u4F4D P2\u3002</p><p>\u89E3\uFF1A</p><p>\u5206\u522B\u57FA\u4E8E angX,angY,angZ \u5EFA\u7ACB\u4E09\u4E2A\u77E9\u9635 mx,my,mz</p><p>\u70B9 P \u7684\u4E16\u754C\u4F4D\u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P2</span> <span class="token operator">=</span> mx <span class="token operator">*</span> my <span class="token operator">*</span> mz <span class="token operator">*</span> <span class="token constant">P1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_2-3-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_2-3-\u9A8C\u8BC1" aria-hidden="true">#</a> 2-3-\u9A8C\u8BC1</h4><p>\u6211\u53EF\u4EE5\u5728 three.js \u91CC\u9A8C\u8BC1\u4E00\u4E0B\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Group<span class="token punctuation">,</span>
  Matrix4<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  Scene<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Euler<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>angX<span class="token punctuation">,</span> angY<span class="token punctuation">,</span> angZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7528\u77E9\u9635\u4E58\u6CD5\u5B9E\u73B0\u9876\u70B9\u7ED5\u5355\u8F74\u591A\u6B21\u9006\u65F6\u9488\u65CB\u8F6C</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span>angX<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>angY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//P2=mx*my*mz*P1</span>
  <span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u7528\u6B27\u62C9\u5B9E\u73B0\u9876\u70B9\u7ED5\u5355\u8F74\u591A\u6B21\u9006\u65F6\u9488\u65CB\u8F6C</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> euler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Euler</span><span class="token punctuation">(</span>angX<span class="token punctuation">,</span> angY<span class="token punctuation">,</span> angZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m<span class="token punctuation">.</span><span class="token function">makeRotationFromEuler</span><span class="token punctuation">(</span>euler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>\u4E0A\u9762 P2 \u7684\u4E24\u4E2A\u8F93\u51FA\u7ED3\u679C\u90FD\u662F\u4E00\u6837\u7684\u3002</p><h4 id="_2-4-\u8BB2\u4E2A\u6545\u4E8B\u7406\u89E3\u6B27\u62C9" tabindex="-1"><a class="header-anchor" href="#_2-4-\u8BB2\u4E2A\u6545\u4E8B\u7406\u89E3\u6B27\u62C9" aria-hidden="true">#</a> 2-4-\u8BB2\u4E2A\u6545\u4E8B\u7406\u89E3\u6B27\u62C9</h4><p>\u901A\u8FC7\u4E4B\u524D\u7684\u4EE3\u7801\uFF0C\u53EF\u4EE5\u53D1\u73B0\u6B27\u62C9\u65CB\u8F6C\u548C\u54B1\u4EEC\u4E4B\u524D\u8BF4\u8FC7\u7684\u4E16\u754C\u5750\u6807\u7CFB\u3001\u672C\u5730\u5750\u6807\u7CFB\u7684\u547C\u5E94\u89C4\u5F8B\u3002</p><p>\u53EF\u4EE5\u5373\u6B64\u7F16\u4E00\u4E2A\u5173\u4E8E\u738B\u8005\u8363\u8000\u6545\u4E8B\uFF1A</p><ul><li>\u5B87\u5B99\uFF0C\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F\u4E07\u7269\u7684\u4E16\u754C\u5750\u6807\u7CFB\uFF0C\u6B64\u5750\u6807\u7CFB\u4E3A\u5355\u4F4D\u77E9\u9635</li><li>mx\uFF1A\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB</li><li>my\uFF1A\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB</li><li>mz\uFF1A\u51E1\u95F4\u754C\u7684\u672C\u5730\u5750\u6807\u7CFB</li><li>P1\uFF1A\u7476\u5728\u6B27\u62C9\u65CB\u8F6C\u524D\u7684\u4E16\u754C\u4F4D \uFF08\u7476\u662F\u738B\u8005\u8363\u8000\u91CC\u7684\u89D2\u8272\uFF09</li><li>\u5B87\u5B99 \u220B \u94F6\u6CB3\u7CFB \u220B \u592A\u9633\u7CFB \u220B \u51E1\u95F4\u754C \u220B \u7476</li></ul><p>\u6C42\uFF1A\u7476\u6B27\u62C9\u65CB\u8F6C(angX,angY,angZ) \u540E\u7684\u4E16\u754C\u4F4D P2\uFF0C\u65CB\u8F6C\u987A\u5E8F\u4E3A xyz</p><p>\u89E3\uFF1A</p><ol><li><p>\u8BA9\u7476\u5760\u843D\u51E1\u95F4\u754C\u3002</p><p>\u5F53\u524D\u5B87\u5B99\u4E07\u754C\u7684\u672C\u5730\u5750\u6807\u7CFB\u90FD\u662F\u5355\u4F4D\u77E9\u9635\uFF0C\u6240\u4EE5\u7476\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF0C\u4E5F\u662F\u7476\u5728\u4E07\u754C\u4E2D\u7684\u672C\u5730\u5750\u6807\u4F4D\u3002</p><p>\u4E0B\u9762\u7684 P1 \u4E5F\u5C31\u53EF\u4EE5\u7406\u89E3\u4E3A\u7476\u5728\u51E1\u95F4\u754C\u7684\u672C\u5730\u5750\u6807\u4F4D\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const P1 = new Vector3(1, 1, 1)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>\u5C06\u94F6\u6CB3\u7CFB\u3001\u592A\u9633\u7CFB\u3001\u51E1\u95F4\u754C\u5206\u522B\u6CBF x \u8F74\u3001y \u8F74\u3001z \u8F74\u65CB\u8F6C angX\u3001angY\u3001angZ \u5EA6\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const mx = new Matrix4().makeRotationX(angX)
const my = new Matrix4().makeRotationY(angY)
const mz = new Matrix4().makeRotationZ(angZ)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>\u8BA9\u7476\u8DF3\u51FA\u4E09\u754C\u4E4B\u5916\uFF0C\u6C42\u5176\u4E16\u754C\u4F4D</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//P2=mx*my*mz*P1</span>
<span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><h3 id="_3-\u56DB\u5143\u6570" tabindex="-1"><a class="header-anchor" href="#_3-\u56DB\u5143\u6570" aria-hidden="true">#</a> 3-\u56DB\u5143\u6570</h3><p>\u56DB\u5143\u6570 Quaternion\uFF1A\u8BA9\u7269\u4F53\u7ED5\u4EFB\u610F\u8F74\u65CB\u8F6C a\xB0\u3002</p><p>\u6211\u4EEC\u5BF9\u56DB\u5143\u6570\u7684\u6DF1\u5EA6\u7406\u89E3\uFF0C\u4E5F\u53EF\u4EE5\u8BA9\u6211\u4EEC\u8111\u6D77\u4E2D\u7684\u4E09\u7EF4\u7A7A\u95F4\u610F\u8BC6\u66F4\u52A0\u7262\u56FA\u3002</p><p>\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u4F8B\u5B50\u6765\u8BF4\u660E\u56DB\u5143\u6570\u65CB\u8F6C\u7684\u5B9E\u73B0\u8FC7\u7A0B\u3002</p><p><img src="`+dn+`" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u8F74 OC2</li><li>\u5F27\u5EA6 ang</li><li>\u70B9 P1(x,y,z)</li></ul><div class="language-j ext-j line-numbers-mode"><pre class="language-j"><code>const OC2 <span class="token verb keyword">=</span> new Vector3<span class="token punctuation">(</span><span class="token number">3</span><span class="token verb keyword">,</span> <span class="token number">2</span><span class="token verb keyword">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token conjunction variable">.</span>normalize<span class="token punctuation">(</span><span class="token punctuation">)</span>
const ang <span class="token verb keyword">=</span> <span class="token number">2</span>
const P1 <span class="token verb keyword">=</span> new Vector3<span class="token punctuation">(</span><span class="token number">1</span><span class="token verb keyword">,</span> <span class="token number">2</span><span class="token verb keyword">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6C42\uFF1A\u70B9 P1 \u7ED5 OC2 \u9006\u65F6\u9488\u65CB\u8F6C ang \u5EA6\u540E\u7684\u4F4D\u7F6E P2</p><p>\u89E3\uFF1A</p><p>\u6211\u63A5\u4E0B\u6765\u8981\u628A OC2 \u8F6C\u5F97\u4E0E z \u8F74\u540C\u5411\u3002</p><ol><li>\u8BA1\u7B97\u7ED5 x \u8F74\u628A OC2 \u65CB\u8F6C\u5230\u5E73\u9762 Ozx \u4E0A\u7684\u65CB\u8F6C\u77E9\u9635 mx1\u3002</li></ol><p>\u65CB\u8F6C\u7684\u5EA6\u6570\u662F OC2 \u5728\u5E73\u9762 Oyz \u4E0A\u7684\u6B63\u5C04\u5F71 OB2 \u4E0E z \u8F74\u7684\u5939\u89D2\uFF0C\u5373 \u2220B2OB1\u3002</p><p><img src="`+gn+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">B2OB1</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token constant">OC2</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token constant">OC2</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mx1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span><span class="token constant">B2OB1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>\u987A\u4FBF\u518D\u6C42\u51FA\u7ED5 x \u8F74\u53CD\u5411\u65CB\u8F6C \u2220B2OB1 \u7684\u77E9\u9635 mx2\uFF0C\u4EE5\u5907\u540E\u7528\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mx2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token constant">B2OB1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>\u57FA\u4E8E\u77E9\u9635 mx1 \u65CB\u8F6C OC2\uFF0C\u65CB\u8F6C\u5230 OC3 \u7684\u4F4D\u7F6E\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//OC3 = m1*OC2</span>
<span class="token keyword">const</span> <span class="token constant">OC3</span> <span class="token operator">=</span> <span class="token constant">OC2</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">OC3</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>\u8BA1\u7B97\u7ED5 y \u8F74\u628A OC3 \u65CB\u8F6C\u5230 z \u8F74\u4E0A\u7684\u65CB\u8F6C\u77E9\u9635 my1\u3002</li></ol><p>\u65CB\u8F6C\u7684\u5EA6\u6570\u662F OC3 \u4E0E z \u8F74\u7684\u5939\u89D2\uFF0C\u5373 \u2220C3OB1\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const C3OB1 = Math.atan2(OC3.x, OC3.z)
const my1 = new Matrix4().makeRotationY(-C3OB1)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u200B \u81F3\u4E8E\u65CB\u8F6C\u540E OC3 \u5728\u54EA\u91CC\uFF0C\u5C31\u4E0D\u91CD\u8981\u4E86\uFF0C\u6211\u4EEC\u53EA\u8981\u77E5\u9053\u4E86\u5176\u65CB\u8F6C\u4E86\u591A\u5C11\u5EA6\uFF0C\u4EE5\u53CA\u5176\u6700\u540E\u4F1A\u548C z \u8F74\u540C\u5411\u5C31\u591F\u4E86\u3002</p><ol start="5"><li>\u987A\u4FBF\u518D\u6C42\u51FA\u7ED5 y \u8F74\u53CD\u5411\u65CB\u8F6C \u2220C3OB1 \u7684\u77E9\u9635 my2\uFF0C\u4EE5\u5907\u540E\u7528\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> my2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span><span class="token constant">C3OB1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="6"><li>\u5728 OC2 \u8F6C\u5230 z \u8F74\u4E0A\u7684\u65F6\u5019\uFF0C\u4E5F\u8BA9\u70B9 P1 \u505A\u7B49\u91CF\u7684\u65CB\u8F6C\uFF0C\u5F97 P2 \u70B9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//P2 =my1*mx1*P1</span>
<span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>my1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="7"><li>\u8BA1\u7B97\u7ED5 z \u8F74\u65CB\u8F6C ang \u5EA6\u7684\u77E9\u9635 mz</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const mz = new Matrix4().makeRotationZ(ang)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="8"><li>\u8BA9\u70B9 P2 \u7ED5 z \u8F74\u65CB\u8F6C ang \u5EA6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="9"><li>\u8BA9\u70B9 P2 \u6309\u7167\u4E4B\u524D OC2 \u7684\u65CB\u8F6C\u91CF\u518D\u9006\u5411\u8F6C\u56DE\u53BB\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>my2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E5F\u53EF\u4EE5\u628A\u6240\u6709\u7684\u77E9\u9635\u5408\u4E00\u4E0B\uFF0C\u518D\u4E58\u4EE5 P2</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> mx2
  <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mx1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="10"><li>\u9A8C\u8BC1</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> quaternion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
quaternion<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span><span class="token constant">OC2</span><span class="token punctuation">,</span> ang<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">makeRotationFromQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u603B\u7ED3\u4E00\u4E0B\u56DB\u5143\u6570\u65CB\u8F6C\u7684\u5B9E\u73B0\u539F\u7406\uFF1A</p><ol><li><p>\u5C06\u65CB\u8F6C\u8F74\u5E26\u7740\u9876\u70B9\u4E00\u8D77\u65CB\u8F6C\uFF0C\u8BA9\u65CB\u8F6C\u8F74\u4E0E xyz \u4E2D\u7684\u67D0\u4E00\u4E2A\u8F74\u540C\u5411\uFF0C\u6BD4\u5982 z \u8F74\u3002</p></li><li><p>\u8BA9\u9876\u70B9\u7ED5 z \u8F74\u65CB\u8F6C\u76F8\u5E94\u7684\u5EA6\u6570\u3002</p></li><li><p>\u8BA9\u9876\u70B9\u6309\u7167\u4E4B\u524D\u65CB\u8F6C\u8F74\u7684\u65CB\u8F6C\u91CF\u9006\u5411\u8F6C\u56DE\u53BB\u3002</p></li></ol><h2 id="\u5341\u4E00\u3001\u6B63\u4EA4\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E00\u3001\u6B63\u4EA4\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> \u5341\u4E00\u3001\u6B63\u4EA4\u6295\u5F71\u77E9\u9635</h2><p>WebGL \u662F\u4E00\u4E2A\u5149\u6805\u5F15\u64CE\uFF0C\u5176\u672C\u8EAB\u5E76\u4E0D\u4F1A\u5B9E\u73B0\u4E09\u7EF4\u6548\u679C\uFF0C\u90A3\u8981\u5728\u5176\u4E2D\u5B9E\u73B0\u4E09\u7EF4\u6548\u679C\u7684\u5173\u952E\u5C31\u5728\u4E8E\u7B97\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u9876\u70B9\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u4F4D\u7F6E <span class="token operator">=</span> \u6295\u5F71\u77E9\u9635 <span class="token operator">*</span> \u89C6\u56FE\u77E9\u9635 <span class="token operator">*</span> \u6A21\u578B\u77E9\u9635 <span class="token operator">*</span> \u9876\u70B9\u7684\u521D\u59CB\u70B9\u4F4D<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u662F\u6295\u5F71\u77E9\u9635\u7684\u4E00\u79CD\uFF0C\u5148\u4ECE\u5B83\u8BF4\u8D77\u3002</p><p>\u5728\u8BF4\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u4E4B\u524D\uFF0C\u8FD8\u9700\u8981\u5BF9\u88C1\u526A\u7A7A\u95F4\u6709\u4E00\u4E2A\u6E05\u6670\u7684\u8BA4\u77E5\u3002</p><h3 id="_1-\u88C1\u526A\u7A7A\u95F4" tabindex="-1"><a class="header-anchor" href="#_1-\u88C1\u526A\u7A7A\u95F4" aria-hidden="true">#</a> 1-\u88C1\u526A\u7A7A\u95F4</h3><p>\u88C1\u526A\u7A7A\u95F4\u662F\u7528\u4E8E\u663E\u793A webgl \u56FE\u5F62\u7684\u7A7A\u95F4\uFF0C\u6B64\u7A7A\u95F4\u662F\u4E00\u4E2A\u5BBD\u3001\u9AD8\u3001\u6DF1\u7686\u4E3A 2 \u7684\u76D2\u5B50\u3002\u5176\u5750\u6807\u7CFB\u7684\u539F\u70B9\u5728 canvas \u753B\u5E03\u7684\u4E2D\u5FC3\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><p><img src="`+vn+'" alt=""></p><p>\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF1A</p><ul><li>x \u8F74\u4E0A-1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u5DE6\u8FB9\u754C\uFF0C1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u53F3\u8FB9\u754C</li><li>y \u8F74\u4E0A-1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u4E0B\u8FB9\u754C\uFF0C1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u4E0A\u8FB9\u754C</li><li>y \u8F74\u4E0A-1 \u7684\u4F4D\u7F6E\u671D\u5411\u5C4F\u5E55\u5916\u90E8\uFF0C1 \u7684\u4F4D\u7F6E\u671D\u5411\u5C4F\u5E55\u5185\u90E8\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ul><p><img src="'+fn+'" alt=""></p><h3 id="_2-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_2-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 2-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u5B9E\u73B0\u539F\u7406</h3><p><img src="'+l+'" alt=""></p><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635 orthographic projection\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u77E9\u5F62\u533A\u57DF(\u6B63\u4EA4\u76F8\u673A\u7684\u53EF\u89C6\u533A\u57DF)\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7684\u7269\u4F53\u4E0D\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219\u3002</p><p><img src="'+yn+'" alt=""></p><p>\u8BF7\u95EE\uFF1A\u8981\u5C06\u4E00\u4E2A\u4EFB\u610F\u5C3A\u5BF8\u7684\u957F\u65B9\u4F53\u585E\u8FDB\u88C1\u526A\u7A7A\u95F4\u91CC\uFF0C\u5206\u51E0\u6B65\uFF1F</p><p>\u7B54\uFF1A\u5148\u4F4D\u79FB\uFF0C\u518D\u7F29\u653E</p><p><img src="'+xn+`" alt=""></p><p>\u8BBE\uFF1A\u6B63\u4EA4\u76F8\u673A\u53EF\u89C6\u533A\u57DF\u7684\u4E0A\u3001\u4E0B\u3001\u5DE6\u3001\u53F3\u3001\u524D\u3001\u540E\u7684\u8FB9\u754C\u5206\u522B\u662F t\u3001b\u3001l\u3001r\u3001n\u3001f</p><p>1.\u4F4D\u79FB\u77E9\u9635</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1,0,0,-(r+l)/2,
	0,1,0,-(t+b)/2,
	0,0,1,-(f+n)/2,
	0,0,0,1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2.\u7F29\u653E\u77E9\u9635</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	2/(r-l), 0,       0,        0,
	0,       2/(t-b), 0,        0,
	0,       0,       2/(f-n), 0,
	0,       0,       0,        1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635=\u7F29\u653E\u77E9\u9635*\u4F4D\u79FB\u77E9\u9635</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	2/(r-l), 0,       0,        -(r+l)/(r-l),
	0,       2/(t-b), 0,        -(t+b)/(t-b),
	0,       0,       2/(f-n),  -(f+n)/(f-n),
	0,       0,       0,        1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u82E5 n\u3001f \u662F\u4E00\u4E2A\u8DDD\u79BB\u91CF\uFF0C\u800C\u4E0D\u662F\u5728 z \u8F74\u4E0A\u7684\u523B\u5EA6\u503C\uFF0C\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u5728 z \u8F74\u4E0A\u7684\u7F29\u653E\u56E0\u5B50\u9700\u8981\u53D6\u53CD\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	2/(r-l), 0,       0,         -(r+l)/(r-l),
	0,       2/(t-b), 0,         -(t+b)/(t-b),
	0,       0,       -2/(f-n),  -(f+n)/(f-n),
	0,       0,       0,         1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 3-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0</h3><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0\u5F88\u7B80\u5355\uFF0C\u6211\u4EEC\u53EF\u4EE5\u76F4\u63A5\u4ECE three.js \u7684 Matrix4 \u5BF9\u8C61\u7684 makeOrthographic() \u65B9\u6CD5\u4E2D\u627E\u5230\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">makeOrthographic</span><span class="token punctuation">(</span> <span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> te <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">;</span>
    <span class="token keyword">const</span> w <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span> right <span class="token operator">-</span> left <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span> top <span class="token operator">-</span> bottom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span> far <span class="token operator">-</span> near <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">(</span> right <span class="token operator">+</span> left <span class="token punctuation">)</span> <span class="token operator">*</span> w<span class="token punctuation">;</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token punctuation">(</span> top <span class="token operator">+</span> bottom <span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">;</span>
    <span class="token keyword">const</span> z <span class="token operator">=</span> <span class="token punctuation">(</span> far <span class="token operator">+</span> near <span class="token punctuation">)</span> <span class="token operator">*</span> p<span class="token punctuation">;</span>

    te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> w<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> x<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> h<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> y<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> z<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u4EE5\u524D\u5728\u7ED8\u5236 webgl \u56FE\u5F62\u7684\u65F6\u5019\uFF0C\u5B83\u4EEC\u4F1A\u968F canvas \u753B\u5E03\u7684\u5927\u5C0F\u53D1\u751F\u62C9\u4F38\uFF0C\u5BF9\u4E8E\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u4FBF\u53EF\u4EE5\u7528\u6295\u5F71\u77E9\u9635\u6765\u89E3\u51B3\u3002</p><h3 id="_4-\u4F7F\u7528\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u89E3\u51B3-webgl-\u56FE\u5F62\u62C9\u4F38\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_4-\u4F7F\u7528\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u89E3\u51B3-webgl-\u56FE\u5F62\u62C9\u4F38\u95EE\u9898" aria-hidden="true">#</a> 4-\u4F7F\u7528\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u89E3\u51B3 webgl \u56FE\u5F62\u62C9\u4F38\u95EE\u9898</h3><p>\u5148\u51C6\u5907\u4E00\u4E2A\u4E09\u89D2\u5F62\u3002</p><p>1.\u9876\u70B9\u7740\u8272\u5668</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_ProjectionMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_ProjectionMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>u_ProjectionMatrix \u6B63\u4EA4\u6295\u5F71\u77E9\u9635</p><p>2.\u7247\u5143\u7740\u8272\u5668\u3002</p></li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3.\u7ED8\u5236 1 \u4E2A\u4E09\u89D2\u5F62</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    Vector3<span class="token punctuation">,</span>
    Quaternion<span class="token punctuation">,</span>
    Object3D<span class="token punctuation">,</span>
    OrthographicCamera<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Poly.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> projectionMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ProjectionMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> projectionMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    triangle<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cwebgl \u56FE\u5F62\u4F1A\u88AB canvas \u753B\u5E03\u6240\u62C9\u4F38\u3002</p><p>\u53EF\u4EE5\u901A\u8FC7\u5BF9\u76F8\u673A\u4E0A\u4E0B\u5DE6\u53F3\u8FB9\u754C\u7684\u8BBE\u7F6E\uFF0C\u4F7F\u5176\u4E0D\u88AB canvas \u753B\u5E03\u6240\u62C9\u4F38\u3002</p><p>4.\u5B9A\u4E49\u76F8\u673A\u4E16\u754C\u9AD8\u5EA6\u5C3A\u5BF8\u7684\u4E00\u534A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>5.\u8BA1\u7B97\u753B\u5E03\u7684\u5BBD\u9AD8\u6BD4</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>6.\u57FA\u4E8E halfH \u548C\u753B\u5E03\u5BBD\u9AD8\u6BD4\u8BA1\u7B97\u76F8\u673A\u4E16\u754C\u5BBD\u5EA6\u5C3A\u5BF8\u7684\u4E00\u534A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>7.\u5B9A\u4E49\u76F8\u673A\u4E16\u754C\u7684 6 \u4E2A\u8FB9\u754C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">-</span>halfW<span class="token punctuation">,</span>
  halfW<span class="token punctuation">,</span>
  halfH<span class="token punctuation">,</span>
  <span class="token operator">-</span>halfH<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>8.\u83B7\u53D6\u6B63\u4EA4\u6295\u5F71\u77E9\u9635</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>projectionMatrix<span class="token punctuation">.</span><span class="token function">makeOrthographic</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5229\u7528\u6295\u5F71\u77E9\u9635\u5C06\u73B0\u5B9E\u4E16\u754C\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u540E\uFF0C\u5F80\u5F80\u8FD8\u4F1A\u5BF9\u88C1\u526A\u7A7A\u95F4\u4E2D\u89C6\u56FE\u8FDB\u884C\u4F4D\u79FB\u6216\u65CB\u8F6C\uFF0C\u8FD9\u65F6\u5019\u5C31\u9700\u8981\u89C6\u56FE\u77E9\u9635\u4E86\u3002</p><h2 id="\u5341\u4E8C\u3001\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E8C\u3001\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> \u5341\u4E8C\u3001\u89C6\u56FE\u77E9\u9635</h2><p>\u4E4B\u524D\u5728\u8BF4\u89C6\u56FE\u53D8\u6362\u7684\u65F6\u5019\u8BF4\u8FC7\u89C6\u56FE\u77E9\u9635\uFF0C\u8FD9\u91CC\u5C31\u901A\u8FC7 three.js \u91CC\u7684\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61\uFF0C\u66F4\u52A0\u5F62\u8C61\u7684\u8BA4\u8BC6\u4E00\u4E0B\u89C6\u56FE\u77E9\u9635\u3002</p><h3 id="_1-\u89C6\u56FE\u4F4D\u79FB" tabindex="-1"><a class="header-anchor" href="#_1-\u89C6\u56FE\u4F4D\u79FB" aria-hidden="true">#</a> 1-\u89C6\u56FE\u4F4D\u79FB</h3><p>1.\u57FA\u4E8E\u4E4B\u524D\u7684\u4EE3\u7801\uFF0C\u518D\u7ED8\u5236\u4E00\u4E2A\u4E09\u89D2\u5F62</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const triangle1 = crtTriangle(
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">-0.2</span><span class="token punctuation">,</span>
        - <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">-0.3</span><span class="token punctuation">,</span> <span class="token number">-0.2</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">-0.3</span><span class="token punctuation">,</span> <span class="token number">-0.2</span>
    <span class="token punctuation">]</span>
)

const triangle2 = crtTriangle(
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
        <span class="token number">-0.3</span><span class="token punctuation">,</span> <span class="token number">-0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">-0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
)

render()

function render() <span class="token punctuation">{</span>
    gl.clear(gl.COLOR_BUFFER_BIT);

    triangle1.init()
    triangle1.draw()

    triangle2.init()
    triangle2.draw()
<span class="token punctuation">}</span>

function crtTriangle(color<span class="token punctuation">,</span> source) <span class="token punctuation">{</span>
    return new Poly(<span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        source<span class="token operator">:</span> new Float32Array(source)<span class="token punctuation">,</span>
        type<span class="token operator">:</span> &#39;TRIANGLES&#39;<span class="token punctuation">,</span>
        attributes<span class="token operator">:</span> <span class="token punctuation">{</span>
            a_Position<span class="token operator">:</span> <span class="token punctuation">{</span>
                size<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                index<span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        uniforms<span class="token operator">:</span> <span class="token punctuation">{</span>
            u_Color<span class="token operator">:</span> <span class="token punctuation">{</span>
                type<span class="token operator">:</span> &#39;uniform4fv&#39;<span class="token punctuation">,</span>
                value<span class="token operator">:</span> color
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            u_ProjectionMatrix<span class="token operator">:</span> <span class="token punctuation">{</span>
              type<span class="token operator">:</span> &#39;uniformMatrix4fv&#39;<span class="token punctuation">,</span>
              value<span class="token operator">:</span> projectionMatrix.elements
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>)
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>\u8FD9\u662F\u4E00\u524D\u4E00\u540E\u4E24\u4E2A\u4E09\u89D2\u5F62\u3002</p><p>\u524D\u9762\u7684\u662F\u9EC4\u8272\u4E09\u89D2\u5F62\uFF0C\u6DF1\u5EA6\u4E3A 0.2\uFF1B</p><p>\u540E\u9762\u7684\u662F\u7EA2\u8272\u4E09\u89D2\u5F62\uFF0C\u6DF1\u5EA6\u4E3A-0.2\uFF0C\u88AB\u524D\u9762\u7684\u4E09\u89D2\u5F62\u6321\u4F4F\u4E86\uFF0C\u6240\u4EE5\u770B\u4E0D\u89C1\u3002</p><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+hn+`" alt=""></p><p>2.\u4ECE three.js \u91CC\u5F15\u5165\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61 OrthographicCamera</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  OrthographicCamera<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>3.\u5EFA\u7ACB\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const camera = new OrthographicCamera(left, right, top, bottom, near, far)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>4.\u8BBE\u7F6E\u76F8\u673A\u4F4D\u7F6E position</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u8BBE\u7F6E\u5B8C\u76F8\u673A\u4F4D\u7F6E\u540E\uFF0C\u8981\u4F7F\u7528 updateWorldMatrix() \u65B9\u6CD5\u66F4\u65B0\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u3002</p><p>updateWorldMatrix() \u65B9\u6CD5\u4E3B\u8981\u662F\u8003\u8651\u5230\u4E86\u76F8\u673A\u5B58\u5728\u7236\u7EA7\u7684\u60C5\u51B5\u3002</p><p>updateWorldMatrix() \u65B9\u6CD5\u4F1A\u628A\u66F4\u65B0\u540E\u7684\u4E16\u754C\u5750\u6807\u7CFB\u5199\u8FDB\u5199\u8FDB\u76F8\u673A\u7684 matrixWorld \u5C5E\u6027\u91CC\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>console.log(camera.matrixWorld.elements);
<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>5.\u5C06\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635\u548C\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u7684\u9006\u77E9\u9635\u5408\u4E00\u4E0B\uFF0C\u5408\u4E00\u4E2A\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>a.multiplyMatrices(b,c) \u76F8\u5F53\u4E8E\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a <span class="token operator">=</span> b <span class="token operator">*</span> c<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><p>camera.projectionMatrix \u53EF\u4EE5\u76F4\u63A5\u83B7\u53D6\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635</p></li><li><p>matrixWorldInverse \u662F matrixWorld \u7684\u9006\u77E9\u9635\uFF0C\u8FD9\u662F\u56E0\u4E3A\u76F8\u673A\u7684\u79FB\u52A8\u65B9\u5411\u548C\u73B0\u5B9E\u4E2D\u7684\u7269\u4F53\u76F8\u53CD\u3002</p></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>console.log(camera.matrixWorldInverse);
 <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">0</span>  <span class="token number">0</span>
 <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">0</span>  <span class="token number">0</span>
 <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">1</span>  <span class="token number">0</span>
<span class="token number">-1</span>  <span class="token number">-1</span> <span class="token number">-3</span>  <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>7.\u628A\u4E4B\u524D\u7684 projectionMatrix \u6539\u6210 pvMatrix</p><ul><li>\u9876\u70B9\u7740\u8272\u5668</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>js \u4EE3\u7801</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="\u6269\u5C55-matrixworld-\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#\u6269\u5C55-matrixworld-\u8BE6\u89E3" aria-hidden="true">#</a> \u6269\u5C55-matrixWorld \u8BE6\u89E3</h3><p>\u4F8B\u5B50\u5DF2\u77E5\uFF1A</p><ul><li><p>\u5B87\u5B99 universe</p><ul><li>\u672C\u5730\u5750\u6807\u7CFB\u662F m1</li><li>m1 \u4E5F\u662F\u5B87\u5B99\u4E07\u754C\u7684\u4E16\u754C\u5750\u6807\u7CFB</li></ul></li><li><p>\u94F6\u6CB3\u7CFB galaxy</p><ul><li>\u672C\u5730\u5750\u6807\u7CFB\u662F m2</li></ul></li><li><p>\u592A\u9633\u7CFB solar</p><ul><li>\u672C\u5730\u5750\u6807\u7CFB\u662F m3</li></ul></li><li><p>\u592A\u9633\u7CFB \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</p></li></ul><p>\u6C42\uFF1A\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB matrixWorld</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>matrixWorld <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7B54\u6848\u5C31\u8FD9\u4E48\u7B80\u5355\uFF0C\u62FF\u4EE3\u7801\u6D4B\u4E00\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5B87\u5B99(\u4E16\u754C\u5750\u6807\u7CFB\u662F\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB)</span>
<span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> solar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
solar<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5730\u7403</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
earth<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5305\u542B\u5173\u7CFB</span>
solar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solar<span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u66F4\u65B0\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB</span>
solar<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>solar<span class="token punctuation">.</span>matrixWorld<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u624B\u52A8\u8BA1\u7B97\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>m1<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="\u6269\u5C55-\u9006\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u6269\u5C55-\u9006\u77E9\u9635" aria-hidden="true">#</a> \u6269\u5C55-\u9006\u77E9\u9635</h3><p>\u4E4B\u524D\u5728\u8BF4 matrixWorldInverse \u7684\u65F6\u5019\u8BF4\u8FC7\uFF0C\u5B83\u662F matrixWorld \u7684\u9006\u77E9\u9635\u3002</p><p>\u9006\u77E9\u9635\u5728\u56FE\u5F62\u9879\u76EE\u7684\u5E94\u7528\u5F88\u5E7F\uFF0C\u6240\u4EE5\u63A5\u4E0B\u6765\u5C31\u7CFB\u7EDF\u8BF4\u4E00\u4E0B\u9006\u77E9\u9635\u7684\u6982\u5FF5\u3002</p><h4 id="_1-\u9006\u77E9\u9635\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u9006\u77E9\u9635\u7684\u6982\u5FF5" aria-hidden="true">#</a> 1.\u9006\u77E9\u9635\u7684\u6982\u5FF5</h4><p>\u9006\u77E9\u9635\u5C31\u597D\u6BD4\u5B66\u4E60\u9664\u6CD5\u7684\u65F6\u5019\uFF0C\u4E00\u4E2A\u5B9E\u6570\u7684\u5012\u6570\u3002</p><p>\u5982\uFF1A</p><p>2 \u7684\u5012\u6570\u662F 1/2\u3002</p><p>\u90A3\u4E48\uFF0C\u77E9\u9635 m \u7684\u5012\u6570\u5C31\u662F 1/m\u3002</p><p>\u53EA\u4E0D\u8FC7\uFF0C1/m \u4E0D\u53EB\u505A\u77E9\u9635 m \u7684\u5012\u6570\uFF0C\u800C\u662F\u53EB\u505A\u77E9\u9635 m \u7684\u9006\u77E9\u9635\u3002</p><p>\u7531\u4E0A\uFF0C\u53EF\u4EE5\u63A8\u5BFC\u51FA\u7684\u4E00\u4E9B\u7279\u6027\u3002</p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u77E9\u9635 m</li><li>\u77E9\u9635 n</li></ul><p>\u53EF\u5F97\uFF1A</p><p>1.\u77E9\u9635\u4E0E\u5176\u9006\u77E9\u9635\u7684\u76F8\u4E58\u7ED3\u679C\u4E3A\u5355\u4F4D\u77E9\u9635</p><p>\u56E0\u4E3A\uFF1A</p><p>2*1/2=1</p><p>\u6240\u4EE5\uFF1A</p><p>m*1/m=\u5355\u4F4D\u77E9\u9635</p><p>2.\u77E9\u9635 m \u9664\u4EE5\u77E9\u9635 n \u5C31\u7B49\u4E8E\u77E9\u9635 m \u4E58\u4EE5\u77E9\u9635 n \u7684\u9006\u77E9\u9635</p><p>\u56E0\u4E3A\uFF1A</p><p>3/2=3*1/2</p><p>\u6240\u4EE5\uFF1A</p><p>m/n=m*1/n</p><h4 id="_2-\u77E9\u9635\u8F6C\u9006\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_2-\u77E9\u9635\u8F6C\u9006\u77E9\u9635" aria-hidden="true">#</a> 2.\u77E9\u9635\u8F6C\u9006\u77E9\u9635</h4><ol><li>\u4F4D\u79FB\u77E9\u9635\u7684\u9006\u77E9\u9635\u662F\u53D6\u4F4D\u79FB\u56E0\u5B50\u7684\u76F8\u53CD\u6570</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const m=new Matrix4()
m.elements=<span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
console.log(m.invert().elements);
<span class="token comment">//\u6253\u5370\u7ED3\u679C</span>
<span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">-4</span><span class="token punctuation">,</span><span class="token number">-5</span><span class="token punctuation">,</span><span class="token number">-6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="2"><li>\u7F29\u653E\u77E9\u9635\u7684\u9006\u77E9\u9635\u662F\u53D6\u7F29\u653E\u56E0\u5B50\u7684\u5012\u6570</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  const m=new Matrix4()
  m.elements=<span class="token punctuation">[</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  console.log(m.invert().elements);
<span class="token punctuation">}</span>
<span class="token comment">//\u6253\u5370\u7ED3\u679C</span>
<span class="token punctuation">[</span>
  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.125</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>3.\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u662F\u57FA\u4E8E\u65CB\u8F6C\u5F27\u5EA6\u53CD\u5411\u65CB\u8F6C</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  const ang=<span class="token number">30</span>*Math.PI/<span class="token number">180</span>
  const c=Math.cos(ang)
  const s=Math.sin(ang)
  const m=new Matrix4()
  m.elements=<span class="token punctuation">[</span>
    c<span class="token punctuation">,</span>s<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    -s<span class="token punctuation">,</span>c<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  console.log(m.invert().elements);
<span class="token punctuation">}</span>
<span class="token comment">//\u6253\u5370\u7ED3\u679C</span>
<span class="token punctuation">[</span>
  <span class="token number">0.866</span><span class="token punctuation">,</span> <span class="token number">-0.45</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0.866</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u5173\u4E8E\u5373\u65CB\u8F6C\u53C8\u7F29\u653E\u8FD8\u4F4D\u79FB\u7684\u590D\u5408\u77E9\u9635\uFF0C\u4E5F\u662F\u6309\u7167\u7C7B\u4F3C\u7684\u539F\u7406\u8F6C\u9006\u77E9\u9635\u7684\uFF0C\u53EA\u4E0D\u8FC7\u8FC7\u7A0B\u8981\u66F4\u590D\u6742\u4E00\u4E9B\u3002</p><p>three.js \u7684 Matrix4 \u5BF9\u8C61\u7684 invert() \u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm</span>
  <span class="token keyword">const</span> te <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>

        n11 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n21 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n31 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n41 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        n12 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n22 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n32 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n42 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        n13 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n23 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n33 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n43 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        n14 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n24 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n34 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n44 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>

        t11 <span class="token operator">=</span> n23 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">-</span> n24 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">+</span> n24 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token operator">-</span> n22 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">-</span> n23 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token operator">+</span> n22 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44<span class="token punctuation">,</span>
        t12 <span class="token operator">=</span> n14 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">-</span> n13 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">-</span> n14 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token operator">+</span> n12 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">+</span> n13 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token operator">-</span> n12 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44<span class="token punctuation">,</span>
        t13 <span class="token operator">=</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n42 <span class="token operator">-</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n42 <span class="token operator">+</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n43 <span class="token operator">-</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n43 <span class="token operator">-</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n44 <span class="token operator">+</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n44<span class="token punctuation">,</span>
        t14 <span class="token operator">=</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n32 <span class="token operator">-</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n32 <span class="token operator">-</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n33 <span class="token operator">+</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n33 <span class="token operator">+</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n34 <span class="token operator">-</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n34<span class="token punctuation">;</span>

  <span class="token keyword">const</span> det <span class="token operator">=</span> n11 <span class="token operator">*</span> t11 <span class="token operator">+</span> n21 <span class="token operator">*</span> t12 <span class="token operator">+</span> n31 <span class="token operator">*</span> t13 <span class="token operator">+</span> n41 <span class="token operator">*</span> t14<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> det <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> detInv <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> det<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t11 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n24 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">-</span> n23 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n24 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">+</span> n21 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">+</span> n23 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">-</span> n21 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n22 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n24 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">+</span> n24 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">-</span> n21 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">-</span> n22 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">+</span> n21 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n23 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">-</span> n22 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">-</span> n23 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">+</span> n21 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">+</span> n22 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">-</span> n21 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t12 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n13 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">+</span> n14 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">-</span> n11 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">-</span> n13 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">+</span> n11 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n14 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">-</span> n12 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">+</span> n11 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">+</span> n12 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">-</span> n11 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n12 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">-</span> n13 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">+</span> n13 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">-</span> n11 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">-</span> n12 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">+</span> n11 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t13 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n41 <span class="token operator">-</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n43 <span class="token operator">+</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n43 <span class="token operator">+</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n44 <span class="token operator">-</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n41 <span class="token operator">+</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n42 <span class="token operator">-</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n42 <span class="token operator">-</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n44 <span class="token operator">+</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n41 <span class="token operator">-</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n41 <span class="token operator">-</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n42 <span class="token operator">+</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n42 <span class="token operator">+</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n43 <span class="token operator">-</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n43 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t14 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n31 <span class="token operator">-</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n31 <span class="token operator">+</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n33 <span class="token operator">-</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n33 <span class="token operator">-</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n34 <span class="token operator">+</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n34 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n31 <span class="token operator">-</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n31 <span class="token operator">-</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n32 <span class="token operator">+</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n32 <span class="token operator">+</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n34 <span class="token operator">-</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n34 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n31 <span class="token operator">-</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n31 <span class="token operator">+</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n32 <span class="token operator">-</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n32 <span class="token operator">-</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n33 <span class="token operator">+</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n33 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="_2-\u89C6\u56FE\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-\u89C6\u56FE\u65CB\u8F6C" aria-hidden="true">#</a> 2-\u89C6\u56FE\u65CB\u8F6C</h3><p>\u4E4B\u524D\u5B9E\u73B0\u4E86\u89C6\u56FE\u7684\u79FB\u52A8\u6548\u679C\uFF0C\u7136\u800C\u6709\u65F6\u5019\u5F53\u9047\u5230\u4E00\u4E2A\u597D\u73A9\u7684\u7269\u4F53\u65F6\uFF0C\u9700\u8981\u5728\u4E0D\u79FB\u52A8\u76F8\u673A\u7684\u524D\u63D0\u4E0B\u770B\u5411\u5B83\u3002</p><p>\u8FD9\u4E2A\u65F6\u5019\uFF0C\u5C31\u9700\u8981\u65CB\u8F6C\u89C6\u56FE\u4E86\u3002</p><h4 id="_2-1-\u7528-lookat-\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-1-\u7528-lookat-\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C" aria-hidden="true">#</a> 2-1-\u7528 lookAt()\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C</h4><p>\u63A5\u4E0B\u6765\uFF0C \u7528 three.js \u7684 lookAt()\u65B9\u6CD5\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C\u3002</p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u6B63\u4EA4\u76F8\u673A\u7684\u8FB9\u754C left, right, top, bottom, near, far</li><li>\u6B63\u4EA4\u76F8\u673A\u7684\u89C6\u70B9\u4F4D\u7F6E eye</li><li>\u6B63\u4EA4\u76F8\u673A\u7684\u76EE\u6807\u70B9 target</li><li>\u6B63\u4EA4\u76F8\u673A\u4ECE eye \u770B\u5411 target \u65F6\u7684\u4E0A\u65B9\u5411 up</li></ul><p>\u6C42\uFF1A\u4ECE\u89C6\u70B9\u770B\u5411\u76EE\u6807\u70B9\u65F6\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635 pvMatrix</p><p>\u89E3\uFF1A</p><p>1.\u58F0\u660E\u5DF2\u77E5\u6761\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">-</span>halfW<span class="token punctuation">,</span>
  halfW<span class="token punctuation">,</span>
  halfH<span class="token punctuation">,</span>
  <span class="token operator">-</span>halfH<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>2.\u5EFA\u7ACB\u6B63\u4EA4\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>3.\u8BBE\u7F6E\u76F8\u673A\u7684\u4F4D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>4.\u4F7F\u7528 lookAt()\u65B9\u6CD5\uFF0C\u8BA9\u76F8\u673A\u770B\u5411\u76EE\u6807\u70B9\uFF0C\u5E76\u66F4\u65B0\u4E00\u4E0B\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E0A\u9762\u7684 lookAt() \u65B9\u6CD5\u5B9E\u9645\u4E0A\u5C31\u662F\u5728\u8BA9\u76F8\u673A\u4E16\u754C\u8FDB\u884C\u65CB\u8F6C\u3002</p><p>\u4E4B\u540E\uFF0C\u73B0\u5B9E\u4E16\u754C\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\u663E\u793A\u7684\u65F6\u5019\uFF0C\u4FBF\u4F1A\u57FA\u4E8E\u6B64\u65CB\u8F6C\u91CF\u9006\u5411\u65CB\u8F6C\u3002</p><p>5.\u901A\u8FC7\u76F8\u673A\u8BA1\u7B97\u6295\u5F71\u89C6\u56FE\u77E9\u9635 pvMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+wn+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u5BF9 lookAt \u529F\u80FD\u8FDB\u884C\u4E00\u4E0B\u6DF1\u5EA6\u5256\u6790\u3002</p><h4 id="_2-2-\u6DF1\u5EA6\u5256\u6790-lookat-\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#_2-2-\u6DF1\u5EA6\u5256\u6790-lookat-\u529F\u80FD" aria-hidden="true">#</a> 2-2-\u6DF1\u5EA6\u5256\u6790 lookAt \u529F\u80FD</h4><p>\u5148\u4E0D\u8003\u8651\u76F8\u673A\u5B58\u5728\u7236\u7EA7\u60C5\u51B5\u3002</p><p>\u53EF\u4EE5\u4ECE\u4E4B\u524D\u7684\u6B63\u4EA4\u76F8\u673A\u91CC\u5206\u89E3\u51FA\u4EE5\u4E0B\u77E9\u9635\uFF1A</p><ul><li>\u89C6\u56FE\u77E9\u9635 viewMatrix\uFF1A\u76F8\u673A\u4F4D\u79FB\u77E9\u9635\u4E58\u4EE5\u65CB\u8F6C\u77E9\u9635\u540E\u7684\u9006\u77E9\u9635\uFF0C\u5373\u76F8\u673A\u7684\u4E16\u754C\u77E9\u9635\u7684\u9006\u77E9\u9635 <ul><li>\u4F4D\u79FB\u77E9\u9635 positionMatrix\uFF1A\u7531\u89C6\u70B9\u4F4D\u7F6E\u5F97\u51FA</li><li>\u65CB\u8F6C\u77E9\u9635 rotationMatrix\uFF1A\u7531\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u5F97\u51FA</li></ul></li><li>\u6295\u5F71\u77E9\u9635 projectionMatrix\uFF1A\u7531\u6B63\u4EA4\u76F8\u673A\u7684 6 \u4E2A\u8FB9\u754C\u5F97\u51FA</li><li>\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF1A\u6295\u5F71\u77E9\u9635\u4E58\u4EE5\u89C6\u56FE\u77E9\u9635</li></ul><p>\u63A5\u4E0B\u6765\u5C31\u57FA\u4E8E\u4E4B\u524D\u7684\u4EE3\u7801\u505A\u4E00\u4E0B\u5206\u89E3\uFF1A</p><p>1.\u7531\u89C6\u70B9\u4F4D\u7F6E\u5F97\u51FA\u4F4D\u79FB\u77E9\u9635 positionMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> positionMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>2.\u7531\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u5F97\u51FA\u65CB\u8F6C\u77E9\u9635 rotationMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rotationMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>eye<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>3.\u57FA\u4E8E\u4F4D\u79FB\u77E9\u9635\u548C\u65CB\u8F6C\u77E9\u9635\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635 viewMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>positionMatrix<span class="token punctuation">,</span> rotationMatrix<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4.\u7531\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61\u63D0\u53D6\u6295\u5F71\u77E9\u9635 projectionMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> projectionMatrix <span class="token operator">=</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>5.\u7531\u6295\u5F71\u77E9\u9635\u548C\u89C6\u56FE\u77E9\u9635\u7684\u76F8\u4E58\u5F97\u5230\u6295\u5F71\u89C6\u56FE\u77E9\u9635 pvMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>6.\u6700\u540E\u5728\u9876\u70B9\u7740\u8272\u5668\u91CC\u8BA9 pvMatrix \u4E58\u4EE5\u9876\u70B9\u70B9\u4F4D\u5373\u53EF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>attribute vec4 a_Position<span class="token punctuation">;</span>
uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6CE8\uFF1A\u82E5\u76F8\u673A\u5BF9\u8C61\u5B58\u5728\u7236\u7EA7\uFF0C\u5C31\u9700\u8981\u57FA\u4E8E\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u505A\u76F8\u5E94\u8FD0\u7B97\u4E86\u3002</p><h2 id="\u5341\u4E09\u3001\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E09\u3001\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> \u5341\u4E09\u3001\u900F\u89C6\u6295\u5F71\u77E9\u9635</h2><p>\u900F\u89C6\u6295\u5F71\u77E9\u9635\u53EF\u4EE5\u5C06\u73B0\u5B9E\u4E16\u754C\u66F4\u771F\u5B9E\u7684\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u3002</p><h3 id="_1-\u57FA\u7840\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u7840\u77E5\u8BC6" aria-hidden="true">#</a> 1-\u57FA\u7840\u77E5\u8BC6</h3><p>\u5F3A\u8C03\u4E24\u4E2A\u77E5\u8BC6\u70B9\u3002</p><h4 id="_1-1-\u9F50\u6B21\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_1-1-\u9F50\u6B21\u5750\u6807\u7CFB" aria-hidden="true">#</a> 1-1-\u9F50\u6B21\u5750\u6807\u7CFB</h4><p>\u5728\u9F50\u6B21\u5750\u6807\u7CFB\u4E2D\u4EE5\u4E0B\u7B49\u5F0F\u662F\u6210\u7ACB\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>k<span class="token operator">=</span><span class="token punctuation">(</span>kx<span class="token punctuation">,</span>ky<span class="token punctuation">,</span>kz<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token function">k\u22600</span>
<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>z<span class="token operator">=</span><span class="token punctuation">(</span>zx<span class="token punctuation">,</span>zy<span class="token punctuation">,</span>z\xB2<span class="token punctuation">,</span>z<span class="token punctuation">)</span> z\u2260<span class="token number">0</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6BD4\u5982\uFF1A</p><p>(1,0,0,1)\u548C(2,0,0,2) \u90FD\u4EE3\u8868\u540C\u4E00\u4E2A\u4E09\u7EF4\u70B9\u4F4D(1,0,0)</p><h4 id="_1-2-\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97" tabindex="-1"><a class="header-anchor" href="#_1-2-\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97" aria-hidden="true">#</a> 1-2-\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97</h4><p>\u4E4B\u524D\u8BF4\u8FC7\u70B9\u659C\u5F0F y=kx+b\uFF0C\u5B83\u5C31\u662F\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97\u7684\u516C\u5F0F\u3002</p><p>\u9664\u4E86\u70B9\u659C\u5F0F\uFF0C\u4E24\u79CD\u6570\u636E\u95F4\u7684\u7EBF\u6027\u6620\u5C04\u5173\u7CFB\u8FD8\u53EF\u4EE5\u7528\u5176\u5B83\u65B9\u6CD5\u6765\u8868\u793A\u3002</p><p><img src="`+_n+`" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li><p>N \u7C7B\u578B\u7684\u6570\u636E\u6781\u503C\u662F[minN,maxN]</p></li><li><p>M \u7C7B\u578B\u7684\u6570\u636E\u6781\u503C\u662F[minM,maxM]</p></li><li><p>x \u5C5E\u4E8E N</p></li><li><p>\u5C06 x \u6620\u5C04\u5230 M \u7684\u4E2D\u7684\u503C\u4E3A y</p></li></ul><p>\u5219 x,y \u7684\u5173\u7CFB\u53EF\u4EE5\u7528\u4E24\u4E2A\u7B49\u5F0F\u8868\u793A\uFF1A</p><ol><li>\u6BD4\u4F8B\u5F0F\uFF1A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>x <span class="token operator">-</span> minN<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>maxN <span class="token operator">-</span> minN<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> minM<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>maxM <span class="token operator">-</span> minM<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>\u70B9\u659C\u5F0F</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>k <span class="token operator">=</span> <span class="token punctuation">(</span>maxM <span class="token operator">-</span> minM<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>maxN <span class="token operator">-</span> minN<span class="token punctuation">)</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> minM <span class="token operator">-</span> minN <span class="token operator">*</span> k<span class="token punctuation">;</span>
y <span class="token operator">=</span> kx <span class="token operator">+</span> b<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u901A\u8FC7\u7EBF\u6027\u63D2\u503C\u7684\u7279\u6027\uFF0C\u6211\u4EEC\u53EF\u4EE5\u77E5\u9053\uFF1A</p><p>[minN,maxN]\u4E2D\u7684\u6BCF\u4E2A\u70B9\u90FD\u4E0E[minM,maxM]\u4E2D\u7684\u552F\u4E00\u70B9\u76F8\u5BF9\u5E94\uFF0C\u7531\u4E00\u4E2A x \u4FBF\u53EF\u4EE5\u6C42\u51FA\u552F\u4E00\u4E00\u4E2A y\u3002</p><p>\u57FA\u7840\u77E5\u8BC6\u54B1\u4EEC\u5C31\u5148\u8BF4\u5230\u8FD9\uFF0C\u63A5\u4E0B\u6765\u8BA4\u8BC6\u4E00\u4E0B\u900F\u89C6\u6295\u5F71\u77E9\u9635\u3002</p><h3 id="_2-\u8BA4\u8BC6\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_2-\u8BA4\u8BC6\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> 2-\u8BA4\u8BC6\u900F\u89C6\u6295\u5F71\u77E9\u9635</h3><p>\u900F\u89C6\u6295\u5F71\u77E9\u9635 perspective projection\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u56DB\u68F1\u53F0\u5F62\u7684\u533A\u57DF\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7684\u7269\u4F53\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219\u3002</p><p><img src="`+jn+'" alt=""></p><p><img src="'+u+'" alt=""></p><p>\u900F\u89C6\u76F8\u673A\u7684\u5EFA\u7ACB\u9700\u8981\u4EE5\u4E0B\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li>fov\uFF1A\u6444\u50CF\u673A\u89C6\u9525\u4F53\u5782\u76F4\u89C6\u91CE\u89D2\u5EA6</li><li>aspect\uFF1A\u6444\u50CF\u673A\u89C6\u9525\u4F53\u5BBD\u9AD8\u6BD4(\u8FD1\u88C1\u526A\u9762)</li><li>near\uFF1A\u6444\u50CF\u673A\u8FD1\u88C1\u526A\u9762\u5230\u89C6\u70B9\u7684\u8DDD\u79BB</li><li>far\uFF1A\u6444\u50CF\u673A\u8FDC\u88C1\u526A\u9762\u5230\u89C6\u70B9\u7684\u8DDD\u79BB</li></ul><p><img src="'+r+'" alt=""></p><p>\u8BF7\u95EE\uFF1A\u8981\u5C06\u4E00\u4E2A\u4EFB\u610F\u5C3A\u5BF8\u7684\u6B63\u56DB\u68F1\u53F0\u585E\u8FDB\u88C1\u526A\u7A7A\u95F4\u91CC\uFF0C\u5206\u51E0\u6B65\uFF1F</p><p>\u7B54\uFF1A\u4ECE\u900F\u89C6\u5230\u6B63\u4EA4\u3002</p><p>1.\u6536\u7F29\u8FDC\u88C1\u526A\u9762\uFF0C\u5C06\u539F\u6765\u7684\u6B63\u56DB\u68F1\u53F0\u53D8\u6210\u957F\u65B9\u4F53\u3002</p><p>2.\u50CF\u4E4B\u524D\u7684\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u4E00\u6837\uFF0C\u5C06\u957F\u65B9\u4F53\u5148\u4F4D\u79FB\uFF0C\u518D\u7F29\u653E\u3002</p><p>\u63A5\u4E0B\u6765\u5C31\u53BB\u8BA1\u7B97\u4E00\u4E0B\u900F\u89C6\u6295\u5F71\u77E9\u9635\u3002</p><h3 id="_3-\u8BA1\u7B97\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_3-\u8BA1\u7B97\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> 3-\u8BA1\u7B97\u900F\u89C6\u6295\u5F71\u77E9\u9635</h3><p>1.\u57FA\u4E8E fov\u3001aspect\u3001n(near)\u3001f(far)\u8BA1\u7B97\u8FD1\u88C1\u526A\u9762\u8FB9\u754C\u3002</p><p><img src="'+u+`" alt=""></p><p>\u4E0A\u4E0B\u5DE6\u53F3\u56DB\u4E2A\u8FB9\u754C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>t=n*tan(fov/2)
b=-t
r=t*aspect
l=-r
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2.\u8BBE\uFF1A\u53EF\u89C6\u533A\u57DF\u4E2D\u4E00\u9876\u70B9\u4E3A P1(x1,y1,z1)</p><p>\u200B \u6C42\uFF1A\u6C42 P1 \u5728\u8FD1\u88C1\u526A\u9762\u4E0A\u7684\u6295\u5F71 P2(x2,y2,z2)</p><p><img src="`+qn+`" alt=""></p><p>\u7531\u76F8\u4F3C\u4E09\u89D2\u5F62\u6027\u8D28\u5F97\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>x1/x2=y1/y2=z1/z2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u56E0\u4E3A\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>z2=-n
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6240\u4EE5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>x2=nx1/-z1
y2=ny1/-z1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u82E5\u628A P1 \u70B9\u7684 x1,y1 \u66FF\u6362\u6210 x2,y2\uFF0C\u5C31\u53EF\u4EE5\u7406\u89E3\u4E3A\u628A\u76F8\u673A\u53EF\u89C6\u533A\u57DF\u585E\u8FDB\u4E86\u4E00\u4E2A\u957F\u65B9\u4F53\u91CC\u3002</p><p><img src="`+Pn+'" alt=""></p><p>3.\u628A\u957F\u65B9\u4F53\u91CC\u7684\u9876\u70B9\u585E\u8FDB\u88C1\u526A\u7A7A\u95F4\u4E2D\u3002</p><p><img src="'+Sn+`" alt=""></p><p>\u8BBE\uFF1AP2 \u6620\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u70B9\u4E3A P3(x3,y3,z3) \u70B9</p><p>\u5219\uFF1AP2 \u70B9\u548C P3 \u70B9\u6EE1\u8DB3\u4EE5\u4E0B\u5173\u7CFB\u5F0F\uFF1A</p><ul><li>x \u65B9\u5411</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>(x3-(-1))/(1-(-1))=(x2-l)/(r-l)
(x3+1)/2=(x2-l)/(r-l)
(x3+1)=2(x2-l)/(r-l)
x3=2(x2-l)/(r-l)-1
x3=2(x2-l)/(r-l)-(r-l)/(r-l)
x3=(2(x2-l)-(r-l))/(r-l)
x3=(2x2-(r+l))/(r-l)
x3=2x2/(r-l)-(r+l)/(r-l)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u56E0\u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x2 <span class="token operator">=</span> nx1 <span class="token operator">/</span> <span class="token operator">-</span>z1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6240\u4EE5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>x3=2(nx1/-z1)/(r-l)-(r+l)/(r-l)
x3=(2n/(r-l))x1/-z1-(r+l)/(r-l)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>y \u65B9\u5411</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>(y3-(-1))/(1-(-1))=(y2-b)/(t-b)
y3=(2n/(t-b))y1/-z1-(t+b)/(t-b)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u89C2\u5BDF\u4E00\u4E0B\u5F53\u524D\u6C42\u51FA\u7684 x3,y3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>x3=(2n/(r-l))x1/-z1-(r+l)/(r-l)
y3=(2n/(t-b))y1/-z1-(t+b)/(t-b)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u53EA\u8981\u8BA9 x3,y3 \u4E58\u4EE5-z1\uFF0C\u4FBF\u53EF\u4EE5\u5F97\u5230\u4E00\u4E2A\u9F50\u6B21\u5750\u6807 P4(x4,y4,z4,w4)\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>x4=(2n/(r-l))x1+((r+l)/(r-l))z1
y4=(2n/(t-b))y1+((t+b)/(t-b))z1
z4=?
w4=-z1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5F53\u524D\u628A\u9876\u70B9\u7684 z \u5206\u91CF\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u65B9\u6CD5\uFF0C\u8FD8\u4E0D\u77E5\u9053\uFF0C\u6240\u4EE5 z4=?</p><p>\u6211\u4EEC\u53EF\u4EE5\u5148\u4ECE\u5DF2\u77E5\u6761\u4EF6\u4E2D\u63D0\u53D6\u6295\u5F71\u77E9\u9635(\u884C\u4E3B\u5E8F)\u7684\u77E9\u9635\u56E0\u5B50\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
  2n/(r-l)       0         (r+l)/(r-l)   0,
  0              2n/(t-b)  (t+b)/(t-b)   0,
  ?              ?          ?            ?,
  0              0          -1           0
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u5C31\u5269\u4E0B z \u8F74\u76F8\u5173\u7684\u77E9\u9635\u56E0\u5B50\u4E86\u3002</p><p>\u56E0\u4E3A\u6574\u4E2A\u6295\u5F71\u77E9\u9635\u59CB\u7EC8\u662F\u5728\u505A\u7EBF\u6027\u53D8\u6362\u7684\uFF0C\u6295\u5F71\u70B9\u7684 z \u503C\u4E0E\u6295\u5F71\u77E9\u9635\u7684 z \u8F74\u5411\u7684 x,y \u5206\u91CF\u65E0\u5173\u3002</p><p>\u6240\u4EE5\u6295\u5F71\u77E9\u9635\u7684 z \u8F74\u5411\u7684 x,y \u5206\u91CF\u53EF\u4EE5\u5199\u505A 0\uFF0Cz \u548C w \u5206\u91CF\u53EF\u4EE5\u8BBE\u4E3A k,b\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
  2n/(r-l)       0         (r+l)/(r-l)   0,
  0              2n/(t-b)  (t+b)/(t-b)   0,
  0              0          k            b
  0              0          -1           0
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u4E4B\u524D\u8BF4\u4E86\uFF0C\u6574\u4E2A\u6295\u5F71\u77E9\u9635\u59CB\u7EC8\u662F\u5728\u505A\u7EBF\u6027\u53D8\u6362\uFF0C\u6240\u4EE5\u53EF\u4EE5\u7528 k,b \u7EC4\u5408\u4E00\u4E2A\u70B9\u659C\u5F0F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>z4=k*z1+b
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5F53\u7136\uFF0C\u53EF\u4EE5\u8BA4\u4E3A\u662F\u70B9\u79EF\u7684\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>z4=(0,0,k,b)\xB7(x1,y1,z1,1)
z4=k*z1+b
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u53EA\u8981\u6C42\u51FA\u4E0A\u9762\u7684 k,b,\u5C31\u53EF\u4EE5\u5F97\u5230\u900F\u89C6\u6295\u5F71\u77E9\u9635\u3002</p><p>\u53EF\u4EE5\u7528\u5F53\u524D\u7684\u5DF2\u77E5\u6761\u4EF6\uFF0C\u6784\u5EFA\u4E00\u4E2A\u4E8C\u5143\u4E00\u6B21\u65B9\u7A0B\u7EC4\uFF0C\u6C42\u51FA k,b\uFF1A</p><p><img src="`+r+`" alt=""></p><ul><li>\u5F53 z1=-n \u65F6\uFF0Cz3=-1\uFF0Cz4=-1*-z1 \uFF0C\u5373\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z4 <span class="token operator">=</span> k <span class="token operator">*</span> z1 <span class="token operator">+</span> b <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">*</span> n <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token operator">-</span>n <span class="token operator">+</span> b <span class="token operator">-</span> n <span class="token operator">=</span> <span class="token operator">-</span>kn <span class="token operator">+</span> b<span class="token punctuation">;</span>
b <span class="token operator">=</span> kn <span class="token operator">-</span> n<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>\u5F53 z1=-f \u65F6\uFF0Cz3=1\uFF0Cz4=1*-z1\uFF0C\u5373\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z4 <span class="token operator">=</span> k <span class="token operator">*</span> z1 <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token number">1</span> <span class="token operator">*</span> f <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token operator">-</span>f <span class="token operator">+</span> b<span class="token punctuation">;</span>
f <span class="token operator">=</span> <span class="token operator">-</span>kf <span class="token operator">+</span> b<span class="token punctuation">;</span>
kf <span class="token operator">=</span> b <span class="token operator">-</span> f<span class="token punctuation">;</span>
k <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> f<span class="token punctuation">)</span> <span class="token operator">/</span> f<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u7528\u6D88\u5143\u6CD5\u6C42 b\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>b<span class="token operator">=</span>kn<span class="token operator">-</span>n
b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token operator">/</span>f<span class="token punctuation">)</span>n<span class="token operator">-</span>n
b<span class="token operator">=</span><span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span>n<span class="token operator">/</span>f<span class="token operator">-</span>n
fb<span class="token operator">=</span><span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span>n<span class="token operator">-</span>fn
fb<span class="token operator">=</span>bn<span class="token operator">-</span>fn<span class="token operator">-</span>fn
fb<span class="token operator">-</span>bn<span class="token operator">=</span><span class="token operator">-</span>2fn
<span class="token function">b</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">-</span>2fn
b<span class="token operator">=</span><span class="token operator">-</span>2fn<span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u518D\u6C42 k\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>k<span class="token operator">=</span><span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token operator">/</span>f
k<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>2fn<span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token operator">/</span>f
k<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
k<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2n</span><span class="token operator">-</span>f<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
k<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
k<span class="token operator">=</span><span class="token operator">-</span><span class="token punctuation">(</span>f<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6700\u7EC8\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
  2n/(r-l)       0         (r+l)/(r-l)   0,
  0              2n/(t-b)  (t+b)/(t-b)   0,
  0              0         -(f+n)/(f-n)  -2fn/(f-n),
  0              0         -1            0
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u900F\u89C6\u6295\u5F71\u7684\u5EFA\u7ACB\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u5728 three.js \u7684\u6E90\u7801\u91CC\u627E\u5230\u3002</p><h3 id="_4-three-js-\u91CC\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-three-js-\u91CC\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> 4-three.js \u91CC\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635</h3><p>three.js \u7684 PerspectiveCamera \u5BF9\u8C61\u7684 updateProjectionMatrix() \u65B9\u6CD5\uFF0C\u4FBF\u662F\u900F\u89C6\u76F8\u673A\u5EFA\u7ACB\u900F\u89C6\u6295\u5F71\u77E9\u9635\u7684\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> near <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>near<span class="token punctuation">;</span>
	  <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u4E0A\u8FB9\u754C</span>
    <span class="token keyword">let</span> top <span class="token operator">=</span> near <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span> MathUtils<span class="token punctuation">.</span><span class="token constant">DEG2RAD</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fov <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoom<span class="token punctuation">;</span>
    <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u9AD8\u5EA6</span>
    <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> top<span class="token punctuation">;</span>
    <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u5BBD\u5EA6</span>
    <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aspect <span class="token operator">*</span> height<span class="token punctuation">;</span>
    <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u5DE6\u8FB9\u754C</span>
    <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> width<span class="token punctuation">;</span>
    <span class="token comment">//\u9ED8\u8BA4\u4E3Anull</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>

    <span class="token comment">//\u591A\u89C6\u56FE</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>enabled <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> fullWidth <span class="token operator">=</span> view<span class="token punctuation">.</span>fullWidth<span class="token punctuation">,</span>
              fullHeight <span class="token operator">=</span> view<span class="token punctuation">.</span>fullHeight<span class="token punctuation">;</span>
        left <span class="token operator">+=</span> view<span class="token punctuation">.</span>offsetX <span class="token operator">*</span> width <span class="token operator">/</span> fullWidth<span class="token punctuation">;</span>
        top <span class="token operator">-=</span> view<span class="token punctuation">.</span>offsetY <span class="token operator">*</span> height <span class="token operator">/</span> fullHeight<span class="token punctuation">;</span>
        width <span class="token operator">*=</span> view<span class="token punctuation">.</span>width <span class="token operator">/</span> fullWidth<span class="token punctuation">;</span>
        height <span class="token operator">*=</span> view<span class="token punctuation">.</span>height <span class="token operator">/</span> fullHeight<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//\u504F\u79BB\u503C\uFF0C\u9ED8\u8BA40</span>
    <span class="token keyword">const</span> skew <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filmOffset<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> skew <span class="token operator">!==</span> <span class="token number">0</span> <span class="token punctuation">)</span> left <span class="token operator">+=</span> near <span class="token operator">*</span> skew <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFilmWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u57FA\u4E8E\u8FD1\u88C1\u526A\u9762\u8FB9\u754C\u3001\u8FD1\u88C1\u526A\u9762\u548C\u8FDC\u88C1\u526A\u9762\u5230\u76F8\u673A\u89C6\u70B9\u7684\u8DDD\u79BB\u8BBE\u7F6E\u6295\u5F71\u77E9\u9635</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">makePerspective</span><span class="token punctuation">(</span> left<span class="token punctuation">,</span> left <span class="token operator">+</span> width<span class="token punctuation">,</span> top<span class="token punctuation">,</span> top <span class="token operator">-</span> height<span class="token punctuation">,</span> near<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>far <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>projectionMatrixInverse<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>projectionMatrix <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li>makePerspective() \u662F Matrix4 \u5BF9\u8C61\u91CC\u7684\u65B9\u6CD5\uFF0C\u4F1A\u57FA\u4E8E\u6295\u5F71\u7A7A\u95F4\u5EFA\u7ACB\u900F\u89C6\u6295\u5F71\u77E9\u9635</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">makePerspective</span><span class="token punctuation">(</span> <span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> te <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">;</span>

    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> near <span class="token operator">/</span> <span class="token punctuation">(</span> right <span class="token operator">-</span> left <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> near <span class="token operator">/</span> <span class="token punctuation">(</span> top <span class="token operator">-</span> bottom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">(</span> right <span class="token operator">+</span> left <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> right <span class="token operator">-</span> left <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">(</span> top <span class="token operator">+</span> bottom <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> top <span class="token operator">-</span> bottom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token operator">-</span> <span class="token punctuation">(</span> far <span class="token operator">+</span> near <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> far <span class="token operator">-</span> near <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> far <span class="token operator">*</span> near <span class="token operator">/</span> <span class="token punctuation">(</span> far <span class="token operator">-</span> near <span class="token punctuation">)</span><span class="token punctuation">;</span>

    te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_5-\u900F\u89C6\u6295\u5F71\u77E9\u9635\u725B\u5200\u5C0F\u8BD5" tabindex="-1"><a class="header-anchor" href="#_5-\u900F\u89C6\u6295\u5F71\u77E9\u9635\u725B\u5200\u5C0F\u8BD5" aria-hidden="true">#</a> 5-\u900F\u89C6\u6295\u5F71\u77E9\u9635\u725B\u5200\u5C0F\u8BD5</h3><p>\u7528\u900F\u89C6\u6295\u5F71\u77E9\u9635\u5C55\u793A\u51E0\u4E2A\u53EF\u4EE5\u8FD1\u5927\u8FDC\u5C0F\u7684\u4E09\u89D2\u5F62\u3002</p><p><img src="`+i+`" alt=""></p><p>1.\u7740\u8272\u5668</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_ProjectionMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  	gl_Position <span class="token operator">=</span> u_ProjectionMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  	gl_FragColor<span class="token operator">=</span>u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>2.\u521D\u59CB\u5316\u7740\u8272\u5668</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  PerspectiveCamera<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Quaternion<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  OrthographicCamera<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Poly.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>3.\u5EFA\u7ACB\u900F\u89C6\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4.\u57FA\u4E8E\u76F8\u673A\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635\uFF0C\u7ED8\u5236 4 \u4E2A\u4E09\u89D2\u5F62\u3002</p><p>\u524D\u9762\u662F\u4E24\u4E2A\u9EC4\u8272\u4E09\u89D2\u5F62\uFF0C\u540E\u9762\u662F\u4E24\u4E2A\u7EA2\u8272\u4E09\u89D2\u5F62\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> <span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ProjectionMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle4<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u53EA\u6709\u6295\u5F71\u77E9\u9635\u662F\u4E0D\u591F\u7684\uFF0C\u8FD8\u8981\u6709\u89C6\u56FE\u77E9\u9635\u548C\u6A21\u578B\u77E9\u9635\u3002</p><h2 id="\u5341\u56DB\u3001\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u3001\u6A21\u578B\u77E9\u9635\u5171\u51B6\u4E00\u7089" tabindex="-1"><a class="header-anchor" href="#\u5341\u56DB\u3001\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u3001\u6A21\u578B\u77E9\u9635\u5171\u51B6\u4E00\u7089" aria-hidden="true">#</a> \u5341\u56DB\u3001\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u3001\u6A21\u578B\u77E9\u9635\u5171\u51B6\u4E00\u7089</h2><p>\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u3001\u6A21\u578B\u77E9\u9635\u7684\u7ED3\u5408\u65B9\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u6700\u7EC8\u7684\u9876\u70B9\u5750\u6807 <span class="token operator">=</span> \u6295\u5F71\u77E9\u9635 <span class="token operator">*</span> \u89C6\u56FE\u77E9\u9635 <span class="token operator">*</span> \u6A21\u578B\u77E9\u9635 <span class="token operator">*</span> \u521D\u59CB\u9876\u70B9\u5750\u6807<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u6295\u5F71\u77E9\u9635\uFF1A
  <span class="token operator">-</span> <span class="token function">\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u77E9\u5F62\u533A\u57DF</span><span class="token punctuation">(</span>\u6B63\u4EA4\u76F8\u673A\u7684\u53EF\u89C6\u533A\u57DF<span class="token punctuation">)</span>\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7269\u4F53\u4E0D\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219
    \u6B63\u4EA4\u6295\u5F71\u77E9\u9635 <span class="token operator">=</span> \u7F29\u653E\u77E9\u9635<span class="token operator">*</span>\u4F4D\u79FB\u77E9\u9635
  <span class="token operator">-</span> \u900F\u89C6\u6295\u5F71\u77E9\u9635\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u56DB\u68F1\u53F0\u5F62\u7684\u533A\u57DF\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7684\u7269\u4F53\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219

\u89C6\u56FE\u77E9\u9635\uFF1A\u76F8\u673A\u4F4D\u79FB\u77E9\u9635\u4E58\u4EE5\u65CB\u8F6C\u77E9\u9635\u540E\u7684\u9006\u77E9\u9635\uFF0C\u5373\u76F8\u673A\u7684\u4E16\u754C\u77E9\u9635\u7684\u9006\u77E9\u9635
  <span class="token operator">-</span> \u4F4D\u79FB\u77E9\u9635\uFF1A\u7531\u89C6\u70B9\u4F4D\u7F6E\u5F97\u51FA
  <span class="token operator">-</span> \u65CB\u8F6C\u77E9\u9635\uFF1A\u7531\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u5F97\u51FA

\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF1A\u6295\u5F71\u77E9\u9635\u4E58\u4EE5\u89C6\u56FE\u77E9\u9635

\u6A21\u578B\u77E9\u9635\uFF1A\u6A21\u578B\u77E9\u9635\u53EF\u4EE5\u5BF9\u7269\u4F53\u8FDB\u884C\u4F4D\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u53D8\u6362\uFF0C\u6BD4\u5982\u6211\u4EEC\u60F3\u8BA9\u7269\u4F53\u6CBF z \u65CB\u8F6C
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_1-\u6295\u5F71\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_1-\u6295\u5F71\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> 1-\u6295\u5F71\u89C6\u56FE\u77E9\u9635</h3><p>1.\u5728\u9876\u70B9\u7740\u8272\u5668\u91CC\u628A\u6295\u5F71\u77E9\u9635\u53D8\u6210\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>2.\u8BBE\u7F6E\u76F8\u673A\u4F4D\u7F6E\uFF0C\u5E76\u8BA9\u5176\u770B\u5411\u4E00\u70B9</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>3.\u8BA1\u7B97\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF0C\u5373\u8BA9\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635\u4E58\u4EE5\u89C6\u56FE\u77E9\u9635</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4.\u4FEE\u6539\u4E00\u4E0B\u5EFA\u7ACB\u4E09\u89D2\u5F62\u65B9\u6CD5\u91CC\u7684 uniform \u53D8\u91CF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+Mn+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u518D\u628A\u6A21\u578B\u77E9\u9635\u52A0\u8FDB\u53BB\u3002</p><h3 id="_2-\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u4E58\u4EE5\u6A21\u578B\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_2-\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u4E58\u4EE5\u6A21\u578B\u77E9\u9635" aria-hidden="true">#</a> 2-\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u4E58\u4EE5\u6A21\u578B\u77E9\u9635</h3><p>\u4E4B\u524D\u8BBE\u7F6E\u4E09\u89D2\u5F62\u4F4D\u7F6E\u7684\u65F6\u5019\uFF0C\u662F\u76F4\u63A5\u5BF9\u9876\u70B9\u7684\u539F\u59CB\u6570\u636E\u8FDB\u884C\u7684\u4FEE\u6539\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    x<span class="token punctuation">,</span> <span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
    <span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5176\u5B9E\uFF0C\u53EF\u4EE5\u5C06\u4F4D\u79FB\u6570\u636E\u5199\u8FDB\u6A21\u578B\u77E9\u9635\u91CC\u7684\uFF0C\u5F53\u7136\u65CB\u8F6C\u548C\u7F29\u653E\u6570\u636E\u4E5F\u53EF\u4EE5\u5199\u8FDB\u53BB\uFF0C\u7136\u540E\u7528\u6A21\u578B\u77E9\u9635\u4E58\u4EE5\u539F\u59CB\u9876\u70B9\uFF0C\u4ECE\u800C\u5B9E\u73B0\u5BF9\u6A21\u578B\u7684\u53D8\u6362\u3002</p><p>1.\u9876\u70B9\u7740\u8272\u5668</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>attribute vec4 a_Position<span class="token punctuation">;</span>
uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2.\u5728 crtTriangle()\u65B9\u6CD5\u91CC\uFF0C\u628A\u4E09\u89D2\u5F62\u7684\u6570\u636E\u6E90\u5199\u6B7B\uFF0C\u5728 uniforms \u91CC\u6DFB\u52A0\u4E00\u4E2A\u6A21\u578B\u77E9\u9635\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> modelMatrix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    modelMatrix<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>2.\u5EFA\u7ACB\u56DB\u4E2A\u4E09\u89D2\u5F62</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const triangle1 = crtTriangle(
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">-0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">-3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
)

const triangle2 = crtTriangle(
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">-3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
)

const triangle3 = crtTriangle(
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">-0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">-2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
)

const triangle4 = crtTriangle(
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">-2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+i+'" alt=""></p><h2 id="\u5341\u4E94\u3001\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E94\u3001\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" aria-hidden="true">#</a> \u5341\u4E94\u3001\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668</h2><p>\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u53EF\u4EE5\u53D8\u6362\u76F8\u673A\uFF0C\u4ECE\u800C\u7075\u6D3B\u89C2\u5BDF\u7269\u4F53\u3002</p>',639),Wn=n("three.js \u4E2D\u7684\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u662F\u901A\u8FC7\u4EE5\u4E0B\u4E8B\u4EF6\u53D8\u6362\u76F8\u673A\u7684\uFF1A\uFF08"),Nn={href:"https://threejs.org/examples/?q=orbi#misc_controls_orbit",target:"_blank",rel:"noopener noreferrer"},Yn=n("orbitControls"),Xn=n("\uFF09"),Hn=p(`<ul><li><p>\u65CB\u8F6C</p><ul><li>\u9F20\u6807\u5DE6\u952E\u62D6\u62FD</li><li>\u5355\u624B\u6307\u79FB\u52A8</li></ul></li><li><p>\u7F29\u653E</p><ul><li>\u9F20\u6807\u6EDA\u8F6E\u6EDA\u52A8</li><li>\u4E24\u4E2A\u624B\u6307\u5C55\u5F00\u6216\u6324\u538B</li></ul></li><li><p>\u5E73\u79FB</p><ul><li>\u9F20\u6807\u53F3\u952E\u62D6\u62FD</li><li>\u9F20\u6807\u5DE6\u952E+ctrl/meta/shiftKey \u62D6\u62FD</li><li>\u7BAD\u5934\u952E</li><li>\u4E24\u4E2A\u624B\u6307\u79FB\u52A8</li></ul></li></ul><p>\u5728\u5B9E\u9645\u9879\u76EE\u5F00\u53D1\u4E2D\uFF0C\u4E0D\u80FD\u5BF9 three.js \u91CC\u7684\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u592A\u8FC7\u4F9D\u8D56\u3002</p><p>\u56E0\u4E3A\u5176\u4E0D\u80FD\u6EE1\u8DB3\u56FE\u5F62\u9879\u76EE\u91CC\u7684\u6240\u6709\u9700\u6C42\uFF0C\u8FD9\u662F\u7ECF\u9A8C\u4E4B\u8C08\uFF0C\u82E5\u4E0D\u80FD\u5145\u5206\u7406\u89E3\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u73B0\u539F\u7406\uFF0C\u6574\u4E2A\u9879\u76EE\u90FD\u4F1A\u88AB\u5361\u4F4F\u3002</p><p>\u6240\u4EE5\uFF0C\u63A5\u4E0B\u6765\u8981\u4ECE\u6700\u5E95\u5C42\u5B9E\u73B0\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u3002</p><p>\u6211\u4EEC\u5148\u4F7F\u7528\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u53D8\u6362\u6B63\u4EA4\u76F8\u673A\u3002</p><h3 id="_1-\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_1-\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" aria-hidden="true">#</a> 1-\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053</h3><h4 id="_1-1-\u642D\u5EFA\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_1-1-\u642D\u5EFA\u573A\u666F" aria-hidden="true">#</a> 1-1-\u642D\u5EFA\u573A\u666F</h4><p>\u51C6\u5907 4 \u4E2A\u4E09\u89D2\u5F62+1 \u4E2A\u76F8\u673A</p><ul><li>\u7740\u8272\u5668</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>\u521D\u59CB\u5316\u7740\u8272\u5668</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  PerspectiveCamera<span class="token punctuation">,</span>
  Vector2<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Quaternion<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  OrthographicCamera<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Poly.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>\u6B63\u4EA4\u76F8\u673A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">-</span>halfW<span class="token punctuation">,</span>
  halfW<span class="token punctuation">,</span>
  halfH<span class="token punctuation">,</span>
  <span class="token operator">-</span>halfH<span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>4 \u4E2A\u4E09\u89D2\u5F62</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  triangle4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  triangle4<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="_1-2-\u58F0\u660E\u57FA\u7840\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_1-2-\u58F0\u660E\u57FA\u7840\u6570\u636E" aria-hidden="true">#</a> 1-2-\u58F0\u660E\u57FA\u7840\u6570\u636E</h4><ul><li>\u9F20\u6807\u4E8B\u4EF6\u96C6\u5408</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mouseButtons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;pan&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u200B	2\uFF1A\u9F20\u6807\u53F3\u952E\u6309\u4E0B\u65F6\u7684event.button\u503C</span>
<span class="token comment">// \u200B	pan\uFF1A\u5E73\u79FB</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\uFF0C\u8868\u793A\u63A7\u5236\u5668\u6B63\u5728\u5BF9\u76F8\u673A\u8FDB\u884C\u54EA\u79CD\u53D8\u6362\u3002\u6BD4\u5982 state \u7B49\u4E8E pan \u65F6\uFF0C\u4EE3\u8868\u4F4D\u79FB</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>let state = &#39;none&#39;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>\u9F20\u6807\u5728\u5C4F\u5E55\u4E0A\u62D6\u62FD\u65F6\u7684\u8D77\u59CB\u4F4D\u548C\u7ED3\u675F\u4F4D\uFF0C\u4EE5\u50CF\u7D20\u4E3A\u5355\u4F4D</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> dragStart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dragEnd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>\u9F20\u6807\u6BCF\u6B21\u79FB\u52A8\u65F6\u7684\u4F4D\u79FB\u91CF\uFF0Cwebgl \u5750\u6807\u91CF</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> panOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>\u9F20\u6807\u5728\u5C4F\u5E55\u4E0A\u5782\u76F4\u62D6\u62FD\u65F6\uFF0C\u662F\u57FA\u4E8E\u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u7684 y \u65B9\u5411\u8FD8\u662F z \u65B9\u5411\u79FB\u52A8\u76F8\u673A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> screenSpacePanning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// true\uFF1Ay\u5411\u79FB\u52A8</span>
<span class="token comment">// false\uFF1Az\u5411\u79FB\u52A8</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-3-\u5728-canvas-\u4E0A\u7ED1\u5B9A\u9F20\u6807\u4E8B\u4EF6" tabindex="-1"><a class="header-anchor" href="#_1-3-\u5728-canvas-\u4E0A\u7ED1\u5B9A\u9F20\u6807\u4E8B\u4EF6" aria-hidden="true">#</a> 1-3-\u5728 canvas \u4E0A\u7ED1\u5B9A\u9F20\u6807\u4E8B\u4EF6</h4><ul><li>\u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;contextmenu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>\u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointerdown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6CE8\uFF1A\u6307\u9488\u4E8B\u4EF6\u652F\u6301\u591A\u79CD\u65B9\u5F0F\u7684\u6307\u9488\u9876\u70B9\u8F93\u5165\uFF0C\u5982\u9F20\u6807\u3001\u89E6\u63A7\u7B14\u3001\u89E6\u6478\u5C4F\u7B49\u3002</p><ul><li>\u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;pan&quot;</span><span class="token operator">:</span>
      <span class="token function">handleMouseMovePan</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>\u6307\u9488\u62AC\u8D77\u65F6\uFF0C\u6E05\u9664\u63A7\u5236\u5668\u72B6\u6001\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointerup&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u91CD\u70B9\u770B\u4E00\u4E0B\u76F8\u673A\u5E73\u79FB\u65B9\u6CD5 handleMouseMovePan()\u3002</p><h4 id="_1-4-\u76F8\u673A\u5E73\u79FB\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1-4-\u76F8\u673A\u5E73\u79FB\u65B9\u6CD5" aria-hidden="true">#</a> 1-4-\u76F8\u673A\u5E73\u79FB\u65B9\u6CD5</h4><p>\u76F8\u673A\u5E73\u79FB\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">handleMouseMovePan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u6307\u9488\u62D6\u62FD\u7684\u7ED3\u675F\u4F4D(\u50CF\u7D20\u5355\u4F4D)</span>
  dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u57FA\u4E8E\u62D6\u62FD\u8DDD\u79BB(\u50CF\u7D20\u5355\u4F4D)\u79FB\u52A8\u76F8\u673A</span>
  <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u91CD\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D</span>
  dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>\u57FA\u4E8E\u62D6\u62FD\u8DDD\u79BB(\u50CF\u7D20\u5355\u4F4D)\u79FB\u52A8\u76F8\u673A</li></ul><p><img src="`+En+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pan</span><span class="token punctuation">(</span><span class="token parameter">delta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u76F8\u673A\u8FD1\u88C1\u526A\u9762\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> cameraW <span class="token operator">=</span> camera<span class="token punctuation">.</span>right <span class="token operator">-</span> camera<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
  <span class="token keyword">const</span> cameraH <span class="token operator">=</span> camera<span class="token punctuation">.</span>top <span class="token operator">-</span> camera<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
  <span class="token comment">//\u6307\u9488\u62D6\u62FD\u91CF\u5728\u753B\u5E03\u4E2D\u7684\u6BD4\u503C</span>
  <span class="token keyword">const</span> ratioX <span class="token operator">=</span> delta<span class="token punctuation">.</span>x <span class="token operator">/</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ratioY <span class="token operator">=</span> delta<span class="token punctuation">.</span>y <span class="token operator">/</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u5C06\u50CF\u7D20\u5355\u4F4D\u7684\u4F4D\u79FB\u91CF\u8F6C\u6362\u4E3A\u76F8\u673A\u8FD1\u88C1\u526A\u9762\u4E0A\u7684\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>
  <span class="token comment">//\u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u91CC\u7684x\u8F74(\u7B2C\u4E00\u5217)</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u76F8\u673Ax\u8F74\u5E73\u79FB\u91CF</span>
  <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u76F8\u673Az|y\u8F74\u5E73\u79FB\u91CF</span>
  <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//y\u5411(\u7B2C\u4E8C\u5217)</span>
    vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//-z\u5411</span>
    vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//\u76F8\u673Ay\u5411\u6216-z\u5411\u7684\u5E73\u79FB\u91CF</span>
  vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u6574\u5408\u5E73\u79FB\u91CF</span>
  panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u66F4\u65B0</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li>\u57FA\u4E8E\u5E73\u79FB\u91CF\uFF0C\u4F4D\u79FB\u76F8\u673A\uFF0C\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_2-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" aria-hidden="true">#</a> 2-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053</h3><h4 id="_2-1-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_2-1-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u539F\u7406" aria-hidden="true">#</a> 2-1-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u539F\u7406</h4><p>\u76F8\u673A\u7684\u7F29\u653E\u5C31\u662F\u8BA9\u6211\u4EEC\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\u770B\u5230\u7684\u540C\u4E00\u6DF1\u5EA6\u4E0A\u7684\u4E1C\u897F\u66F4\u591A\u6216\u8005\u66F4\u5C11\u3002</p><p>\u901A\u5E38\u5927\u5BB6\u5F88\u5BB9\u6613\u7ED3\u5408\u5B9E\u9645\u751F\u6D3B\u6765\u8003\u8651\uFF0C\u6BD4\u5982\u6211\u4EEC\u6B63\u5BF9\u7740\u4E00\u9762\u5899\u58C1\uFF0C\u5899\u58C1\u4E0A\u94FA\u6EE1\u74F7\u7816\u3002</p><p>\u5F53\u6211\u4EEC\u628A\u955C\u5934\u62C9\u8FD1\u65F6\uFF0C\u770B\u5230\u7684\u74F7\u7816\u6570\u91CF\u5C31\u53D8\u5C11\u4E86\uFF0C\u6BCF\u5757\u74F7\u7816\u7684\u5C3A\u5BF8\u4E5F\u53D8\u5927\u4E86\uFF1B</p><p>\u53CD\u4E4B\uFF0C\u5F53\u6211\u4EEC\u628A\u955C\u5934\u62C9\u8FDC\u65F6\uFF0C\u770B\u5230\u7684\u74F7\u7816\u6570\u91CF\u5C31\u53D8\u591A\u4E86\uFF0C\u6BCF\u5757\u74F7\u7816\u7684\u5C3A\u5BF8\u4E5F\u53D8\u5C0F\u4E86\u3002</p><p>\u7136\u800C\u8FD9\u79CD\u65B9\u5F0F\u53EA\u9002\u7528\u4E8E\u900F\u89C6\u76F8\u673A\uFF0C\u5E76\u4E0D\u9002\u7528\u4E8E\u6B63\u4EA4\u76F8\u673A\uFF0C\u56E0\u4E3A\u6B63\u4EA4\u76F8\u673A\u4E0D\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u89C4\u5219\u3002</p><p>\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\uFF0C\u662F\u76F4\u63A5\u7F29\u653E\u7684\u6295\u5F71\u9762\uFF0C\u8FD9\u4E2A\u6295\u5F71\u9762\u5728 three.js \u91CC\u5C31\u662F\u8FD1\u88C1\u526A\u9762\u3002</p><p>\u5F53\u6295\u5F71\u9762\u53D8\u5927\u4E86\uFF0C\u90A3\u4E48\u80FD\u6295\u5F71\u7684\u9876\u70B9\u6570\u91CF\u4E5F\u5C31\u53D8\u591A\u4E86\uFF1B</p><p>\u53CD\u4E4B\uFF0C\u5F53\u6295\u5F71\u9762\u53D8\u5C0F\u4E86\uFF0C\u90A3\u4E48\u80FD\u6295\u5F71\u7684\u9876\u70B9\u6570\u91CF\u4E5F\u5C31\u53D8\u5C11\u4E86\u3002</p><p><img src="`+l+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u5206\u6790\u4E00\u4E0B\u76F8\u673A\u7684\u5177\u4F53\u7F29\u653E\u65B9\u6CD5\u3002</p><h4 id="_2-2-\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_2-2-\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u65B9\u6CD5" aria-hidden="true">#</a> 2-2-\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u65B9\u6CD5</h4><p>\u5728 three.js \u91CC\u7684\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61 OrthographicCamera \u7684 updateProjectionMatrix() \u65B9\u6CD5\u91CC\u53EF\u4EE5\u627E\u5230\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function-variable function">updateProjectionMatrix</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottom <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cx <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cy <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottom <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> left <span class="token operator">=</span> cx <span class="token operator">-</span> dx<span class="token punctuation">;</span>
    <span class="token keyword">let</span> right <span class="token operator">=</span> cx <span class="token operator">+</span> dx<span class="token punctuation">;</span>
    <span class="token keyword">let</span> top <span class="token operator">=</span> cy <span class="token operator">+</span> dy<span class="token punctuation">;</span>
    <span class="token keyword">let</span> bottom <span class="token operator">=</span> cy <span class="token operator">-</span> dy<span class="token punctuation">;</span>
    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u53EF\u4EE5\u5C06\u4E0A\u9762\u7684 dx\u3001dy \u5206\u89E3\u4E00\u4E0B\uFF1A</p><ul><li>\u8FD1\u88C1\u526A\u9762\u5BBD\u5EA6\u7684\u4E00\u534A width\uFF1A( this.right - this.left ) / 2</li><li>\u8FD1\u88C1\u526A\u9762\u9AD8\u5EA6\u7684\u4E00\u534A height\uFF1A( this.top - this.bottom ) / 2</li><li>dx=width/zoom</li><li>dy=height/zoom</li></ul><p>\u5728 three.js \u91CC\uFF0Czoom \u7684\u9ED8\u8BA4\u503C\u662F 1\uFF0C\u5373\u4E0D\u505A\u7F29\u653E\u3002</p><p>\u7531\u4E0A\u53EF\u4EE5\u5F97\u5230\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u7684\u6027\u8D28\uFF1A</p><ul><li>zoom \u503C\u548C\u8FD1\u88C1\u526A\u9762\u7684\u5C3A\u5BF8\u6210\u53CD\u6BD4</li><li>\u8FD1\u88C1\u526A\u9762\u7684\u5C3A\u5BF8\u548C\u6211\u4EEC\u5728\u540C\u4E00\u6DF1\u5EA6\u6240\u770B\u7269\u4F53\u7684\u6570\u91CF\u6210\u6B63\u6BD4</li><li>\u8FD1\u88C1\u526A\u9762\u7684\u5C3A\u5BF8\u548C\u6211\u4EEC\u6240\u770B\u7684\u540C\u4E00\u7269\u4F53\u7684\u5C3A\u5BF8\u6210\u53CD\u6BD4</li></ul><h4 id="_2-4-\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-4-\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 2-4-\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u5B9E\u73B0</h4><p>\u57FA\u4E8E\u4E4B\u524D\u7684\u76F8\u673A\u4F4D\u79FB\u8F68\u9053\u7EE7\u7EED\u5199\u4EE3\u7801\u3002</p><p>1.\u5B9A\u4E49\u6EDA\u8F6E\u5728\u6BCF\u6B21\u6EDA\u52A8\u65F6\u7684\u7F29\u653E\u7CFB\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> zoomScale <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>2.\u4E3A canvas \u6DFB\u52A0\u6EDA\u8F6E\u4E8B\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;wheel&quot;</span><span class="token punctuation">,</span> handleMouseWheel<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleMouseWheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> zoomScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dolly</span><span class="token punctuation">(</span>zoomScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5F53 deltaY&lt;0 \u65F6\uFF0C\u662F\u5411\u4E0A\u6ED1\u52A8\u6EDA\u8F6E\uFF0C\u4F1A\u7F29\u5C0F\u88C1\u526A\u9762\uFF1B</p><p>\u5F53 deltaY&gt;0 \u65F6\uFF0C\u662F\u5411\u4E0B\u6ED1\u52A8\u6EDA\u8F6E\uFF0C\u4F1A\u653E\u5927\u88C1\u526A\u9762\u3002</p><p>3.\u901A\u8FC7 dolly()\u65B9\u6CD5\u7F29\u653E\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  camera<span class="token punctuation">.</span>zoom <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_3-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" aria-hidden="true">#</a> 3-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053</h3><h4 id="_3-1-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_3-1-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u6982\u5FF5" aria-hidden="true">#</a> 3-1-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u6982\u5FF5</h4><p>\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u5B9E\u73B0\u539F\u7406\u5C31\u662F\u8BA9\u76F8\u673A\u7ED5\u7269\u4F53\u65CB\u8F6C\u3002</p><p>\u76F8\u673A\u65CB\u8F6C\u8F68\u8FF9\u7684\u96C6\u5408\u662F\u4E00\u4E2A\u7403\u4F53\u3002</p><p>\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u5B9E\u73B0\u65B9\u5F0F\u662F\u6709\u8BB8\u591A\u79CD\u7684\uFF0C\u81F3\u4E8E\u5177\u4F53\u7528\u54EA\u79CD\uFF0C\u8FD8\u8981\u770B\u6211\u4EEC\u5177\u4F53\u7684\u9879\u76EE\u9700\u6C42\u3002</p><p>\u8FD9\u91CC\u5C31\u5148\u8BF4\u4E00\u79CD\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u65CB\u8F6C\u7684\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\uFF0C\u81F3\u4E8E\u5176\u5B83\u7684\u65CB\u8F6C\u65B9\u5F0F\uFF0C\u540E\u9762\u518D\u8BF4\u3002</p><p><img src="`+a+'" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u4E09\u7EF4\u5750\u6807\u7CFB[O;x,y,z]</li><li>\u6B63\u4EA4\u76F8\u673A <ul><li>\u89C6\u70B9\u4F4D\uFF1A\u70B9 P</li><li>\u76EE\u6807\u4F4D\uFF1A\u70B9 O</li></ul></li><li>\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u7684\u65CB\u8F6C\u8F74\u662F y \u8F74</li></ul><p>\u5219\uFF1A</p><p>\u6B63\u4EA4\u76F8\u673A\u5728\u7403\u5750\u6807\u7CFB\u4E2D\u7684\u65CB\u8F6C\u8F68\u9053\u6709\u4E24\u79CD\uFF1A</p><ul><li>\u70B9 P \u7ED5\u65CB\u8F6C\u8F74 y \u8F74\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u5373\u4E0A\u56FE\u7684\u84DD\u8272\u8F68\u9053\u3002</li><li>\u70B9 P \u5728\u5E73\u9762 OPy \u4E2D\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u5373\u4E0A\u56FE\u7684\u7EFF\u8272\u8F68\u8FF9\u3002</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u7ED3\u5408\u6B63\u4EA4\u76F8\u673A\u7684\u5B9E\u9645\u60C5\u51B5\uFF0C\u8BF4\u4E00\u4E0B\u5982\u4F55\u8BA1\u7B97\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D\u3002</p><h4 id="_3-2-\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D" tabindex="-1"><a class="header-anchor" href="#_3-2-\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D" aria-hidden="true">#</a> 3-2-\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D</h4><p><img src="'+a+'" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u4E09\u7EF4\u5750\u6807\u7CFB[O;x,y,z]</li><li>\u6B63\u4EA4\u76F8\u673A <ul><li>\u89C6\u70B9\u4F4D\uFF1A\u4E09\u7EF4\u5750\u6807\u70B9 P(x,y,z)</li><li>\u76EE\u6807\u4F4D\uFF1A\u70B9 O</li></ul></li><li>\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u7684\u65CB\u8F6C\u8F74\u662F y \u8F74</li></ul><p>\u6C42\uFF1A\u76F8\u673A\u5728\u5E73\u9762 OPy \u4E2D\u65CB\u8F6C a \u5EA6\uFF0C\u7ED5 y \u8F74\u65CB\u8F6C b \u5EA6\u540E\uFF0C\u76F8\u673A\u89C6\u70B9\u7684\u4E09\u7EF4\u7A7A\u95F4\u4F4D P&#39;(x&#39;,y&#39;,z&#39;)</p><p>\u89E3\uFF1A</p><p>1.\u5C06\u70B9 P(x,y,z)\u7684\u4E09\u7EF4\u5750\u6807\u4F4D\u6362\u7B97\u4E3A\u7403\u5750\u6807\u4F4D\uFF0C\u5373 P(r,\u03C6,\u03B8)</p><p>2.\u8BA1\u7B97\u70B9 P \u5728\u5E73\u9762 OPy \u4E2D\u65CB\u8F6C a \u5EA6\uFF0C\u7ED5 y \u8F74\u65CB\u8F6C b \u5EA6\u540E\u7684\u7403\u5750\u6807\u4F4D\uFF0C\u5373 P(r,\u03C6+a,\u03B8+b)</p><p>3.\u5C06\u70B9 P \u7684\u7403\u5750\u6807\u4F4D\u8F6C\u6362\u4E3A\u4E09\u7EF4\u5750\u6807\u4F4D</p><p>\u6C42\u89E3\u7684\u601D\u8DEF\u5C31\u8FD9\u4E48\u7B80\u5355\uFF0C\u90A3\u5177\u4F53\u600E\u4E48\u5B9E\u73B0\u5462\uFF1F\u54B1\u4EEC\u5148\u628A\u4E0A\u9762\u7684\u7403\u5750\u6807\u89E3\u91CA\u4E00\u4E0B\u3002</p><h4 id="_3-3-\u7403\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_3-3-\u7403\u5750\u6807\u7CFB" aria-hidden="true">#</a> 3-3-\u7403\u5750\u6807\u7CFB</h4><p>\u2160 \u7403\u5750\u6807\u7CFB\u7684\u6982\u5FF5</p><p><img src="'+a+'" alt=""></p><p>\u7403\u5750\u6807\u7CFB\uFF08spherical coordinate system\uFF09\u662F\u7528\u7403\u5750\u6807\u8868\u793A\u7A7A\u95F4\u70B9\u4F4D\u7684\u5750\u6807\u7CFB\u3002</p><p>\u7403\u5750\u6807\u7531\u4EE5\u4E0B\u5206\u91CF\u6784\u6210\uFF1A</p><ul><li>\u534A\u5F84(radial distance) r\uFF1AOP \u957F\u5EA6( 0 \u2264 r ) \u3002</li><li>\u6781\u89D2(polar angle) \u03C6\uFF1AOP \u4E0E y \u8F74\u7684\u5939\u89D2(0 \u2264 \u03C6 \u2264 \u03C0)</li><li>\u65B9\u4F4D\u89D2(azimuth angle) \u03B8\uFF1AOP \u5728\u5E73\u9762 Oxz \u4E0A\u7684\u6295\u5F71\u4E0E\u6B63 x \u8F74\u7684\u5939\u89D2( 0 \u2264 \u03B8 &lt; 2\u03C0 )\u3002</li></ul><p>\u6CE8\uFF1A</p><ul><li>\u7403\u5750\u6807\u7CFB\u53EF\u89C6\u6781\u5750\u6807\u7CFB\u7684\u4E09\u7EF4\u63A8\u5E7F\u3002</li><li>\u5F53 r=0 \u65F6\uFF0C\u03C6 \u548C \u03B8 \u65E0\u610F\u4E49\u3002</li><li>\u5F53 \u03C6 =0 \u6216 \u03C6 =\u03C0 \u65F6\uFF0C\u03B8 \u65E0\u610F\u4E49\u3002</li></ul><p>\u63A5\u4E0B\u6765\u54B1\u4EEC\u8BF4\u4E00\u4E0B\u7403\u5750\u6807\u4E0E\u4E09\u7EF4\u5750\u6807\u7684\u8F6C\u6362\u3002</p><p>\u2161 \u4E09\u7EF4\u5750\u6807\u8F6C\u7403\u5750\u6807</p><p><img src="'+a+`" alt=""></p><p>\u5DF2\u77E5\uFF1A\u70B9 P \u7684\u4E09\u7EF4\u5750\u6807\u4F4D(x,y,z)</p><p>\u6C42\uFF1A\u70B9 P \u7684\u7403\u5750\u6807\u4F4D(r,\u03C6,\u03B8)</p><p>\u89E3\uFF1A</p><p>\u6C42\u534A\u5F84 r\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>r<span class="token operator">=</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x\xB2<span class="token operator">+</span>y\xB2<span class="token operator">+</span>z\xB2<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6C42\u6781\u89D2 \u03C6 \u7684\u65B9\u6CD5\u6709\u4E09\u79CD\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u03C6=acos(y/r)
\u03C6=asin(sqrt(x\xB2+z\xB2)/r)
\u03C6=atan(sqrt(x\xB2+z\xB2)/y)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6C42\u65B9\u4F4D\u89D2 \u03B8 \u7684\u65B9\u6CD5\u6709\u4E09\u79CD\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u03B8=acos(x/(r*sin\u03C6))
\u03B8=asin(z/(r*sin\u03C6))
\u03B8=atan(z/x)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6CE8\uFF1A</p><p>\u5728\u7528\u53CD\u6B63\u5207\u6C42\u89D2\u5EA6\u65F6\uFF0C\u9700\u8981\u6CE8\u610F\u70B9\u95EE\u9898\u3002</p><p>atan()\u8FD4\u56DE\u7684\u503C\u57DF\u662F[-PI/2,PI/2]\uFF0C\u8FD9\u662F\u4E2A\u534A\u5706\uFF0C\u8FD9\u4F1A\u5BFC\u81F4\u5176\u8FD4\u56DE\u7684\u5F27\u5EA6\u5931\u771F\u3002</p><p>\u5982\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>atan(z/x)==atan(-z/-x)
atan(-z/x)==atan(z/-x)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6240\u4EE5\uFF0C\u5728 js \u91CC\u7528\u53CD\u6B63\u5207\u8BA1\u7B97\u5F27\u5EA6\u65F6\uFF0C\u8981\u4F7F\u7528 atan2() \u65B9\u6CD5\uFF0C\u5373\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u03C6=Math.atan2(sqrt(x\xB2+z\xB2),y)
\u03B8=Math.atan2(z,x)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>atan2()\u8FD4\u56DE\u7684\u503C\u57DF\u662F[-PI,PI]\uFF0C\u8FD9\u662F\u4E00\u4E2A\u6574\u5706\u3002</p><p>atan2()\u65B9\u6CD5\u662F\u5C06 z,x \u5206\u5F00\u5199\u5165\u7684\uFF0C\u5176\u4FDD\u7559\u4E86\u5176\u6700\u539F\u59CB\u7684\u6B63\u8D1F\u7B26\u53F7\uFF0C\u6240\u4EE5\u5176\u8FD4\u56DE\u7684\u5F27\u5EA6\u4E0D\u4F1A\u5931\u771F\u3002</p><p>\u2162 \u7403\u5750\u6807\u8F6C\u4E09\u7EF4\u5750\u6807</p><p>\u5DF2\u77E5\uFF1A\u70B9 P \u7684\u7403\u5750\u6807\u4F4D(r,\u03C6,\u03B8)</p><p>\u6C42\uFF1A\u70B9 P \u7684\u4E09\u7EF4\u5750\u6807\u4F4D(x,y,z)</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x <span class="token operator">=</span> r <span class="token operator">*</span> sin\u03C6 <span class="token operator">*</span> cos\u03B8<span class="token punctuation">;</span>
y <span class="token operator">=</span> r <span class="token operator">*</span> cos\u03C6<span class="token punctuation">;</span>
z <span class="token operator">=</span> r <span class="token operator">*</span> sin\u03C6 <span class="token operator">*</span> sin\u03B8<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5173\u4E8E\u7403\u5750\u6807\u7CFB\u5C31\u8BF4\u5230\u8FD9\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u53EF\u4EE5\u8BF4\u4E00\u4E0B\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u5177\u4F53\u4EE3\u7801\u5B9E\u73B0\u5566\u3002</p><h4 id="_3-4-\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-4-\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 3-4-\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u4EE3\u7801\u5B9E\u73B0</h4><p>\u5728\u8FD9\u91CC\uFF0C\u628A\u4E4B\u524D\u7684\u4F4D\u79FB\u8F68\u9053\u548C\u7F29\u653E\u8F68\u9053\u5408\u7740\u73B0\u5728\u7684\u65CB\u8F6C\u8F68\u9053\u4E00\u8D77\u6765\u8BF4\u3002</p><p>\u573A\u666F\u8FD8\u662F\u4E4B\u524D\u7684\u573A\u666F\uFF0C\u76F4\u63A5\u8BF4\u8F68\u9053\u3002</p><p>1.\u58F0\u660E\u57FA\u7840\u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u9F20\u6807\u4E8B\u4EF6\u96C6\u5408</span>
<span class="token keyword">const</span> mouseButtons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;rotate&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;pan&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u8F68\u9053\u72B6\u6001</span>
<span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//2PI</span>
<span class="token keyword">const</span> pi2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//\u9F20\u6807\u62D6\u62FD\u7684\u8D77\u59CB\u4F4D\u548C\u7ED3\u675F\u4F4D\uFF0C\u65E0\u8BBA\u662F\u5DE6\u952E\u6309\u4E0B\u8FD8\u662F\u53F3\u952E\u6309\u4E0B</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>dragStart<span class="token punctuation">,</span> dragEnd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>2.\u58F0\u660E\u8F68\u9053\u76F8\u5173\u7684\u57FA\u7840\u6570\u636E</p><ul><li>\u5E73\u79FB\u8F68\u9053</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5E73\u79FB\u91CF</span>
<span class="token keyword">const</span> panOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u662F\u5426\u6CBF\u76F8\u673Ay\u8F74\u5E73\u79FB\u76F8\u673A</span>
<span class="token keyword">const</span> screenSpacePanning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>\u7F29\u653E\u8F68\u9053</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u7F29\u653E\u7CFB\u6570</span>
<span class="token keyword">const</span> zoomScale <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>\u65CB\u8F6C\u8F68\u9053</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u76F8\u673A\u89C6\u70B9\u76F8\u5BF9\u4E8E\u76EE\u6807\u7684\u7403\u5750\u6807</span>
<span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3.\u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;contextmenu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4.\u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointerdown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>5.\u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;pan&quot;</span><span class="token operator">:</span>
      <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;rotate&quot;</span><span class="token operator">:</span>
      <span class="token function">rotate</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>\u5E73\u79FB\u65B9\u6CD5</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cameraW <span class="token operator">=</span> camera<span class="token punctuation">.</span>right <span class="token operator">-</span> camera<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
  <span class="token keyword">const</span> cameraH <span class="token operator">=</span> camera<span class="token punctuation">.</span>top <span class="token operator">-</span> camera<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ratioY <span class="token operator">=</span> y <span class="token operator">/</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>\u65CB\u8F6C\u65B9\u6CD5</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
  spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span> <span class="token comment">// yes, height</span>
  spherical<span class="token punctuation">.</span>phi <span class="token operator">-=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>6.\u6EDA\u8F6E\u6EDA\u52A8\u65F6\uFF0C\u7F29\u653E\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;wheel&quot;</span><span class="token punctuation">,</span> handleMouseWheel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleMouseWheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> zoomScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">dolly</span><span class="token punctuation">(</span>zoomScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  camera<span class="token punctuation">.</span>zoom <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>7.\u66F4\u65B0\u76F8\u673A\uFF0C\u5E76\u6E32\u67D3</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u65CB\u8F6C\u91CF\u65CB\u8F6C\u76F8\u673A</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
  spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u57FA\u672C\u5B9E\u73B0\u539F\u7406\u5C31\u662F\u8FD9\u6837\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u518D\u5BF9\u5176\u505A\u4E00\u4E0B\u8865\u5145\u4E0E\u6269\u5C55\u3002</p><h4 id="_3-5-\u9650\u5236\u65CB\u8F6C\u8F74" tabindex="-1"><a class="header-anchor" href="#_3-5-\u9650\u5236\u65CB\u8F6C\u8F74" aria-hidden="true">#</a> 3-5-\u9650\u5236\u65CB\u8F6C\u8F74</h4><p>\u5728 three.js \u7684\u8F68\u9053\u63A7\u5236\u5668\u91CC\uFF0C\u65E0\u6CD5\u9650\u5236\u65CB\u8F6C\u8F74\uFF0C\u6BD4\u5982\u53EA\u60F3\u6A2A\u5411\u65CB\u8F6C\u76F8\u673A\uFF0C\u6216\u8005\u7AD6\u5411\u65CB\u8F6C\u76F8\u673A\u3002</p><p>\u8FD9\u6837\u7684\u9700\u6C42\uFF0C\u662F\u5728\u5B9E\u6218\u9879\u76EE\u4E2D\uFF0C\u9047\u5230\u7684\u6BD4\u8F83\u5361\u4EBA\u7684\u9700\u6C42\u4E4B\u4E00\u3002</p><p>\u4E00\u65E6\u6211\u4EEC\u4E0D\u7406\u89E3\u5176\u5E95\u5C42\u539F\u7406\uFF0C\u90A3\u5C31\u5F88\u96BE\u5B9E\u73B0\u8FD9\u4E2A\u770B\u4F3C\u7B80\u5355\u7684\u9700\u6C42\u3002</p><p>\u4E0D\u8FC7\uFF0C\u73B0\u5728\u65E2\u7136\u5DF2\u7ECF\u77E5\u9053\u4E86\u5176\u5E95\u5C42\u539F\u7406\uFF0C\u90A3\u5B9E\u73B0\u8D77\u6765\u4E5F\u5C31\u7B80\u5355\u4E86\u3002</p><p>1.\u58F0\u660E\u4E00\u4E2A\u63A7\u5236\u65CB\u8F6C\u65B9\u5411\u7684\u5C5E\u6027</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rotateDir <span class="token operator">=</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><p>x\uFF1A\u53EF\u4EE5\u5728 x \u65B9\u5411\u65CB\u8F6C\u76F8\u673A</p></li><li><p>y\uFF1A\u53EF\u4EE5\u5728 y \u65B9\u5411\u65CB\u8F6C\u76F8\u673A</p></li><li><p>xy\uFF1A\u53EF\u4EE5\u5728 x,y \u65B9\u5411\u65CB\u8F6C\u76F8\u673A</p><p>2.\u65CB\u8F6C\u65B9\u6CD5\uFF0C\u57FA\u4E8E rotateDir \u5C5E\u6027\u7EA6\u675F\u65CB\u8F6C\u65B9\u5411</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
  <span class="token keyword">const</span> deltaT <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span> <span class="token comment">// yes, height</span>
  <span class="token keyword">const</span> deltaP <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    spherical<span class="token punctuation">.</span>phi <span class="token operator">-=</span> deltaP<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-6-\u9650\u5236\u6781\u89D2" tabindex="-1"><a class="header-anchor" href="#_3-6-\u9650\u5236\u6781\u89D2" aria-hidden="true">#</a> 3-6-\u9650\u5236\u6781\u89D2</h4><p>\u4E4B\u524D\u8BF4\u7403\u5750\u6807\u7CFB\u7684\u65F6\u5019\u8BF4\u8FC7\uFF0C\u5176\u6781\u89D2\u7684\u5B9A\u4E49\u57DF\u662F[0,180\xB0]\uFF0C\u6240\u4EE5\u5728\u4EE3\u7801\u91CC\u4E5F\u8981\u5BF9\u5176\u505A\u4E00\u4E0B\u9650\u5236\u3002</p><p>\u5728 rotate() \u65B9\u6CD5\u91CC\u505A\u4E0B\u8C03\u6574\u5373\u53EF\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u65CB\u8F6C</span>
<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    \u2026\u2026
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> phi <span class="token operator">=</span> spherical<span class="token punctuation">.</span>phi <span class="token operator">-</span> deltaP
        spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
            Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span>
            Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u7136\u800C\uFF0C\u56E0\u4E3A\u5F53\u7403\u5750\u6807\u91CC\u7684\u6781\u89D2\u7B49\u4E8E 0 \u6216 180 \u5EA6\u7684\u65F6\u5019\uFF0C\u65B9\u4F4D\u89D2\u4F1A\u5931\u53BB\u610F\u4E49\uFF0C\u6240\u4EE5\u8FD8\u4E0D\u80FD\u5728\u4EE3\u7801\u771F\u7684\u7ED9\u6781\u89D2 0 \u6216 180 \u5EA6\uFF0C\u4E0D\u7136\u65B9\u4F4D\u89D2\u4F1A\u9ED8\u8BA4\u5F52\u96F6\u3002</p><p>\u6240\u4EE5\uFF0C\u9700\u8981\u5206\u522B\u7ED9\u6781\u89D2\u91CC\u7684 0 \u548C 180 \u5EA6\u4E00\u4E2A\u8FD1\u4F3C\u503C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99999999</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.00000001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u6211\u4EEC\u5C31\u8BF4\u5230\u8FD9\uFF0C\u5176\u5177\u4F53\u4EE3\u7801\u53EF\u4EE5\u53C2\u8003 three.js \u91CC\u7684 OrbitControls \u5BF9\u8C61\u7684\u6E90\u7801\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u518D\u8BF4\u4E00\u4E2A\u53E6\u4E00\u79CD\u5F62\u5F0F\u7684\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u3002</p><h3 id="_4-\u8F68\u8FF9\u7403\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_4-\u8F68\u8FF9\u7403\u65CB\u8F6C" aria-hidden="true">#</a> 4-\u8F68\u8FF9\u7403\u65CB\u8F6C</h3><p>\u8F68\u8FF9\u7403\u8FD9\u4E2A\u540D\u5B57\uFF0C\u6765\u81EA three.js \u7684 TrackballControls \u5BF9\u8C61\uFF0C\u5176\u5177\u4F53\u7684\u4EE3\u7801\u5B9E\u73B0\u4FBF\u53EF\u4EE5\u5728\u8FD9\u91CC\u627E\u5230\u3002</p><p>\u8F68\u8FF9\u7403\u4E0D\u50CF\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u65CB\u8F6C\u8F68\u9053\u90A3\u6837\u5177\u6709\u6052\u5B9A\u7684\u4E0A\u65B9\u5411\u3002</p><p>\u8F68\u8FF9\u7403\u7684\u4E0A\u65B9\u5411\u662F\u4E00\u4E2A\u5782\u76F4\u4E8E\u9F20\u6807\u62D6\u62FD\u65B9\u5411\u548C\u89C6\u7EBF\u7684\u8F74\uFF0C\u76F8\u673A\u89C6\u70B9\u4F1A\u57FA\u4E8E\u6B64\u8F74\u65CB\u8F6C\u3002</p><p>\u8F68\u8FF9\u7403\u7684\u4E0A\u65B9\u5411\u4F1A\u968F\u9F20\u6807\u62D6\u62FD\u65B9\u5411\u7684\u6539\u53D8\u800C\u6539\u53D8\u3002</p><p>\u5982\u4E0B\u56FE\uFF1A</p><p><img src="`+An+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u8BF4\u4E00\u4E0B\u5177\u4F53\u7684\u4EE3\u7801\u5B9E\u73B0\u3002</p><p>\u5728 three.js \u4E2D\uFF0CTrackballControls \u548C OrbitControls \u5BF9\u8C61\u91CC\u7684\u4EE3\u7801\uFF0C\u4E0D\u592A\u50CF\u4E00\u4E2A\u4EBA\u5199\u7684\u3002</p><p>\u56E0\u4E3A\u5B8C\u5168\u53EF\u4EE5\u6CBF\u7528 OrbitControls \u91CC\u7684\u4E00\u90E8\u5206\u4EE3\u7801\u53BB\u5199 TrackballControls\uFF0C\u6BD4\u5982\u9F20\u6807\u5728\u76F8\u673A\u4E16\u754C\u91CC\u7684\u504F\u79FB\u91CF\uFF0C\u800C TrackballControls \u5B8C\u5168\u7528\u4E00\u5957\u98CE\u683C\u8FE5\u5F02\u7684\u4EE3\u7801\u4ECE\u5934\u5199\u4E86\u4E00\u904D\u3002</p><p>\u5F53\u7136\uFF0C\u8FD9\u91CC\u5E76\u4E0D\u662F\u8BF4 TrackballControls \u4E0D\u597D\uFF0C\u5176\u539F\u7406\u548C\u529F\u80FD\u7684\u5B9E\u73B0\u65B9\u6CD5\u4F9D\u65E7\u662F\u5F88\u503C\u5F97\u5B66\u4E60\u3002</p><p>\u53EA\u662F\u5728\u5199\u8F68\u8FF9\u7403\u7684\u65F6\u5019\uFF0C\u5B8C\u5168\u53EF\u4EE5\u57FA\u4E8E TrackballControls \u7684\u5B9E\u73B0\u539F\u7406\uFF0C\u628A OrbitControls \u7ED9\u6539\u4E00\u4E0B\uFF0C\u8FD9\u6837\u53EF\u4EE5\u5C11\u5199\u8BB8\u591A\u4EE3\u7801\u3002</p><p>1.\u5B9A\u4E49\u7528\u4E8E\u6CBF\u67D0\u4E2A\u8F74\u65CB\u8F6C\u76F8\u673A\u89C6\u70B9\u7684\u56DB\u5143\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> quaternion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>2.\u628A\u4E4B\u524D\u7684 rotate()\u65CB\u8F6C\u65B9\u6CD5\u6539\u4E00\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> position <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>

  <span class="token comment">// \u76F8\u673A\u5BBD\u9AD8</span>
  <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
  <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom<span class="token punctuation">;</span>

  <span class="token comment">// \u9F20\u6807\u4F4D\u79FB\u8DDD\u79BB\u5728\u753B\u5E03\u4E2D\u7684\u5360\u6BD4</span>
  <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ratioY <span class="token operator">=</span> <span class="token operator">-</span>y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u9AD8\u5EA6\u7684x\u4F4D\u7F6E\u6BD4-\u7528\u4E8E\u65CB\u8F6C\u91CF\u7684\u8BA1\u7B97</span>
  <span class="token keyword">const</span> ratioXBaseHeight <span class="token operator">=</span> x <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> ratioLen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>ratioXBaseHeight<span class="token punctuation">,</span> ratioY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u65CB\u8F6C\u91CF</span>
  <span class="token keyword">const</span> angle <span class="token operator">=</span> ratioLen <span class="token operator">*</span> pi2<span class="token punctuation">;</span>

  <span class="token comment">// \u5728\u76F8\u673A\u4E16\u754C\u4E2D\u7684\u4F4D\u79FB\u8DDD\u79BB</span>
  <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>

  <span class="token comment">// \u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u7684x,y\u8F74</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u5C06\u9F20\u6807\u5728\u76F8\u673A\u4E16\u754C\u7684x,y\u8F74\u5411\u7684\u4F4D\u79FB\u91CF\u8F6C\u6362\u4E3A\u4E16\u754C\u5750\u6807\u4F4D</span>
  <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vy <span class="token operator">=</span> my<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u9F20\u6807\u5728s&#39;j&#39;z\u4E2D\u7684\u4F4D\u79FB\u65B9\u5411-x\u8F74</span>
  <span class="token keyword">const</span> moveDir <span class="token operator">=</span> vx
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u76EE\u6807\u70B9\u5230\u89C6\u70B9\u7684\u5355\u4F4D\u5411\u91CF-z\u8F74</span>
  <span class="token keyword">const</span> eyeDir <span class="token operator">=</span> camera<span class="token punctuation">.</span>position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u4F4D\u79FB\u65B9\u5411\u548C\u89C6\u7EBF\u83B7\u53D6\u65CB\u8F6C\u8F74-\u4E0A\u65B9\u5411y\u8F74</span>
  <span class="token keyword">const</span> axis <span class="token operator">=</span> moveDir<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>eyeDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u65CB\u8F6C\u8F74\u548C\u65CB\u8F6C\u91CF\u5EFA\u7ACB\u56DB\u5143\u6570</span>
  quaternion<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span>axis<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>3.\u5728 update()\u66F4\u65B0\u65B9\u6CD5\u4E2D\uFF0C\u57FA\u4E8E\u56DB\u5143\u6570\u8BBE\u7F6E\u76F8\u673A\u89C6\u70B9\u4F4D\u7F6E\uFF0C\u5E76\u66F4\u65B0\u76F8\u673A\u4E0A\u65B9\u5411</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u66F4\u65B0\u76F8\u673A\uFF0C\u5E76\u6E32\u67D3 */</span>
<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    \u2026\u2026

    <span class="token comment">//\u65CB\u8F6C\u89C6\u7EBF</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> camera<span class="token punctuation">.</span>position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span>

    <span class="token comment">//\u57FA\u4E8E\u6700\u65B0\u89C6\u7EBF\u8BBE\u7F6E\u76F8\u673A\u4F4D\u7F6E</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
        target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment">//\u65CB\u8F6C\u76F8\u673A\u4E0A\u65B9\u5411</span>
    camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span>

    \u2026\u2026

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    quaternion<span class="token punctuation">.</span><span class="token function">setFromRotationMatrix</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>\u4FEE\u6539\u5B8C\u76F8\u673A\u7684\u89C6\u70B9\u4F4D\u548C\u4E0A\u65B9\u540E\uFF0C\u8981\u8BB0\u5F97\u91CD\u7F6E\u56DB\u5143\u6570\uFF0C\u4EE5\u907F\u514D\u5728\u62D6\u62FD\u548C\u7F29\u653E\u65F6\uFF0C\u9020\u6210\u76F8\u673A\u65CB\u8F6C\u3002</p><p>\u6CE8\uFF1A</p><p>\u8F68\u8FF9\u7403\u7684\u64CD\u63A7\u96BE\u5EA6\u662F\u8981\u6BD4\u7403\u5750\u6807\u7CFB\u8F68\u9053\u5927\u7684\uFF0C\u5B83\u5E38\u5E38\u8BA9\u4E0D\u719F\u7EC3\u5176\u7279\u6027\u7684\u64CD\u4F5C\u8005\u627E\u4E0D\u5230\u5317\uFF0C\u6240\u4EE5\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\u8FD8\u662F\u7403\u5750\u6807\u7CFB\u8F68\u9053\u7528\u5F97\u6BD4\u8F83\u591A\u3002</p><h2 id="\u5341\u516D\u3001\u900F\u89C6\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u5341\u516D\u3001\u900F\u89C6\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" aria-hidden="true">#</a> \u5341\u516D\u3001\u900F\u89C6\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668</h2><p>\u4E4B\u524D\u8BF4\u8FC7\u4E86\u6B63\u4EA4\u76F8\u673A\u7684\u8F68\u9053\u63A7\u5236\u5668\uFF0C\u63A5\u4E0B\u6765\u518D\u770B\u900F\u89C6\u76F8\u673A\u7684\u8F68\u9053\u63A7\u5236\u5668\uFF0C\u5C31\u4F1A\u65B9\u4FBF\u5F88\u591A\u3002</p><h3 id="_1-\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_1-\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" aria-hidden="true">#</a> 1-\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053</h3><p>\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u548C\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u662F\u76F8\u540C\u539F\u7406\u7684\uFF0C\u90FD\u662F\u5BF9\u76F8\u673A\u89C6\u70B9\u548C\u76EE\u6807\u70B9\u7684\u5E73\u79FB\u3002</p><p>\u76F4\u63A5\u8BF4\u4E00\u4E0B\u4EE3\u7801\u5B9E\u73B0\u3002</p><p>1.\u5EFA\u900F\u89C6\u4EA4\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>2.\u5728\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u7684\u57FA\u7840\u4E0A\u6539\u4E00\u4E0B pan \u65B9\u6CD5</p><p><img src="`+Tn+`" alt=""></p><ul><li>\u5C06\u9F20\u6807\u5728\u753B\u5E03\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> up <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>

<span class="token comment">//\u89C6\u7EBF\u957F\u5EA6\uFF1A\u76F8\u673A\u89C6\u70B9\u5230\u76EE\u6807\u70B9\u7684\u8DDD\u79BB</span>
<span class="token keyword">const</span> sightLen <span class="token operator">=</span> position
  <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u89C6\u690E\u4F53\u5782\u76F4\u5939\u89D2\u7684\u4E00\u534A(\u5F27\u5EA6)</span>
<span class="token keyword">const</span> halfFov <span class="token operator">=</span> <span class="token punctuation">(</span>fov <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">;</span>
<span class="token comment">//\u76EE\u6807\u5E73\u9762\u7684\u9AD8\u5EA6</span>
<span class="token keyword">const</span> targetHeight <span class="token operator">=</span> sightLen <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>halfFov<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//\u76EE\u6807\u5E73\u9762\u4E0E\u753B\u5E03\u7684\u9AD8\u5EA6\u6BD4</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> targetHeight <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
<span class="token comment">//\u753B\u5E03\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</span>
<span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> x <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">const</span> distanceUp <span class="token operator">=</span> y <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u6CE8\uFF1A\u76EE\u6807\u5E73\u9762\u662F\u8FC7\u89C6\u70B9\uFF0C\u5E73\u884C\u4E8E\u88C1\u526A\u9762\u7684\u5E73\u9762</p><ul><li>\u5C06\u9F20\u6807\u5728\u76EE\u6807\u5E73\u9762\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u76F8\u673A\u5E73\u79FB\u65B9\u5411</span>
<span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684x\u8F74\u5E73\u79FB\u76F8\u673A</span>
<span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684y\u8F74\uFF0C\u6216\u8005-z\u8F74\u5E73\u79FB\u76F8\u673A</span>
<span class="token keyword">const</span> myOrz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//y\u8F74\uFF0C\u6B63\u4EA4\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
  myOrz<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">//-z\u8F74\uFF0C\u900F\u89C6\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
  myOrz<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807</span>
<span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vy <span class="token operator">=</span> myOrz<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2-\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_2-\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" aria-hidden="true">#</a> 2-\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053</h3><p>\u900F\u89C6\u76F8\u673A\u7F29\u653E\u662F\u901A\u8FC7\u89C6\u70B9\u6309\u7167\u89C6\u7EBF\u7684\u65B9\u5411\uFF0C\u63A5\u8FD1\u6216\u8005\u8FDC\u79BB\u76EE\u6807\u70B9\u6765\u5B9E\u73B0\u7684\u3002</p><p><img src="`+Rn+`" alt=""></p><h4 id="_2-1-\u4E3E\u4E2A\u4F8B\u5B50" tabindex="-1"><a class="header-anchor" href="#_2-1-\u4E3E\u4E2A\u4F8B\u5B50" aria-hidden="true">#</a> 2-1-\u4E3E\u4E2A\u4F8B\u5B50</h4><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u89C6\u70B9 e=5</li><li>\u76EE\u6807\u70B9 t=15</li><li>\uFF08\u89C6\u70B9\u5373\u5C06\u4F4D\u79FB\u7684\u8DDD\u79BB\uFF09/\uFF08\u4F4D\u79FB\u524D\uFF0C\u89C6\u70B9\u4E0E\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09= 0.4</li></ul><p>\u6C42\uFF1A\u89C6\u70B9\u79FB\u52A8 2 \u6B21\u540E\u7684\u4F4D\u7F6E</p><p>\u89E3\uFF1A</p><p>\u89C6\u70B9\u7B2C 1 \u6B21\u79FB\u52A8\u540E\u7684\u4F4D\u7F6E\uFF1A5+(15-5)*0.4=9</p><p>\u89C6\u70B9\u7B2C 2 \u6B21\u79FB\u52A8\u540E\u7684\u4F4D\u7F6E\uFF1A9+(15-9)*0.4= 11.4</p><p>\u57FA\u672C\u539F\u7406\u5C31\u662F\u8FD9\u6837\uFF0C\u89C6\u70B9\u79FB\u52A8 n \u6B64\u540E\u7684\u4F4D\u7F6E\u90FD\u53EF\u4EE5\u6309\u7167\u4E0A\u9762\u7684\u903B\u8F91\u6765\u8BA1\u7B97\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u770B\u4E00\u4E0B\u4EE3\u7801\u5B9E\u73B0\u3002</p><h4 id="_2-2-\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-2-\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 2-2-\u4EE3\u7801\u5B9E\u73B0</h4><p>\u53EF\u4EE5\u76F4\u63A5\u5728\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u57FA\u7840\u4E0A\u505A\u4E00\u4E0B\u4FEE\u6539\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">lerp</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> dollyScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p>lerp ( v : Vector3, alpha : Float ) \u6309\u6BD4\u4F8B\u53BB\u4E24\u70B9\u4E4B\u95F4\u7684\u63D2\u503C</p><p>\u5176\u6E90\u7801\u5982\u4E0B\uFF1A</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">lerp</span><span class="token punctuation">(</span> <span class="token parameter">v<span class="token punctuation">,</span> alpha</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token punctuation">)</span> <span class="token operator">*</span> alpha<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token punctuation">)</span> <span class="token operator">*</span> alpha<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token operator">+=</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>z <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token punctuation">)</span> <span class="token operator">*</span> alpha<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>dollyScale\uFF1A\uFF08\u4F4D\u79FB\u4E4B\u540E\u89C6\u70B9\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09/\uFF08\u4F4D\u79FB\u524D\uFF0C\u89C6\u70B9\u4E0E\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09</p></li><li><p>1-dollyScale\uFF1A\uFF08\u89C6\u70B9\u5373\u5C06\u4F4D\u79FB\u7684\u8DDD\u79BB\uFF09/\uFF08\u4F4D\u79FB\u524D\uFF0C\u89C6\u70B9\u4E8E\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09</p></li></ul><p>\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u57FA\u672C\u5B9E\u73B0\u539F\u7406\u5C31\u662F\u8FD9\u4E48\u7B80\u5355\u3002</p><p>\u7136\u800C\uFF0C\u540E\u9762\u8FD8\u5F97\u7528\u7403\u5750\u6807\u5BF9\u76F8\u673A\u8FDB\u884C\u65CB\u8F6C\uFF0C\u7403\u5750\u6807\u662F\u5DF2\u7ECF\u6DB5\u76D6\u4E86\u76F8\u673A\u89C6\u70B9\u4F4D\u7684\u3002</p><p>\u56E0\u6B64\uFF0C\u8FD8\u53EF\u4EE5\u76F4\u63A5\u628A\u76F8\u673A\u89C6\u70B9\u4F4D\u5199\u8FDB\u7403\u5750\u6807\u91CC\u3002</p><h4 id="_2-3-\u7403\u5750\u6807\u7F29\u653E" tabindex="-1"><a class="header-anchor" href="#_2-3-\u7403\u5750\u6807\u7F29\u653E" aria-hidden="true">#</a> 2-3-\u7403\u5750\u6807\u7F29\u653E</h4><p>1.\u50CF\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u90A3\u6837\uFF0C\u5B9A\u4E49\u7403\u5750\u6807\u5BF9\u8C61\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2.\u4FEE\u6539\u65CB\u8F6C\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  spherical<span class="token punctuation">.</span>radius <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3.\u66F4\u65B0\u65B9\u6CD5\u4E5F\u548C\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u4E00\u6837</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u548C\u65CB\u8F6C\u76F8\u673A</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u91CD\u7F6E\u7403\u5750\u6807\u548C\u5E73\u79FB\u91CF</span>
  spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3-\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_3-\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" aria-hidden="true">#</a> 3-\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053</h3><p>\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u548C\u6B63\u4EA4\u76F8\u673A\u7684\u5B9E\u73B0\u539F\u7406\u90FD\u662F\u4E00\u6837\u7684\uFF0C\u53EF\u4EE5\u7528\u7403\u5750\u6807\u7CFB\u5B9E\u73B0\uFF0C\u4E5F\u53EF\u4EE5\u7528\u8F68\u8FF9\u7403\u5B9E\u73B0\u3002</p><ul><li>\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u53EF\u76F4\u63A5\u53C2\u8003\u6B63\u4EA4\u76F8\u673A\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u65CB\u8F6C\u8F68\u9053\u6765\u5199\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u65CB\u8F6C\u8F68\u9053 */</span>
<span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">//&#39;xy&#39;,&#39;x&#39;,&#39;y&#39;</span>
<span class="token keyword">const</span> rotateDir <span class="token operator">=</span> <span class="token string">&#39;xy&#39;</span>

\u2026\u2026

<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&#39;pan&#39;</span><span class="token operator">:</span>
            <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">&#39;rotate&#39;</span><span class="token operator">:</span>
            <span class="token function">rotate</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u2026\u2026

<span class="token comment">// \u65CB\u8F6C\u65B9\u6CD5</span>
<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas
    <span class="token keyword">const</span> deltaT <span class="token operator">=</span> pi2 <span class="token operator">*</span> x <span class="token operator">/</span> clientHeight
    <span class="token keyword">const</span> deltaP <span class="token operator">=</span> pi2 <span class="token operator">*</span> y <span class="token operator">/</span> clientHeight
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> phi <span class="token operator">=</span> spherical<span class="token punctuation">.</span>phi <span class="token operator">-</span> deltaP
        spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
            Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99999999</span><span class="token punctuation">,</span>
            Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.00000001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>

    <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u76F8\u673A</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
        target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
        camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
        camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
        camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment">// \u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><ul><li>\u5BF9\u4E8E\u8F68\u8FF9\u7403\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u57FA\u4E8E\u6B63\u4EA4\u76F8\u673A\u8F68\u8FF9\u7403\u65CB\u8F6C\u7684\u4EE3\u7801\u7565\u4F5C\u8C03\u6574\u5373\u53EF\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u65CB\u8F6C\u8F68\u9053 */</span>
<span class="token keyword">const</span> quaternion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> fov <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>

  <span class="token comment">/* 1.\u57FA\u4E8E\u9F20\u6807\u62D6\u62FD\u8DDD\u79BB\u8BA1\u7B97\u65CB\u8F6C\u91CF */</span>
  <span class="token comment">// \u9F20\u6807\u4F4D\u79FB\u8DDD\u79BB\u5728\u753B\u5E03\u4E2D\u7684\u5360\u6BD4</span>
  <span class="token keyword">const</span> ratioY <span class="token operator">=</span> <span class="token operator">-</span>y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u57FA\u4E8E\u9AD8\u5EA6\u7684x\u4F4D\u7F6E\u6BD4-\u7528\u4E8E\u65CB\u8F6C\u91CF\u7684\u8BA1\u7B97</span>
  <span class="token keyword">const</span> ratioBaseHeight <span class="token operator">=</span> x <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> ratioLen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>ratioBaseHeight<span class="token punctuation">,</span> ratioY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u65CB\u8F6C\u91CF</span>
  <span class="token keyword">const</span> angle <span class="token operator">=</span> ratioLen <span class="token operator">*</span> pi2<span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u5C06\u9F20\u6807\u5728\u753B\u5E03\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF */</span>
  <span class="token comment">//\u89C6\u7EBF\u957F\u5EA6\uFF1A\u76F8\u673A\u89C6\u70B9\u5230\u76EE\u6807\u70B9\u7684\u8DDD\u79BB</span>
  <span class="token keyword">const</span> sightLen <span class="token operator">=</span> position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u89C6\u690E\u4F53\u5782\u76F4\u5939\u89D2\u7684\u4E00\u534A(\u5F27\u5EA6)</span>
  <span class="token keyword">const</span> halfFov <span class="token operator">=</span> <span class="token punctuation">(</span>fov <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">;</span>
  <span class="token comment">//\u76EE\u6807\u5E73\u9762\u7684\u9AD8\u5EA6</span>
  <span class="token keyword">const</span> targetHeight <span class="token operator">=</span> sightLen <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>halfFov<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token comment">//\u76EE\u6807\u5E73\u9762\u4E0E\u753B\u5E03\u7684\u9AD8\u5EA6\u6BD4</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> targetHeight <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u753B\u5E03\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> x <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> <span class="token operator">-</span>y <span class="token operator">*</span> ratio<span class="token punctuation">;</span>

  <span class="token comment">/* 3.\u5C06\u9F20\u6807\u5728\u76EE\u6807\u5E73\u9762\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807\uFF0C\u5E76\u4ECE\u4E2D\u63D0\u53D6\u9F20\u6807\u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4F4D\u79FB\u65B9\u5411 */</span>
  <span class="token comment">// \u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u7684x,y\u8F74</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5C06\u9F20\u6807\u5728\u76F8\u673A\u4E16\u754C\u7684x,y\u8F74\u5411\u7684\u4F4D\u79FB\u91CF\u8F6C\u6362\u4E3A\u4E16\u754C\u5750\u6807\u4F4D</span>
  <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vy <span class="token operator">=</span> my<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u9F20\u6807\u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4F4D\u79FB\u65B9\u5411-x\u8F74</span>
  <span class="token keyword">const</span> moveDir <span class="token operator">=</span> vx
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 4.\u57FA\u4E8E\u4F4D\u79FB\u65B9\u5411\u548C\u89C6\u7EBF\u83B7\u53D6\u65CB\u8F6C\u8F74 */</span>
  <span class="token comment">//\u76EE\u6807\u70B9\u5230\u89C6\u70B9\u7684\u5355\u4F4D\u5411\u91CF-z\u8F74</span>
  <span class="token keyword">const</span> eyeDir <span class="token operator">=</span> position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u57FA\u4E8E\u4F4D\u79FB\u65B9\u5411\u548C\u89C6\u7EBF\u83B7\u53D6\u65CB\u8F6C\u8F74-\u4E0A\u65B9\u5411y\u8F74</span>
  <span class="token keyword">const</span> axis <span class="token operator">=</span> moveDir<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>eyeDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 5.\u57FA\u4E8E\u65CB\u8F6C\u8F74\u548C\u65CB\u8F6C\u91CF\u66F4\u65B0\u56DB\u5143\u6570 */</span>
  quaternion<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span>axis<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u65CB\u8F6C\u91CF\u65CB\u8F6C\u76F8\u673A</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> camera<span class="token punctuation">.</span>position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>

  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
  quaternion<span class="token punctuation">.</span><span class="token function">setFromRotationMatrix</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h2 id="\u5341\u4E03\u3001\u5C01\u88C5\u76F8\u673A\u8F68\u9053\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E03\u3001\u5C01\u88C5\u76F8\u673A\u8F68\u9053\u5BF9\u8C61" aria-hidden="true">#</a> \u5341\u4E03\u3001\u5C01\u88C5\u76F8\u673A\u8F68\u9053\u5BF9\u8C61</h2><p>\u53C2\u8003 three.js \u91CC\u7684 OrbitControls \u5BF9\u8C61\uFF0C\u5C01\u88C5\u4E00\u4E2A\u8F68\u9053\u63A7\u5236\u5668\u51FA\u6765\u3002</p><p>\u81F3\u4E8E\u8F68\u8FF9\u7403\u7684\u5C01\u88C5\uFF0C\u53EF\u4EE5\u53C2\u8003\u7740 TrackballControls \u6765\u5B9E\u73B0\u3002</p><p>\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u548C\u900F\u89C6\u76F8\u673A\u8F68\u9053\u5DEE\u5F02\u5BF9\u6BD4\uFF1A</p><ul><li>\u65CB\u8F6C\u8F68\u9053 <ul><li>\u6B63\u4EA4\u76F8\u673A\u548C\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u90FD\u662F\u4E00\u6837\u7684\uFF0C\u90FD\u662F\u4F7F\u7528\u7403\u5750\u6807\uFF0C\u8BA9\u76F8\u673A\u89C6\u70B9\u56F4\u7ED5\u76EE\u6807\u70B9\u505A\u7684\u65CB\u8F6C\u3002</li></ul></li><li>\u4F4D\u79FB\u8F68\u9053 <ul><li>\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u662F\u9F20\u6807\u4ECE canvas \u753B\u5E03\u5230\u8FD1\u88C1\u526A\u9762\uFF0C\u518D\u5230\u4E16\u754C\u5750\u6807\u7CFB\u7684\u4F4D\u79FB\u91CF\u7684\u8F6C\u6362\uFF0C\u6700\u540E\u8FD9\u4E2A\u4F4D\u79FB\u91CF\u4F1A\u540C\u65F6\u4F5C\u7528\u4E8E\u76F8\u673A\u7684\u76EE\u6807\u70B9\u548C\u89C6\u70B9\u3002</li><li>\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u662F\u9F20\u6807\u4ECE canvas \u753B\u5E03\u5230\u76EE\u6807\u5E73\u9762\uFF0C\u518D\u5230\u4E16\u754C\u5750\u6807\u7CFB\u7684\u4F4D\u79FB\u91CF\u7684\u8F6C\u6362\uFF0C\u6700\u540E\u8FD9\u4E2A\u4F4D\u79FB\u91CF\u4F1A\u540C\u65F6\u4F5C\u7528\u4E8E\u76F8\u673A\u7684\u76EE\u6807\u70B9\u548C\u89C6\u70B9\u3002</li></ul></li><li>\u7F29\u653E\u8F68\u9053 <ul><li>\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053\u662F\u901A\u8FC7\u5BF9\u5176\u53EF\u89C6\u533A\u57DF\u7684\u5BBD\u9AD8\u5C3A\u5BF8\u7684\u7F29\u653E\u5B9E\u73B0\u7684\u3002</li><li>\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053\u662F\u901A\u8FC7\u76F8\u673A\u89C6\u70B9\u5728\u89C6\u7EBF\u4E0A\u7684\u4F4D\u79FB\u5B9E\u73B0\u7684\u3002</li></ul></li></ul><p>\u6574\u4F53\u7684\u539F\u7406\u5C31\u662F\u8FD9\u6837\uFF0C\u63A5\u4E0B\u6765\u5C01\u88C5\u8F68\u9053\u63A7\u5236\u5668\u3002</p><h3 id="_1-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5C01\u88C5" tabindex="-1"><a class="header-anchor" href="#_1-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5C01\u88C5" aria-hidden="true">#</a> 1-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5C01\u88C5</h3><p>\u6574\u4F53\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  Vector2<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Spherical<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pi2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mouseButtons</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;rotate&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;pan&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dragStart</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dragEnd</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">panOffset</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">screenSpacePanning</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">zoomScale</span><span class="token operator">:</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
  <span class="token literal-property property">spherical</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rotateDir</span><span class="token operator">:</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">OrbitControls</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> spherical<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> target <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pointerdown</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> dragStart<span class="token punctuation">,</span> mouseButtons <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pointermove</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      dragStart<span class="token punctuation">,</span>
      dragEnd<span class="token punctuation">,</span>
      state<span class="token punctuation">,</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;pan&quot;</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">pan</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;rotate&quot;</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pointerup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">wheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      zoomScale<span class="token punctuation">,</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> scale <span class="token operator">=</span> deltaY <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> zoomScale <span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">/</span> zoomScale<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dolly</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">dollyPerspectiveCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spherical<span class="token punctuation">.</span>radius <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">dollyOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> camera <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>zoom <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">panPerspectiveCamera</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> fov<span class="token punctuation">,</span> up <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span><span class="token punctuation">,</span>
      panOffset<span class="token punctuation">,</span>
      screenSpacePanning<span class="token punctuation">,</span>
      target<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//\u89C6\u7EBF\u957F\u5EA6\uFF1A\u76F8\u673A\u89C6\u70B9\u5230\u76EE\u6807\u70B9\u7684\u8DDD\u79BB</span>
    <span class="token keyword">const</span> sightLen <span class="token operator">=</span> position
      <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u89C6\u690E\u4F53\u5782\u76F4\u5939\u89D2\u7684\u4E00\u534A(\u5F27\u5EA6)</span>
    <span class="token keyword">const</span> halfFov <span class="token operator">=</span> <span class="token punctuation">(</span>fov <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">;</span>
    <span class="token comment">//\u76EE\u6807\u5E73\u9762\u7684\u9AD8\u5EA6</span>
    <span class="token keyword">const</span> targetHeight <span class="token operator">=</span> sightLen <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>halfFov<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">//\u76EE\u6807\u5E73\u9762\u4E0E\u753B\u5E03\u7684\u9AD8\u5EA6\u6BD4</span>
    <span class="token keyword">const</span> ratio <span class="token operator">=</span> targetHeight <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token comment">//\u753B\u5E03\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</span>
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> x <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> y <span class="token operator">*</span> ratio<span class="token punctuation">;</span>

    <span class="token comment">//\u76F8\u673A\u5E73\u79FB\u65B9\u5411</span>
    <span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684x\u8F74\u5E73\u79FB\u76F8\u673A</span>
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684y\u8F74\uFF0C\u6216\u8005-z\u8F74\u5E73\u79FB\u76F8\u673A</span>
    <span class="token keyword">const</span> myOrz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//y\u8F74\uFF0C\u6B63\u4EA4\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
      myOrz<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//-z\u8F74\uFF0C\u900F\u89C6\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
      myOrz<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> myOrz<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">panOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> up <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span><span class="token punctuation">,</span>
      panOffset<span class="token punctuation">,</span>
      screenSpacePanning<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
    <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ratioY <span class="token operator">=</span> y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span><span class="token punctuation">,</span>
      spherical<span class="token punctuation">,</span>
      rotateDir<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaT <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaP <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> phi <span class="token operator">=</span> spherical<span class="token punctuation">.</span>phi <span class="token operator">-</span> deltaP<span class="token punctuation">;</span>
      spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99999999</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.00000001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> spherical<span class="token punctuation">,</span> panOffset <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u76F8\u673A</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> projectionMatrix<span class="token punctuation">,</span> matrixWorldInverse <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br></div></div><h3 id="_2-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u4F8B\u5316" tabindex="-1"><a class="header-anchor" href="#_2-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u4F8B\u5316" aria-hidden="true">#</a> 2-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u4F8B\u5316</h3><p>OrbitControls \u5BF9\u8C61\u5C31\u50CF three.js \u91CC\u7684\u6837\uFF0C\u53EF\u4EE5\u81EA\u52A8\u6839\u636E\u76F8\u673A\u7C7B\u578B\u53BB\u505A\u76F8\u5E94\u7684\u8F68\u9053\u53D8\u6362\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u900F\u89C6\u76F8\u673A */</span>
<span class="token comment">/*
	const eye = new Vector3(0, 0.5, 1)
    const target = new Vector3(0, 0, -2.5)
    const up = new Vector3(0, 1, 0)
    const [fov, aspect, near, far] = [
      45,
      canvas.width / canvas.height,
      1,
      20
    ]
    const camera = new PerspectiveCamera(fov, aspect, near, far)
    camera.position.copy(eye)
*/</span>

<span class="token comment">/* \u6B63\u4EA4\u76F8\u673A */</span>
<span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>

<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

\u2026\u2026

<span class="token comment">/* \u5B9E\u4F8B\u5316\u8F68\u9053\u63A7\u5236\u5668 */</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    camera<span class="token punctuation">,</span>
    target<span class="token punctuation">,</span>
    <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//\u6EDA\u8F6E\u4E8B\u4EF6</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h2 id="\u5341\u516B\u3001\u9876\u70B9\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#\u5341\u516B\u3001\u9876\u70B9\u7D22\u5F15" aria-hidden="true">#</a> \u5341\u516B\u3001\u9876\u70B9\u7D22\u5F15</h2><h3 id="_1-\u9876\u70B9\u7D22\u5F15\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u9876\u70B9\u7D22\u5F15\u6982\u5FF5" aria-hidden="true">#</a> 1-\u9876\u70B9\u7D22\u5F15\u6982\u5FF5</h3><p>\u5BF9\u4E8E\u9876\u70B9\u7D22\u5F15\u7684\u6982\u5FF5\uFF0C\u5176\u5B9E\u5728\u8BF4\u590D\u5408\u53D8\u6362\u91CC\u7684\u6A21\u578B\u77E9\u9635\u7684\u65F6\u5019\u63D0\u8FC7\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const verticeLib = <span class="token punctuation">[</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>;

const indices = <span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>

    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span>
<span class="token punctuation">]</span>;

const arr = <span class="token punctuation">[</span><span class="token punctuation">]</span>;
indices.forEach(n =&gt; <span class="token punctuation">{</span>
    const i = n * <span class="token number">3</span>
    arr.push(
        verticeLib<span class="token punctuation">[</span>i<span class="token punctuation">]</span> / <span class="token number">5</span><span class="token punctuation">,</span>
        verticeLib<span class="token punctuation">[</span>i + <span class="token number">1</span><span class="token punctuation">]</span> / <span class="token number">5</span><span class="token punctuation">,</span>
        verticeLib<span class="token punctuation">[</span>i + <span class="token number">2</span><span class="token punctuation">]</span> / <span class="token number">5</span><span class="token punctuation">,</span>
    )
<span class="token punctuation">}</span>)
const vertices = new Float32Array(arr)
\u2026\u2026
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>\u4E0B\u8FC7\u5982\u4E0B\uFF1A</p><p><img src="`+Bn+`" alt=""></p><p>\u4E0A\u9762\u662F\u7528 js \u5B9E\u73B0\u7684\u9876\u70B9\u7D22\u5F15\u529F\u80FD\uFF0C\u5176\u5B9E\u8FD9\u79CD\u529F\u80FD\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7 webgl api \u6765\u5B9E\u73B0\uFF0C\u4E0D\u9700\u8981\u6211\u4EEC\u81EA\u5DF1\u53BB\u7B97\u3002</p><p>\u8981\u505A\u7684\u5C31\u662F\u5EFA\u7ACB\u4E00\u4E2A\u9876\u70B9\u5E93\uFF0C\u7136\u540E\u4F7F\u7528\u9876\u70B9\u5728\u9876\u70B9\u5E93\u4E2D\u7684\u7D22\u5F15\u62FC\u56FE\u5F62\u3002</p><p>1.\u9876\u70B9\u6570\u636E verticeLib \u548C\u9876\u70B9\u7D22\u5F15\u6570\u636E indices \u548C\u4E4B\u524D\u4E00\u6837</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const verticeLib = new Float32Array(<span class="token punctuation">[</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
    <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span> <span class="token number">-1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>)

const indices = new Uint8Array(<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>

    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span>
<span class="token punctuation">]</span>)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>2.\u9876\u70B9\u6570\u636E\u5728 webgl \u7F13\u51B2\u533A\u5199\u5165\u548C\u4E4B\u524D\u90FD\u662F\u4E00\u6837\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> verticeLib<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>3.\u89C6\u56FE\u77E9\u9635\u548C\u6A21\u578B\u77E9\u9635\u548C\u8BBE\u7F6E\u548C\u4E4B\u524D\u4E5F\u662F\u4E00\u6837\u7684</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ModelMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelMatrix<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u63A5\u4E0B\u6765\u662F\u4E0D\u4E00\u6837\u7684\u5730\u65B9\u3002</p><p>4.\u628A\u9876\u70B9\u7D22\u5F15\u5199\u5165 webgl \u7F13\u51B2\u533A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5EFA\u7ACB\u7F13\u51B2\u5BF9\u8C61</span>
<span class="token keyword">const</span> indicesBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u5728ELEMENT_ARRAY_BUFFER\u4E0A\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indicesBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u5C06\u9876\u70B9\u7D22\u5F15\u6570\u636E\u5199\u5165\u7F13\u51B2\u5BF9\u8C61</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>5.\u7ED8\u56FE</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gl.drawArrays(gl.LINES, 0, indices.length);</span>
gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>drawElements(mode, count, type, offset) \u662F\u4F7F\u7528\u9876\u70B9\u7D22\u5F15\u7ED8\u56FE\u7684\u65B9\u6CD5\u3002</p><ul><li>mode \u7ED8\u56FE\u65B9\u5F0F</li><li>count \u5143\u7D20\u6570\u91CF</li><li>type \u7F13\u51B2\u533A\u6570\u636E\u7684\u7C7B\u578B</li><li>offset \u5F53\u524D\u7CFB\u5217\u7684\u5B57\u8282\u7D22\u5F15\u4F4D</li></ul><p>\u6211\u4EEC\u4E0A\u9762\u7528\u9876\u70B9\u7D22\u5F15\u753B\u4E86\u4E00\u4E2A\u7EBF\u6846\uFF0C\u91CD\u70B9\u5C31\u662F\u8BF4\u4E00\u4E2A\u539F\u7406\uFF0C\u63A5\u4E0B\u6765\u54B1\u4EEC\u518D\u753B\u4E00\u4E2A\u597D\u770B\u4E9B\u7684\u5F69\u8272\u7ACB\u65B9\u4F53\u3002</p><h3 id="_2-\u5F69\u8272\u7ACB\u65B9\u4F53" tabindex="-1"><a class="header-anchor" href="#_2-\u5F69\u8272\u7ACB\u65B9\u4F53" aria-hidden="true">#</a> 2-\u5F69\u8272\u7ACB\u65B9\u4F53</h3><p>\u5F69\u8272\u7ACB\u65B9\u4F53\u7684\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+zn+`" alt=""></p><p>\u73B0\u5728\u5148\u4E0D\u8003\u8651\u706F\u5149\uFF0C\u53EA\u7ED9\u9876\u70B9\u8D4B\u4E2A\u989C\u8272\u3002</p><p>1.\u7740\u8272\u5668</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec4 a_Color<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    v_Color<span class="token operator">=</span>a_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>v_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u4E0A\u9762\u7684 a_Color \u662F\u548C a_Position \u4E00\u4E00\u5BF9\u5E94\u7684\uFF0C\u4E00\u4E2A\u9876\u70B9\uFF0C\u4E00\u4E2A\u989C\u8272\uFF0C\u6240\u4EE5\u6211\u662F\u7528 attribute \u58F0\u660E\u7684 a_Color\u3002</p><p>\u5982\u679C\u6574\u4E2A\u7ACB\u65B9\u4F53\u90FD\u662F\u4E00\u4E2A\u989C\u8272\uFF0C\u90A3\u6211\u76F4\u63A5\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u7528 uniform \u58F0\u660E\u5C31\u597D\u4E86\u3002</p><p>2.\u6B63\u5E38\u521D\u59CB\u5316\u7740\u8272\u5668\uFF0C\u6253\u5F00\u6DF1\u5EA6\u6D4B\u8BD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  PerspectiveCamera<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Quaternion<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&quot;./jsm/OrbitControls.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u6DF1\u5EA6\u6D4B\u8BD5\u53EF\u4EE5\u89E3\u51B3\u7269\u4F53\u7684\u906E\u6321\u95EE\u9898\uFF0C\u4E0D\u7136\u540E\u9762\u7684\u7269\u4F53\u53EF\u80FD\u6321\u4F4F\u524D\u9762\u7684\u7269\u4F53\u3002</p><p>3.\u5EFA\u7ACB\u900F\u89C6\u76F8\u673A\u548C\u8F68\u9053\u63A7\u5236\u5668\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u900F\u89C6\u76F8\u673A */</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* \u5B9E\u4F8B\u5316\u8F68\u9053\u63A7\u5236\u5668 */</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  camera<span class="token punctuation">,</span>
  target<span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;contextmenu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointerdown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;pointerup&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;wheel&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>4.\u58F0\u660E\u9876\u70B9\u6570\u636E vertices \u548C\u9876\u70B9\u7D22\u5F15 indexes\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//    v6----- v5</span>
<span class="token comment">//   /|      /|</span>
<span class="token comment">//  v1------v0|</span>
<span class="token comment">//  | |     | |</span>
<span class="token comment">//  | |v7---|-|v4</span>
<span class="token comment">//  |/      |/</span>
<span class="token comment">//  v2------v3</span>
const vertices = new Float32Array(<span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// v0</span>
    <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// v1</span>
    <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v2</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// v3</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v4</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v5</span>
    <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v6</span>
    <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>   <span class="token comment">// v7</span>
<span class="token punctuation">]</span>)

const indexes = new Uint8Array(<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>    <span class="token comment">// front</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>    <span class="token comment">// right</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment">// up</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// left</span>
    <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// down</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span>     <span class="token comment">// back</span>
<span class="token punctuation">]</span>)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>\u9876\u70B9\u6570\u636E vertices \u662F\u591A attribute \u6570\u636E\u7684\u5408\u4E00\uFF0C\u8FD9\u4E2A\u54B1\u4EEC\u4E4B\u524D\u8BB2\u8FC7\u3002</p><p>\u9876\u70B9\u6570\u636E\u4E2D\u6709\u4E24\u4E2A\u7CFB\u5217\uFF0C\u5206\u522B\u662F\u9876\u70B9\u4F4D\u7F6E\u6570\u636E\u548C\u9876\u70B9\u989C\u8272\u6570\u636E\u3002</p><p>5.\u5C06\u9876\u70B9\u6570\u636E\u5199\u5165\u7F13\u51B2\u533A\uFF0C\u5E76\u5C06\u5176\u4E2D\u7684\u70B9\u4F4D\u548C\u989C\u8272\u6570\u636E\u5206\u522B\u5206\u914D\u7ED9 a_Position \u548C a_Color</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
<span class="token keyword">const</span> elementBytes <span class="token operator">=</span> vertices<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> vertices<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
<span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
<span class="token keyword">const</span> verticeSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> colorSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
<span class="token keyword">const</span> categorySize <span class="token operator">=</span> verticeSize <span class="token operator">+</span> colorSize<span class="token punctuation">;</span>
<span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
<span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes<span class="token punctuation">;</span>
<span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
<span class="token keyword">const</span> verticeByteIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> colorByteIndex <span class="token operator">=</span> verticeSize <span class="token operator">*</span> elementBytes<span class="token punctuation">;</span>

<span class="token comment">/* \u9876\u70B9\u7F13\u51B2\u533A */</span>
<span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5C06\u9876\u70B9\u7F13\u51B2\u533A\u91CC\u7684\u70B9\u4F4D\u6570\u636E\u5206\u914D\u7ED9a_Position</span>
<span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
  a_Position<span class="token punctuation">,</span>
  verticeSize<span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  categoryBytes<span class="token punctuation">,</span>
  verticeByteIndex
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5C06\u9876\u70B9\u7F13\u51B2\u533A\u91CC\u7684\u989C\u8272\u6570\u636E\u5206\u914D\u7ED9a_Color</span>
<span class="token keyword">const</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Color&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
  a_Color<span class="token punctuation">,</span>
  colorSize<span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  categoryBytes<span class="token punctuation">,</span>
  colorByteIndex
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>6.\u5C06\u9876\u70B9\u7D22\u5F15\u5199\u5165\u7F13\u51B2\u533A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5EFA\u7ACB\u7F13\u51B2\u533A\u5BF9\u8C61</span>
<span class="token keyword">const</span> indexesBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u628A\u7F13\u51B2\u533A\u7ED1\u5B9A\u5230webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indexesBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u5F80\u7F13\u51B2\u533A\u5199\u6570\u636E</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>7.\u5EFA\u7ACB\u6A21\u578B\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u7247\u5143\u7740\u8272\u5668</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ModelMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
modelMatrix<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>8.\u5EFA\u7ACB\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u7247\u5143\u7740\u8272\u5668</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_PvMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_PvMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_PvMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>9.\u7528\u8FDE\u7EED\u6E32\u67D3\u7684\u65B9\u6CD5\u7ED8\u56FE\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u5341\u4E5D\u3001\u591A\u7740\u8272\u5668" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E5D\u3001\u591A\u7740\u8272\u5668" aria-hidden="true">#</a> \u5341\u4E5D\u3001\u591A\u7740\u8272\u5668</h2><p>\u5230\u76EE\u524D\u4E3A\u6B62\u90FD\u662F\u7528\u4E86\u4E00\u5957\u7740\u8272\u5668\u505A\u7684\u4F8B\u5B50\uFF0C\u8FD9\u4E00\u5957\u7740\u8272\u5668\u5305\u542B\u4E86\u9876\u70B9\u7740\u8272\u5668\u548C\u7247\u5143\u7740\u8272\u5668\u3002</p><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u4E0D\u53EF\u80FD\u53EA\u7528\u4E00\u5957\u7740\u8272\u5668\u505A\u9879\u76EE\u7684\uFF0C\u5C31\u6BD4\u5982\u573A\u666F\u91CC\u6709\u4E24\u4E2A\u4E09\u89D2\u5F62\uFF0C\u4E00\u4E2A\u4E09\u89D2\u5F62\u9700\u8981\u7740\u7EAF\u8272\uFF0C\u4E00\u4E2A\u4E09\u89D2\u5F62\u9700\u8981\u7740\u7EB9\u7406\u3002</p><p><img src="`+Fn+`" alt=""></p><p>\u63A5\u4E0B\u6765\u5C31\u62FF\u8FD9\u4E24\u4E2A\u4E09\u89D2\u5F62\u6765\u8BF4\u4E00\u4E0B\u591A\u7740\u8272\u5668\u7684\u5B9E\u73B0\u65B9\u6CD5\u3002</p><h3 id="_1-\u591A\u7740\u8272\u5668\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-\u591A\u7740\u8272\u5668\u7ED8\u56FE" aria-hidden="true">#</a> 1-\u591A\u7740\u8272\u5668\u7ED8\u56FE</h3><h4 id="_1-1-\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668" tabindex="-1"><a class="header-anchor" href="#_1-1-\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668" aria-hidden="true">#</a> 1-1-\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668</h4><p>\u4E24\u5957\u7740\u8272\u5668\uFF0C\u4E00\u5957\u7740\u7EAF\u8272\uFF0C\u4E00\u5957\u7740\u7EB9\u7406\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- \u7740\u7EAF\u8272 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- \u7740\u7EB9\u7406 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    v_Pin<span class="token operator">=</span>a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_1-2-\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62" tabindex="-1"><a class="header-anchor" href="#_1-2-\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62" aria-hidden="true">#</a> 1-2-\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62</h4><p>1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> solidVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> solidFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidFragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> solidProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> solidVsSource<span class="token punctuation">,</span> solidFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u4E0A\u9762\u7684 createProgram() \u65B9\u6CD5\u662F\u57FA\u4E8E\u4E00\u5957\u7740\u8272\u5668\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\u7684\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u521B\u5EFA\u7A0B\u5E8F\u5BF9\u8C61</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5EFA\u7ACB\u7740\u8272\u5BF9\u8C61</span>
  <span class="token keyword">const</span> vertexShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fragmentShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u628A\u9876\u70B9\u7740\u8272\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u628A\u7247\u5143\u7740\u8272\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u8FDE\u63A5webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\u548C\u7A0B\u5E8F\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> program<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u5173\u4E8E\u7A0B\u5E8F\u5BF9\u8C61\u7684\u6982\u5FF5\u4E4B\u524D\u5DF2\u7ECF\u8BF4\u8FC7\u3002</p><p>\u4E4B\u524D\u521D\u59CB\u5316\u7740\u8272\u5668\u65B9\u6CD5 initShaders() \u53EA\u662F\u6BD4\u4E0A\u9762\u7684\u65B9\u6CD5\u591A\u4E86\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61\u7684\u6B65\u9AA4\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u91CC\u4E4B\u6240\u4EE5\u628A\u542F\u7528\u7A0B\u5E8F\u7684\u6B65\u9AA4\u63D0\u53D6\u51FA\u6765\uFF0C\u662F\u56E0\u4E3A\u4E00\u5957\u7740\u8272\u5668\u5BF9\u5E94\u7740\u4E00\u4E2A\u7A0B\u5E8F\u5BF9\u8C61\u3002</p><p>\u800C\u4E00\u4E2A webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u662F\u53EF\u4EE5\u4F9D\u6B21\u5E94\u7528\u591A\u4E2A\u7A0B\u5E8F\u5BF9\u8C61\u7684\u3002</p><p>\u901A\u8FC7\u4E0D\u540C\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u7ED8\u5236\u4E0D\u540C\u6750\u8D28\u7684\u56FE\u5F62\u3002</p><p>2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> solidVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> solidVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> solidPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u56E0\u4E3A\u540E\u9762\u8FD8\u9700\u8981\u7ED8\u5236\u4E00\u4E2A\u7EB9\u7406\u56FE\u5F62\uFF0C\u7EB9\u7406\u56FE\u5F62\u662F\u9700\u8981\u7B49\u7EB9\u7406\u52A0\u8F7D\u6210\u529F\u624D\u80FD\u7ED8\u5236\u7684\u3002</p><p>\u8FD9\u4F1A\u9020\u6210\u4E24\u4E2A\u4E09\u89D2\u5F62\u7684\u5F02\u6B65\u7ED8\u5236\uFF0C\u8FD9\u4E0D\u662F\u6211\u4EEC\u60F3\u8981\u7684\uFF0C\u56E0\u4E3A\u4E00\u5F02\u6B65\uFF0C\u5C31\u4F1A\u628A\u4E4B\u524D\u4E09\u89D2\u5F62\u7684\u7F13\u51B2\u6570\u636E\u7ED9\u6E05\u7406\u6389\u3002</p><p>\u56E0\u6B64\uFF0C\u9700\u8981\u540C\u6B65\u7ED8\u5236\u4E24\u4E2A\u4E09\u89D2\u5F62\u3002</p><p>\u5148\u628A\u4E0A\u9762\u7684\u7ED8\u56FE\u65B9\u6CD5\u5C01\u88C5\u5230\u4E00\u4E2A\u51FD\u6570\u91CC\uFF0C\u7B49\u7EB9\u7406\u4E09\u89D2\u5F62\u7684\u56FE\u7247\u52A0\u8F7D\u6210\u529F\u4E86\uFF0C\u518D\u6267\u884C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">drawSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528 */</span>
  <span class="token keyword">const</span> solidVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidFragmentShader&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> solidVsSource<span class="token punctuation">,</span> solidFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token keyword">const</span> solidVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_1-3-\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62" tabindex="-1"><a class="header-anchor" href="#_1-3-\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62" aria-hidden="true">#</a> 1-3-\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62</h4><p>\u7EB9\u7406\u4E09\u89D2\u5F62\u7684\u7ED8\u5236\u539F\u7406\u548C\u7EAF\u8272\u4E09\u89D2\u5F62\u4E00\u6837\uFF0C\u8981\u7528\u4E00\u5957\u65B0\u7684\u7740\u8272\u5668\u5EFA\u7ACB\u4E00\u4E2A\u65B0\u7684\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u7136\u540E\u7528\u8FD9\u4E2A\u65B0\u7684\u7A0B\u5E8F\u5BF9\u8C61\u8FDB\u884C\u7ED8\u56FE\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">drawTexture</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528 */</span>
  <span class="token keyword">const</span> textureVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;textureVertexShader&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;textureFragmentShader&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> textureVsSource<span class="token punctuation">,</span> textureFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token comment">// \u9876\u70B9</span>
  <span class="token keyword">const</span> textureVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> texturePosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u56FE\u9489</span>
  <span class="token keyword">const</span> pins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pinBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pinBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pins<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Pin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u7EB9\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="_1-4-\u540C\u6B65\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-4-\u540C\u6B65\u7ED8\u56FE" aria-hidden="true">#</a> 1-4-\u540C\u6B65\u7ED8\u56FE</h4><p>\u5F53\u7EB9\u7406\u56FE\u5F62\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u8FDB\u884C\u540C\u6B65\u7ED8\u56FE\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">drawSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">drawTexture</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u60F3\u7ED9\u573A\u666F\u4E2D\u7684\u56FE\u5F62\u6DFB\u52A0\u4E00\u4E2A\u52A8\u753B\uFF0C\u6BD4\u5982\u60F3\u8BA9\u7EAF\u8272\u4E09\u89D2\u5F62\u4E0D\u65AD\u7684\u53D8\u6362\u989C\u8272\u3002</p><p>\u9996\u5148\u8981\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u7684\u7247\u5143\u7740\u8272\u5668\u5F00\u4E00\u4E2A uniform \u53D8\u91CF\u3002</p><p>\u7136\u540E\u63A5\u4E0B\u6765\u662F\u4E0D\u662F\u5C31\u8981\u4E0D\u65AD\u4FEE\u6539\u8FD9\u4E2A uniform \u53D8\u91CF\uFF0C\u7136\u540E\u6267\u884C\u4E0A\u9762\u7684 drawSolid()\u548C drawTexture(image) \u65B9\u6CD5\u5462\uFF1F</p><h3 id="_2-\u591A\u7740\u8272\u5668\u52A8\u753B" tabindex="-1"><a class="header-anchor" href="#_2-\u591A\u7740\u8272\u5668\u52A8\u753B" aria-hidden="true">#</a> 2-\u591A\u7740\u8272\u5668\u52A8\u753B</h3><p>\u5728\u4E0A\u9762\u7684\u7ED8\u56FE\u65B9\u6CD5\u4E2D\uFF0C\u5F88\u591A\u64CD\u4F5C\u90FD\u662F\u4E0D\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\uFF0C\u6BD4\u5982\u7A0B\u5E8F\u5BF9\u8C61\u5728\u5EFA\u7ACB\u4E4B\u540E\uFF0C\u5C31\u4E0D\u9700\u8981\u518D\u5EFA\u7ACB\u4E86\uFF0C\u540E\u9762\u5728\u7ED8\u56FE\u7684\u65F6\u5019\u518D\u63A5\u7740\u7528\u3002</p><h4 id="_2-1-\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u6DFB\u52A0\u4E00\u4E2A\u4EE3\u8868\u65F6\u95F4\u7684-uniform-\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_2-1-\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u6DFB\u52A0\u4E00\u4E2A\u4EE3\u8868\u65F6\u95F4\u7684-uniform-\u53D8\u91CF" aria-hidden="true">#</a> 2-1-\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u6DFB\u52A0\u4E00\u4E2A\u4EE3\u8868\u65F6\u95F4\u7684 uniform \u53D8\u91CF</h4><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
     uniform float u_Time<span class="token punctuation">;</span>
     <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       float r<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>u_Time<span class="token operator">/</span><span class="token number">200.0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span><span class="token punctuation">;</span>
       gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-2-\u58F0\u660E\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_2-2-\u58F0\u660E\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u53D8\u91CF" aria-hidden="true">#</a> 2-2-\u58F0\u660E\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u53D8\u91CF</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> solidProgram<span class="token punctuation">,</span>
  solidVertexBuffer<span class="token punctuation">,</span>
  solidPosition<span class="token punctuation">,</span>
  solidTime <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textureProgram<span class="token punctuation">,</span>
  textureVertexBuffer<span class="token punctuation">,</span>
  texturePosition <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pinBuffer<span class="token punctuation">,</span>
  pin <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u7A0B\u5E8F\u5BF9\u8C61\u3001\u7F13\u51B2\u5BF9\u8C61\u3001\u4ECE\u7740\u8272\u5668\u4E2D\u83B7\u53D6\u7684 attribute \u53D8\u91CF\u548C uniform \u53D8\u91CF\u90FD\u662F\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u7684\u3002</p><h4 id="_2-3-\u521D\u59CB\u5316\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_2-3-\u521D\u59CB\u5316\u65B9\u6CD5" aria-hidden="true">#</a> 2-3-\u521D\u59CB\u5316\u65B9\u6CD5</h4><ul><li>\u628A\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62\u7684\u65B9\u6CD5\u53D8\u6210\u521D\u59CB\u5316\u65B9\u6CD5</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61*/</span>
  <span class="token keyword">const</span> solidVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidFragmentShader&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  solidProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> solidVsSource<span class="token punctuation">,</span> solidFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token keyword">const</span> solidVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  solidVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  solidPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

  solidTime <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;u_Time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* gl.clear(gl.COLOR_BUFFER_BIT)
       gl.drawArrays(gl.TRIANGLES, 0, 3) */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>\u628A\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62\u7684\u65B9\u6CD5\u53D8\u6210\u521D\u59CB\u5316\u65B9\u6CD5</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528 */</span>
  <span class="token keyword">const</span> textureVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;textureVertexShader&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;textureFragmentShader&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  textureProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> textureVsSource<span class="token punctuation">,</span> textureFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token comment">// \u9876\u70B9</span>
  <span class="token keyword">const</span> textureVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  textureVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  texturePosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u56FE\u9489</span>
  <span class="token keyword">const</span> pins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pinBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pinBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pins<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Pin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u7EB9\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// gl.drawArrays(gl.TRIANGLES, 0, 3)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>\u4E0A\u9762\u5DF2\u7ECF\u6CE8\u91CA\u6389\u7684\u662F\u9700\u8981\u5728\u7ED8\u56FE\u65F6\u91CD\u590D\u6267\u884C\u7684\u3002</p><h4 id="_2-4-\u628A\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u65B9\u6CD5\u6536\u96C6\u4E00\u4E0B-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3" tabindex="-1"><a class="header-anchor" href="#_2-4-\u628A\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u65B9\u6CD5\u6536\u96C6\u4E00\u4E0B-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3" aria-hidden="true">#</a> 2-4-\u628A\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u65B9\u6CD5\u6536\u96C6\u4E00\u4E0B\uFF0C\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>solidTime<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pinBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u7531\u4E0A\u53EF\u77E5\uFF0C\u5728\u8FDE\u7EED\u6E32\u67D3\u65F6\uFF0C\u5FC5\u987B\u8981\u6709\u7684\u64CD\u4F5C\uFF1A</p><ul><li>clear() \u6E05\u7406\u753B\u5E03</li><li>useProgram() \u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61</li><li>bindBuffer() \u7ED1\u5B9A\u7F13\u51B2\u533A\u5BF9\u8C61</li><li>vertexAttribPointer() \u544A\u8BC9\u663E\u5361\u4ECE\u5F53\u524D\u7ED1\u5B9A\u7684\u7F13\u51B2\u533A\uFF08bindBuffer()\u6307\u5B9A\u7684\u7F13\u51B2\u533A\uFF09\u4E2D\u8BFB\u53D6\u9876\u70B9\u6570\u636E</li><li>drawArrays() \u7ED8\u56FE\u65B9\u6CD5</li></ul><p>\u82E5 attribute \u53D8\u91CF\u3001uniform \u53D8\u91CF\u6216\u8005\u56FE\u7247\u53D1\u751F\u4E86\u53D8\u5316\uFF0C\u90A3\u5C31\u9700\u8981\u5BF9\u5176\u8FDB\u884C\u66F4\u65B0\u3002</p><h4 id="_2-4-\u5F53\u7EB9\u7406\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E-\u521D\u59CB\u5316\u7ED8\u56FE\u65B9\u6CD5-\u8FDE\u7EED\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_2-4-\u5F53\u7EB9\u7406\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E-\u521D\u59CB\u5316\u7ED8\u56FE\u65B9\u6CD5-\u8FDE\u7EED\u7ED8\u56FE" aria-hidden="true">#</a> 2-4-\u5F53\u7EB9\u7406\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u521D\u59CB\u5316\u7ED8\u56FE\u65B9\u6CD5\uFF0C\u8FDE\u7EED\u7ED8\u56FE</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">initSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initTexture</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>`,365);function Gn(Zn,Qn){const t=k("ExternalLinkIcon");return b(),m(d,null,[In,s("p",null,[Cn,s("a",Ln,[Un,e(t)]),Vn]),Dn,s("p",null,[Wn,s("a",Nn,[Yn,e(t)]),Xn]),Hn],64)}var $n=g(On,[["render",Gn]]);export{$n as default};
